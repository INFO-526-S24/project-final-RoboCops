<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.547">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="RoboCops - Peter, Sachin, Arun, Surajit, Christian, Valerie">
<meta name="description" content="This project aims to comprehensively analyze fatal police shootings in the United States, delving into the underlying factors and motivations driving these tragic events.">

<title> Analysis of Fatal Police Shootings - Analysis and Visualization of Police Shootings in the United States</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title"><img src="./images/fatalshootings.jpeg" alt="Stock Symbol" style="width: 2.6em; height: 2.2em; border-radius: 30%;"> <b>Analysis of Fatal Police Shootings</b></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Project</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./proposal.html"> 
<span class="menu-text">Proposal</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./presentation.html"> 
<span class="menu-text">Presentation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Dashboard.html"> 
<span class="menu-text">Dashboard</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/INFO-526-S24/project-final-RoboCops"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#question-1" id="toc-question-1" class="nav-link" data-scroll-target="#question-1">Question 1</a>
  <ul class="collapse">
  <li><a href="#description-of-analysis" id="toc-description-of-analysis" class="nav-link" data-scroll-target="#description-of-analysis">Description of Analysis</a></li>
  <li><a href="#plot-1a" id="toc-plot-1a" class="nav-link" data-scroll-target="#plot-1a">Plot 1a</a></li>
  <li><a href="#plot-1b" id="toc-plot-1b" class="nav-link" data-scroll-target="#plot-1b">Plot 1b</a></li>
  <li><a href="#plot-2a" id="toc-plot-2a" class="nav-link" data-scroll-target="#plot-2a">Plot 2a</a></li>
  <li><a href="#median-insights" id="toc-median-insights" class="nav-link" data-scroll-target="#median-insights">Median Insights</a></li>
  <li><a href="#plot-2b" id="toc-plot-2b" class="nav-link" data-scroll-target="#plot-2b">Plot 2b</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  </ul></li>
  <li><a href="#question-2" id="toc-question-2" class="nav-link" data-scroll-target="#question-2">Question 2</a>
  <ul class="collapse">
  <li><a href="#description-of-analysis-1" id="toc-description-of-analysis-1" class="nav-link" data-scroll-target="#description-of-analysis-1">Description of Analysis</a></li>
  <li><a href="#plot-1" id="toc-plot-1" class="nav-link" data-scroll-target="#plot-1">Plot 1</a></li>
  <li><a href="#plot-2" id="toc-plot-2" class="nav-link" data-scroll-target="#plot-2">Plot 2</a></li>
  <li><a href="#plot-3" id="toc-plot-3" class="nav-link" data-scroll-target="#plot-3">Plot 3</a></li>
  <li><a href="#discussion-1" id="toc-discussion-1" class="nav-link" data-scroll-target="#discussion-1">Discussion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Analysis and Visualization of Police Shootings in the United States</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">INFO 526 - Final Project</p>
</div>

<div>
  <div class="description">
    This project aims to comprehensively analyze fatal police shootings in the United States, delving into the underlying factors and motivations driving these tragic events.
  </div>
</div>

<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">RoboCops - Peter, Sachin, Arun, Surajit, Christian, Valerie </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            School of Information, University of Arizona
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in the datasets</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>fatality <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/PoliceKillingsUS.csv"</span>, <span class="at">na.strings =</span> <span class="st">""</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>median_income <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/MedianHouseholdIncome2015.csv"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>poverty_perc <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/PercentagePeopleBelowPovertyLevel.csv"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>hs_perc <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/PercentOver25CompletedHighSchool.csv"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>race_perc <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/ShareRaceByCity.csv"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>city_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/us-cities-top-1k-multi-year.csv"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>state_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/Population_Estimate_data_Statewise_2010-2023.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode Fatality NA</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>fatality <span class="ot">&lt;-</span> fatality <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">race =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">%in%</span> <span class="st">"A"</span> <span class="sc">~</span> <span class="st">"Asian"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">%in%</span> <span class="st">"B"</span> <span class="sc">~</span> <span class="st">"Black"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">%in%</span> <span class="st">"H"</span> <span class="sc">~</span> <span class="st">"Hispanic"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">%in%</span> <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"Native American"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">%in%</span> <span class="st">"O"</span> <span class="sc">~</span> <span class="st">"Other"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">%in%</span> <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"White"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(race) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Unknown"</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> race</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode non-numeric values as "", remove NA</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>median_income <span class="ot">&lt;-</span> median_income <span class="sc">|&gt;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Median.Income =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>      Median.Income <span class="sc">%in%</span> <span class="st">"-"</span> <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>      Median.Income <span class="sc">%in%</span> <span class="st">"(X)"</span> <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> Median.Income</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>median_income<span class="sc">$</span>Median.Income <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(median_income<span class="sc">$</span>Median.Income)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>median_income <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(median_income)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean race data</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>race_perc[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc[,<span class="dv">3</span>])</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>race_perc[,<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc[,<span class="dv">4</span>])</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>race_perc[,<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc[,<span class="dv">5</span>])</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>race_perc[,<span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc[,<span class="dv">6</span>])</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>race_perc[,<span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc[,<span class="dv">7</span>])</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(race_perc) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Geographic.Area"</span>, <span class="st">"City"</span>,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"White"</span>, <span class="st">"Black"</span>, <span class="st">"Native"</span>, <span class="st">"Asian"</span>, <span class="st">"Hispanic"</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the state abbreviations to full name</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>state_pop <span class="ot">&lt;-</span> state_pop <span class="sc">|&gt;</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">STATE =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Alabama"</span> <span class="sc">~</span> <span class="st">"AL"</span>,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Alaska"</span> <span class="sc">~</span> <span class="st">"AK"</span>,</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Arizona"</span> <span class="sc">~</span> <span class="st">"AZ"</span>,</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Arkansas"</span> <span class="sc">~</span> <span class="st">"AR"</span>,</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"California"</span> <span class="sc">~</span> <span class="st">"CA"</span>,</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Colorado"</span> <span class="sc">~</span> <span class="st">"CO"</span>,</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Connecticut"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Delaware"</span> <span class="sc">~</span> <span class="st">"DE"</span>,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"District of Columbia"</span> <span class="sc">~</span> <span class="st">"DC"</span>,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Florida"</span> <span class="sc">~</span> <span class="st">"FL"</span>,</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Georgia"</span> <span class="sc">~</span> <span class="st">"GA"</span>,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Hawaii"</span> <span class="sc">~</span> <span class="st">"HI"</span>,</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Idaho"</span> <span class="sc">~</span> <span class="st">"ID"</span>,</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Illinois"</span> <span class="sc">~</span> <span class="st">"IL"</span>,</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Indiana"</span> <span class="sc">~</span> <span class="st">"IN"</span>,</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Iowa"</span> <span class="sc">~</span> <span class="st">"IA"</span>,</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Kansas"</span> <span class="sc">~</span> <span class="st">"KS"</span>,</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Kentucky"</span> <span class="sc">~</span> <span class="st">"KY"</span>,</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Louisiana"</span> <span class="sc">~</span> <span class="st">"LA"</span>,</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Maine"</span> <span class="sc">~</span> <span class="st">"ME"</span>,</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Maryland"</span> <span class="sc">~</span> <span class="st">"MD"</span>,</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Massachusetts"</span> <span class="sc">~</span> <span class="st">"MA"</span>,</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Michigan"</span> <span class="sc">~</span> <span class="st">"MI"</span>,</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Minnesota"</span> <span class="sc">~</span> <span class="st">"MN"</span>,</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Mississipi"</span> <span class="sc">~</span> <span class="st">"MS"</span>,</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Missouri"</span> <span class="sc">~</span> <span class="st">"MO"</span>,</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Montana"</span> <span class="sc">~</span> <span class="st">"MT"</span>,</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Nebraska"</span> <span class="sc">~</span> <span class="st">"NE"</span>,</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Nevada"</span> <span class="sc">~</span> <span class="st">"NV"</span>,</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"New Hampshire"</span> <span class="sc">~</span> <span class="st">"NH"</span>,</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"New Jersey"</span> <span class="sc">~</span> <span class="st">"NJ"</span>,</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"New Mexico"</span> <span class="sc">~</span> <span class="st">"NM"</span>,</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"New York"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"North Carolina"</span> <span class="sc">~</span> <span class="st">"NC"</span>,</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"North Dakota"</span> <span class="sc">~</span> <span class="st">"ND"</span>,</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Ohio"</span> <span class="sc">~</span> <span class="st">"OH"</span>,</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Oklahoma"</span> <span class="sc">~</span> <span class="st">"OK"</span>,</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Oregon"</span> <span class="sc">~</span> <span class="st">"OR"</span>,</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Pennsylvania"</span> <span class="sc">~</span> <span class="st">"PA"</span>,</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Puerto Rico"</span> <span class="sc">~</span> <span class="st">"PR"</span>,</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Rhode Island"</span> <span class="sc">~</span> <span class="st">"RI"</span>,</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"South Carolina"</span> <span class="sc">~</span> <span class="st">"SC"</span>,</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"South Dakota"</span> <span class="sc">~</span> <span class="st">"SD"</span>,</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Tennessee"</span> <span class="sc">~</span> <span class="st">"TN"</span>,</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Texas"</span> <span class="sc">~</span> <span class="st">"TX"</span>,</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Utah"</span> <span class="sc">~</span> <span class="st">"UT"</span>,</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Vermont"</span> <span class="sc">~</span> <span class="st">"VT"</span>,</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Virginia"</span> <span class="sc">~</span> <span class="st">"VA"</span>,</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Washington"</span> <span class="sc">~</span> <span class="st">"WA"</span>,</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"West Virginia"</span> <span class="sc">~</span> <span class="st">"WV"</span>,</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Wisconsin"</span> <span class="sc">~</span> <span class="st">"WI"</span>,</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Wyoming"</span> <span class="sc">~</span> <span class="st">"WY"</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Change colnames for easier matching</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(state_pop) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"State"</span>, <span class="fu">colnames</span>(state_pop[<span class="sc">-</span><span class="dv">1</span>]))</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Select State and 2015 column</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>state_pop_2015 <span class="ot">&lt;-</span> state_pop[, <span class="fu">c</span>(<span class="st">"State"</span>, <span class="st">"POPESTIMATE2015"</span>)]</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="co"># City population modify state</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>city_pop <span class="ot">&lt;-</span> city_pop <span class="sc">|&gt;</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">State =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Alabama"</span> <span class="sc">~</span> <span class="st">"AL"</span>,</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Alaska"</span> <span class="sc">~</span> <span class="st">"AK"</span>,</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Arizona"</span> <span class="sc">~</span> <span class="st">"AZ"</span>,</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Arkansas"</span> <span class="sc">~</span> <span class="st">"AR"</span>,</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"California"</span> <span class="sc">~</span> <span class="st">"CA"</span>,</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Colorado"</span> <span class="sc">~</span> <span class="st">"CO"</span>,</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Connecticut"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Delaware"</span> <span class="sc">~</span> <span class="st">"DE"</span>,</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"District of Columbia"</span> <span class="sc">~</span> <span class="st">"DC"</span>,</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Florida"</span> <span class="sc">~</span> <span class="st">"FL"</span>,</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Georgia"</span> <span class="sc">~</span> <span class="st">"GA"</span>,</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Hawaii"</span> <span class="sc">~</span> <span class="st">"HI"</span>,</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Idaho"</span> <span class="sc">~</span> <span class="st">"ID"</span>,</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Illinois"</span> <span class="sc">~</span> <span class="st">"IL"</span>,</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Indiana"</span> <span class="sc">~</span> <span class="st">"IN"</span>,</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Iowa"</span> <span class="sc">~</span> <span class="st">"IA"</span>,</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Kansas"</span> <span class="sc">~</span> <span class="st">"KS"</span>,</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Kentucky"</span> <span class="sc">~</span> <span class="st">"KY"</span>,</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Louisiana"</span> <span class="sc">~</span> <span class="st">"LA"</span>,</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Maine"</span> <span class="sc">~</span> <span class="st">"ME"</span>,</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Maryland"</span> <span class="sc">~</span> <span class="st">"MD"</span>,</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Massachusetts"</span> <span class="sc">~</span> <span class="st">"MA"</span>,</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Michigan"</span> <span class="sc">~</span> <span class="st">"MI"</span>,</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Minnesota"</span> <span class="sc">~</span> <span class="st">"MN"</span>,</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Mississipi"</span> <span class="sc">~</span> <span class="st">"MS"</span>,</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Missouri"</span> <span class="sc">~</span> <span class="st">"MO"</span>,</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Montana"</span> <span class="sc">~</span> <span class="st">"MT"</span>,</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Nebraska"</span> <span class="sc">~</span> <span class="st">"NE"</span>,</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Nevada"</span> <span class="sc">~</span> <span class="st">"NV"</span>,</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"New Hampshire"</span> <span class="sc">~</span> <span class="st">"NH"</span>,</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"New Jersey"</span> <span class="sc">~</span> <span class="st">"NJ"</span>,</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"New Mexico"</span> <span class="sc">~</span> <span class="st">"NM"</span>,</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"New York"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"North Carolina"</span> <span class="sc">~</span> <span class="st">"NC"</span>,</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"North Dakota"</span> <span class="sc">~</span> <span class="st">"ND"</span>,</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Ohio"</span> <span class="sc">~</span> <span class="st">"OH"</span>,</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Oklahoma"</span> <span class="sc">~</span> <span class="st">"OK"</span>,</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Oregon"</span> <span class="sc">~</span> <span class="st">"OR"</span>,</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Pennsylvania"</span> <span class="sc">~</span> <span class="st">"PA"</span>,</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Puerto Rico"</span> <span class="sc">~</span> <span class="st">"PR"</span>,</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Rhode Island"</span> <span class="sc">~</span> <span class="st">"RI"</span>,</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"South Carolina"</span> <span class="sc">~</span> <span class="st">"SC"</span>,</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"South Dakota"</span> <span class="sc">~</span> <span class="st">"SD"</span>,</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Tennessee"</span> <span class="sc">~</span> <span class="st">"TN"</span>,</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Texas"</span> <span class="sc">~</span> <span class="st">"TX"</span>,</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Utah"</span> <span class="sc">~</span> <span class="st">"UT"</span>,</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Vermont"</span> <span class="sc">~</span> <span class="st">"VT"</span>,</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Virginia"</span> <span class="sc">~</span> <span class="st">"VA"</span>,</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Washington"</span> <span class="sc">~</span> <span class="st">"WA"</span>,</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"West Virginia"</span> <span class="sc">~</span> <span class="st">"WV"</span>,</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Wisconsin"</span> <span class="sc">~</span> <span class="st">"WI"</span>,</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Wyoming"</span> <span class="sc">~</span> <span class="st">"WY"</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter city population by 2015</span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>city_pop_2015 <span class="ot">&lt;-</span> city_pop[<span class="fu">which</span>(city_pop<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2015</span>),]</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate supplementary datasets</span></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>supp_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hs_perc, median_income,</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Geographic.Area"</span> , <span class="st">"City"</span>))</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>supp_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(supp_data, poverty_perc,</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Geographic.Area"</span> , <span class="st">"City"</span>))</span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>supp_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(supp_data, race_perc)</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(supp_data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"State"</span>,</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"City"</span>,</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"HSDegree"</span>,</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Median"</span>,</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Poverty"</span>,</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"White"</span>,</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Black"</span>,</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Native"</span>,</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Asian"</span>,</span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Hispanic"</span>)</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>supp_data<span class="sc">$</span>City <span class="ot">&lt;-</span> <span class="fu">iconv</span>(supp_data<span class="sc">$</span>City, <span class="at">to =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove " city" from the Location column</span></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>supp_data<span class="sc">$</span>City <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" city"</span>, <span class="st">""</span>, supp_data<span class="sc">$</span>City)</span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>supp_data<span class="sc">$</span>City <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" town"</span>, <span class="st">""</span>, supp_data<span class="sc">$</span>City)</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>supp_data<span class="sc">$</span>City <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" CDP"</span>, <span class="st">""</span>, supp_data<span class="sc">$</span>City)</span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge supplementary data and state population data</span></span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>supp_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(supp_data, city_pop_2015,</span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"State"</span>, <span class="st">"City"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="abstract" class="level2">
<h2 class="anchored" data-anchor-id="abstract">Abstract</h2>
<p>The objective of this project is to analyze and contextualize police shootings, aiming to understand the underlying reasons and factors contributing to these unfortunate events. Acknowledging the necessity of police interventions for public safety, there has been a concerning uptick of documented unjustified shootings in recent years. We seek to expand the analysis beyond individual cases to explore socioeconomic factors like housing income, poverty rates and population demographics, and uncover correlations and patterns that shed light on the broader societal context.</p>
<p>This will be achieved through the use of data visualizations to contribute to a deeper understanding of police shootings.</p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Police shootings are a sad reality of policing practices that date back decades. While many are justified to protect the lives of innocent civilians, there has been an uptick in recent years of police shooting people whom they perceive to be a threat in the heat of the moment, but are proven innocent after the fact. These shootings can often be hard to analyze because there are many psychological factors that come into play when an officer decides to discharge their weapon, such as their training, the perceived threat, and an officer’s internalized prejudice. Without further information on the psyche of a police officer, the reason why they discharge their weapon cannot be determined. However, their actions and surroundings can be analyzed to provide context into communities and situations that may be more prone to police shootings.</p>
<p>The police shooting data set is sourced from a Kaggle dataset originally created by Karolina Wullum. The dataset consists of shootings from all fifty states and DC, and is supplemented with informations on demographics including as median household income, distribution of race, city population, percent of people below poverty line, and percent of people over 25 who completed high school. The data is from 2015 to 2017.</p>
<p>This analysis aims to understand the dataset on police killings, extending its scope beyond the original focus tracked by the Washington Post. Socioeconomic factors like housing income, poverty rates, and population demographics will be used to understand and contextualize any patterns that appear. The goal is to explore how socioeconomic factors can play into incidents of police violence. The following table represents the variables relevant to the analysis.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Data Type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">id</td>
<td style="text-align: left;">Data ID</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">2535 entries</td>
</tr>
<tr class="even">
<td style="text-align: left;">name</td>
<td style="text-align: left;">Name of deceased</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">Names</td>
</tr>
<tr class="odd">
<td style="text-align: left;">date</td>
<td style="text-align: left;">Date of shooting</td>
<td style="text-align: left;">date</td>
<td style="text-align: left;">dd/mm/yy from 2015-2017</td>
</tr>
<tr class="even">
<td style="text-align: left;">manner_of_death</td>
<td style="text-align: left;">Means of death</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">shot, shot and tasered</td>
</tr>
<tr class="odd">
<td style="text-align: left;">armed</td>
<td style="text-align: left;">Weapon/Tool</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">69 categories</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: left;">Age of deceased</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">6-91 years old</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gender</td>
<td style="text-align: left;">Gender of deceased</td>
<td style="text-align: left;">logical</td>
<td style="text-align: left;">F/M</td>
</tr>
<tr class="even">
<td style="text-align: left;">race</td>
<td style="text-align: left;">Race of deceased</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">A, B, H, N, O, W, Unknown</td>
</tr>
<tr class="odd">
<td style="text-align: left;">city</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">1417 cities</td>
</tr>
<tr class="even">
<td style="text-align: left;">state</td>
<td style="text-align: left;">State</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">State 2 letter abbreviations and DC</td>
</tr>
<tr class="odd">
<td style="text-align: left;">signs_of_mental_illness</td>
<td style="text-align: left;">Sign of mental illness during incident</td>
<td style="text-align: left;">logical</td>
<td style="text-align: left;">True/False</td>
</tr>
<tr class="even">
<td style="text-align: left;">threat_level</td>
<td style="text-align: left;">Deceased's threat level</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">attack, other, undetermined</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flee</td>
<td style="text-align: left;">Method to evade police</td>
<td style="text-align: left;">categorical</td>
<td style="text-align: left;">Car, Foot, Not fleeing, Other</td>
</tr>
<tr class="even">
<td style="text-align: left;">body_camera</td>
<td style="text-align: left;">Reports of police with body camera</td>
<td style="text-align: left;">logical</td>
<td style="text-align: left;">True/False</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Additionally, six .csv files are utilized to provide supplemental demographic data such as poverty levels, percent high school graduates, city and state population, race percentage by city, and median household income.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: census-table</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create columns for data</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>census_data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PercentOver25CompletedHighSchool.csv"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"MedianHouseholdIncome2015.csv"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"PercentagePeopleBelowPovertyLevel.csv"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"ShareRaceByCity.csv"</span>, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Population_Estimate_data_Statewise_2010-2023.csv"</span>, </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"us-cities-top-1k-multi-year.csv"</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>census_desc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Contains the percentage of individuals 25 years and older that are highschool graduates for cities"</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Contains the median income for cities"</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Contains the percentage of the population below poverty for cities"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Contains the demographics for cities"</span>, </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Contains state populations"</span>, </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Contains populations of the top 1000 largest cities in the US"</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>census_n <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">nrow</span>(hs_perc),</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>              <span class="fu">nrow</span>(median_income),</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>              <span class="fu">nrow</span>(poverty_perc),</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>              <span class="fu">nrow</span>(race_perc), </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>              <span class="fu">nrow</span>(state_pop), </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>              <span class="fu">nrow</span>(city_pop))</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind the vectors into a dataframe</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>census_table <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(census_data, census_desc, census_n))</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(census_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Data"</span>, <span class="st">"Description"</span>, <span class="st">"Number of Rows"</span>)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(census_table) <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a nice table with kable</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>my_table <span class="ot">&lt;-</span> <span class="fu">kable</span>(census_table, <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>my_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Data</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Number of Rows</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PercentOver25CompletedHighSchool.csv</td>
<td style="text-align: left;">Contains the percentage of individuals 25 years and older that are highschool graduates for cities</td>
<td style="text-align: left;">29329</td>
</tr>
<tr class="even">
<td style="text-align: left;">MedianHouseholdIncome2015.csv</td>
<td style="text-align: left;">Contains the median income for cities</td>
<td style="text-align: left;">27385</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PercentagePeopleBelowPovertyLevel.csv</td>
<td style="text-align: left;">Contains the percentage of the population below poverty for cities</td>
<td style="text-align: left;">29329</td>
</tr>
<tr class="even">
<td style="text-align: left;">ShareRaceByCity.csv</td>
<td style="text-align: left;">Contains the demographics for cities</td>
<td style="text-align: left;">29268</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Population_Estimate_data_Statewise_2010-2023.csv</td>
<td style="text-align: left;">Contains state populations</td>
<td style="text-align: left;">52</td>
</tr>
<tr class="even">
<td style="text-align: left;">us-cities-top-1k-multi-year.csv</td>
<td style="text-align: left;">Contains populations of the top 1000 largest cities in the US</td>
<td style="text-align: left;">4000</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>By incorporating these additional factors, correlations and patterns can be uncovered that provide insight into the broader societal context surrounding police use of force. Through data visualization and analysis, contributions to a deeper understanding of these issues and support evidence-based policy-making for promoting equity and justice.</p>
</section>
<section id="question-1" class="level2">
<h2 class="anchored" data-anchor-id="question-1">Question 1</h2>
<ol type="1">
<li>How do socioeconomic factors such as median income, poverty rates, and education relate with incidents of police use of force?</li>
</ol>
<section id="description-of-analysis" class="level3">
<h3 class="anchored" data-anchor-id="description-of-analysis">Description of Analysis</h3>
<p>For the bar plot which illustrates the socio-economic backdrop of fatal police encounters is classified meticulously by poverty and education levels. The underlying data, standardized for consistency, undergoes a transformation to quantify both poverty rates and high school completion rates, subsequently binned into quintiles for a granular analysis. The methodology ensures that each bracket spans an equal range of the data, capturing a full spectrum of socio-economic statuses. These brackets are then labeled with intuitive percentage ranges, setting the stage for the ensuing visual assessment. This careful numerical and categorical preparation underpins the creation of two bar charts, which, through the nuanced lens of ggplot2, lay bare the stark contrasts in threat level distributions across different socio-economic strata, painting a telling picture of the intersection between socio-economic factors and lethal police interventions.</p>
<p>For the density ridge plots, the population for each race was calculated from the supplemental datasets by multiplying the 2015 city population estimate with the estimated racial proportion of the city and divided by 100. The police shooting dataset, median income dataset, and the cities race estimates were concatenated according to city and state. The merged data was then subsetted to only include incidents with a median income and race estimates. The first ridge plot, which is organized by the total count of fatalities by race, refactorized the race levels according to the total counts and used a geom_density_ridge() with the median income as the horizontal axis and the race as the vertical axis.</p>
<p>The second density ridge plot, which is organized by the race’s relative proportion of fatalities (ie the number of fatalities divided by the estimated race’s total population). The race’s population estimate was calculated by summing the estimated race’s population for all cities included in the subsetted data. The data race levels were refactorized according to the proportions with Other and Unknown set to the bottom of the plot. Other and Unknown were set to the bottom of the plot since the interest of this analysis is focused on the potential difference in incidence when race is considered.</p>
</section>
<section id="plot-1a" class="level3">
<h3 class="anchored" data-anchor-id="plot-1a">Plot 1a</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># supp_data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>supp_data <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(supp_data)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the column names are correctly formatted before merging</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>fatality<span class="sc">$</span>city <span class="ot">&lt;-</span> <span class="fu">as.character</span>(fatality<span class="sc">$</span>city)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>fatality<span class="sc">$</span>state <span class="ot">&lt;-</span> <span class="fu">as.character</span>(fatality<span class="sc">$</span>state)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>supp_data<span class="sc">$</span>City <span class="ot">&lt;-</span> <span class="fu">as.character</span>(supp_data<span class="sc">$</span>City)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>supp_data<span class="sc">$</span>State <span class="ot">&lt;-</span> <span class="fu">as.character</span>(supp_data<span class="sc">$</span>State)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the main fatality data with the supplementary socio-economic data</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>analysis_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(fatality,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                       supp_data,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by.x =</span> <span class="fu">c</span>(<span class="st">"city"</span>, <span class="st">"state"</span>),</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by.y =</span> <span class="fu">c</span>(<span class="st">"City"</span>, <span class="st">"State"</span>))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Poverty from character to numeric to handle in quantile calculation</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>analysis_data<span class="sc">$</span>Poverty <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(analysis_data<span class="sc">$</span>Poverty))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for NA in Poverty which might disrupt quantile calculation</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(analysis_data<span class="sc">$</span>Poverty))) {</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  analysis_data<span class="sc">$</span>Poverty[<span class="fu">is.na</span>(analysis_data<span class="sc">$</span>Poverty)] <span class="ot">&lt;-</span> <span class="fu">median</span>(analysis_data<span class="sc">$</span>Poverty, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure Poverty is numeric</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>analysis_data<span class="sc">$</span>Poverty <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(analysis_data<span class="sc">$</span>Poverty))</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert HSDegree to numeric, coercing non-numeric values to NA</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>analysis_data<span class="sc">$</span>HSDegree <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(analysis_data<span class="sc">$</span>HSDegree))</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the range for Poverty and HSDegree</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>range_poverty <span class="ot">&lt;-</span> <span class="fu">max</span>(analysis_data<span class="sc">$</span>Poverty, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(analysis_data<span class="sc">$</span>Poverty, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>range_hsdegree <span class="ot">&lt;-</span> <span class="fu">max</span>(analysis_data<span class="sc">$</span>HSDegree, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(analysis_data<span class="sc">$</span>HSDegree, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Define consistent breaks based on the range</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>number_of_brackets <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="co"># For example, 5 equal brackets</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>breaks_poverty <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(analysis_data<span class="sc">$</span>Poverty, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">max</span>(analysis_data<span class="sc">$</span>Poverty, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>                      <span class="at">length.out =</span> number_of_brackets <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>breaks_hsdegree <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(analysis_data<span class="sc">$</span>HSDegree, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">max</span>(analysis_data<span class="sc">$</span>HSDegree, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>                       <span class="at">length.out =</span> number_of_brackets <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create labels based on breaks</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>create_labels <span class="ot">&lt;-</span> <span class="cf">function</span>(breaks) {</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  labels <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(breaks) <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    labels <span class="ot">&lt;-</span> <span class="fu">c</span>(labels, <span class="fu">paste</span>(<span class="fu">formatC</span>(breaks[i], <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">0</span>), <span class="st">"-"</span>, <span class="fu">formatC</span>(breaks[i<span class="sc">+</span><span class="dv">1</span>], <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">0</span>), <span class="st">"%"</span>))</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(labels)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Use these breaks to make the cuts consistent</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>analysis_data<span class="sc">$</span>poverty_bracket <span class="ot">&lt;-</span> <span class="fu">cut</span>(analysis_data<span class="sc">$</span>Poverty,</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">breaks =</span> breaks_poverty,</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">labels =</span> <span class="fu">create_labels</span>(breaks_poverty))</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>analysis_data<span class="sc">$</span>edu_bracket <span class="ot">&lt;-</span> <span class="fu">cut</span>(analysis_data<span class="sc">$</span>HSDegree,</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">breaks =</span> breaks_hsdegree,</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">labels =</span> <span class="fu">create_labels</span>(breaks_hsdegree))</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>analysis_data<span class="sc">$</span>threat_level <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(analysis_data<span class="sc">$</span>threat_level)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting for Poverty Bracket</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>poverty_plot  <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(analysis_data, <span class="fu">aes</span>(<span class="at">x =</span> poverty_bracket, <span class="at">fill =</span> threat_level)) <span class="sc">+</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">'Set3'</span>) <span class="sc">+</span> </span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Threat Levels by Poverty Bracket"</span>,</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Percentage of Population Below Poverty Line"</span>,</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count of Incidents"</span>,</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Threat Level"</span>) <span class="sc">+</span> </span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'right'</span>)  <span class="co"># Adjusted theme settings here</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>poverty_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/Q1-plot1-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-1b" class="level3">
<h3 class="anchored" data-anchor-id="plot-1b">Plot 1b</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting for Educational Bracket</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>education_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(analysis_data, <span class="fu">aes</span>(<span class="at">x =</span> edu_bracket, <span class="at">fill =</span> threat_level)) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">'Set3'</span>) <span class="sc">+</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Threat Levels by High School Pass Rate"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Percentage of Population with High School Degree"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count of Incidents"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Threat Level"</span>) <span class="sc">+</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'right'</span>)  <span class="co"># Adjusted theme settings here</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>education_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/Q1-plot2-1.png" class="img-fluid figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-2a" class="level3">
<h3 class="anchored" data-anchor-id="plot-2a">Plot 2a</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the populations of each population for each city</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>supp_stat <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(supp_data)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>supp_stat <span class="ot">&lt;-</span> supp_stat <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    white_pop <span class="ot">&lt;-</span> White <span class="sc">*</span> Population <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    black_pop <span class="ot">&lt;-</span> Black <span class="sc">*</span> Population <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    native_pop <span class="ot">&lt;-</span> Native <span class="sc">*</span> Population <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    asian_pop <span class="ot">&lt;-</span> Asian <span class="sc">*</span> Population <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    hispanic_pop <span class="ot">&lt;-</span> Hispanic <span class="sc">*</span> Population <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Select specific columns of the supplementary data</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>supp_stat <span class="ot">&lt;-</span> supp_stat[,<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">15</span><span class="sc">:</span><span class="dv">19</span>)]</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(supp_stat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"State"</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"City"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Median"</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"White"</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Black"</span>,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Native"</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Asian"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Hispanic"</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Select specific columns of the fatality data</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>fatality_subset <span class="ot">&lt;-</span> fatality[,<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(fatality_subset) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Race"</span>, <span class="st">"City"</span>, <span class="st">"State"</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge dataset and remove rows with NAs</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(fatality_subset, supp_stat,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>                         <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"State"</span>, <span class="st">"City"</span>))</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(merged_data)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Acquire counts of race:</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Asian = 23, Black = 409, Hispanic = 301, Native American = 13, Other = 17,</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Unknown = 92, White = 466</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>race_count <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(<span class="fu">as.factor</span>(merged_data<span class="sc">$</span>Race)))</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Refactor levels according to the total counts</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>Race <span class="ot">&lt;-</span> <span class="fu">factor</span>(merged_data<span class="sc">$</span>Race,</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Unknown"</span>,</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Other"</span>,</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Native American"</span>,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Asian"</span>,</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Hispanic"</span>,</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Black"</span>,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"White"</span>))</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the density ridge plot (smallest count at the bottom)</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(merged_data, <span class="fu">aes</span>(<span class="at">x =</span> Median, <span class="at">y =</span> Race)) <span class="sc">+</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">"K"</span>)) <span class="sc">+</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">1.2</span>, <span class="at">label =</span> <span class="st">"13"</span>)) <span class="sc">+</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">2.2</span>, <span class="at">label =</span> <span class="st">"17"</span>)) <span class="sc">+</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">3.2</span>, <span class="at">label =</span> <span class="st">"23"</span>)) <span class="sc">+</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">4.2</span>, <span class="at">label =</span> <span class="st">"92"</span>)) <span class="sc">+</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">5.2</span>, <span class="at">label =</span> <span class="st">"301"</span>)) <span class="sc">+</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">6.2</span>, <span class="at">label =</span> <span class="st">"409"</span>)) <span class="sc">+</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">7.2</span>, <span class="at">label =</span> <span class="st">"466"</span>)) <span class="sc">+</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density Plots of Police Shootings"</span>,</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Ordered by descending counts"</span>) <span class="sc">+</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Median Income of City"</span>) <span class="sc">+</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Race"</span>) <span class="sc">+</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/Q1-plot2a-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="median-insights" class="level3">
<h3 class="anchored" data-anchor-id="median-insights">Median Insights</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find distinct city and states and only keep numerical data</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>distinct_city <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(State, City, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Median, White, Black, Native, Asian, Hispanic)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate dataset for geom_smooth</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>distinct_city <span class="ot">&lt;-</span> distinct_city <span class="sc">|&gt;</span> <span class="co"># Find the proportions for each race</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(White<span class="sc">:</span>Hispanic)),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">White =</span> White <span class="sc">/</span> Total,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Black =</span> Black <span class="sc">/</span> Total,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Native =</span> Native <span class="sc">/</span> Total,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Asian =</span> Asian <span class="sc">/</span> Total,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hispanic =</span> Hispanic <span class="sc">/</span> Total</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="co"># Pivot data so race and values are columns</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(White, Black, Native, Asian, Hispanic),</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Race"</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Percent"</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="co"># Create legend column so that races can have colors later</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">case_when</span>(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>      Race <span class="sc">%in%</span> <span class="st">"White"</span> <span class="sc">~</span> <span class="st">"White"</span>,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>      Race <span class="sc">%in%</span> <span class="st">"Black"</span> <span class="sc">~</span> <span class="st">"Black"</span>,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Refactor levels for legends order</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>distinct_city<span class="sc">$</span>legend <span class="ot">&lt;-</span> <span class="fu">factor</span>(distinct_city<span class="sc">$</span>legend,</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Black"</span>, <span class="st">"White"</span>, <span class="st">"Other"</span>))</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate smooth plot</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> distinct_city,</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Median, <span class="at">y =</span> Percent, <span class="at">group =</span> Race, <span class="at">color =</span> legend)) <span class="sc">+</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"grey"</span>)) <span class="sc">+</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">"K"</span>)) <span class="sc">+</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">35000</span>, <span class="dv">75000</span>)) <span class="sc">+</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"City Race Proportions"</span>,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Over city median income"</span>,</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Median Income of City"</span>,</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Proportion of Population"</span>) <span class="sc">+</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Race"</span>)) <span class="sc">+</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/Q1-median-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-2b" class="level3">
<h3 class="anchored" data-anchor-id="plot-2b">Plot 2b</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the race populations</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># White = 135231935, Black = 30170898, Native = 1827873, Asian = 12570851,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Hispanic = 51034800</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>race_pop <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(State, City, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>race_total <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colSums</span>(race_pop[,<span class="dv">5</span><span class="sc">:</span><span class="dv">9</span>]))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion shot for each race:</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Asian:0.000182963</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># race_count[1,1]/race_total[4,1] * 100</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Black: 0.001355611</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># race_count[2,1]/race_total[2,1] * 100</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Hispanic: 0.0005897936</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># race_count[3,1]/race_total[5,1] * 100</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Native: 0.0007112093</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># race_count[4,1]/race_total[3,1] * 100</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co"># White: 0.0003445932</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># race_count[7,1]/race_total[1,1] * 100</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Refactor levels according to the proportions</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>Race <span class="ot">&lt;-</span> <span class="fu">factor</span>(merged_data<span class="sc">$</span>Race,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Unknown"</span>,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Other"</span>,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Asian"</span>,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"White"</span>,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Hispanic"</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Native American"</span>,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Black"</span>))</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the density ridge plot (smallest proportion at the bottom)</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(merged_data, <span class="fu">aes</span>(<span class="at">x =</span> Median, <span class="at">y =</span> Race)) <span class="sc">+</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">"K"</span>)) <span class="sc">+</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">3.2</span>, <span class="at">label =</span> <span class="st">"0.0002%"</span>)) <span class="sc">+</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">4.2</span>, <span class="at">label =</span> <span class="st">"0.0003%"</span>)) <span class="sc">+</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">5.2</span>, <span class="at">label =</span> <span class="st">"0.0006%"</span>)) <span class="sc">+</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">6.2</span>, <span class="at">label =</span> <span class="st">"0.0007%"</span>)) <span class="sc">+</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">7.2</span>, <span class="at">label =</span> <span class="st">"0.0014%"</span>)) <span class="sc">+</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density Plots of Police Shootings"</span>,</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Ordered by descending proportion within race"</span>) <span class="sc">+</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Median Income of City"</span>) <span class="sc">+</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Race"</span>) <span class="sc">+</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/Q1-plot2b-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="discussion" class="level3">
<h3 class="anchored" data-anchor-id="discussion">Discussion</h3>
<p>The above visualizations focus on the distribution of shootings across three demographic categories: median income, percent high school graduates, and poverty level. Plot 1 take takes this further by breaking down the shootings by threat level across poverty level and percent high school graduates. Looking further at Plot 1, two major observations can be made: cities with greater than 75% high school graduates and poverty levels between 18-25% experience the most shootings with roughly half of all incidents showing a threat level of “Attack”, meaning the shooting officer felt their safety was at risk via the suspect. Additionally, most shootings had a threat level of “Attack” or “Other”, and a minority of the shootings are undetermined, meaning most officers recorded a reason for discharging their weapon. These observations suggest that cities with more high school edcuated individuals and a poverty level that is twice the US average will experience more shootings. One explanation for this is very large US cities like New York City and Chicago. These cities have large populations and a large wage gap between class levels, so the high school graduate percentage is supplemented by higher income classes and the poverty level is driven up by lower income classes, and because of the sheer size of these large cities, there are more cases of shootings, even if the rate per count of population is the same as other cities. Additionally, it can be safely assumed that the lower percentages of high school graduate cities are outliers in the dataset.</p>
<p>Plot 2a breaks down these incidents by raw count of victims in each race population, and Plot 2b takes these raw counts and converts them to overall percent of victims per total population of each race. These plots show these representations across the median income of each city where the shooting occured. From these plots, a few insights can be gained. First, most shootings occur in cities where the median income is roughly between $40k - $50k per year, with more shootings at the higher end of that range. Second, out of all races in a given city, white people are shot the most, with the highest raw count. However, when compared to the overal population of each race, black are shot the most, at 0.0014% of the black population being shot, the equivalent of 1 in every 7,143 black people being shot by the police. In contrast, white people have a 0.0003% chance of being shot by the police, or 1 in every 333,334 white people. That means that black people are 47 times more likely to be shot by police, a striking statistic. Finally, the last major observation that can be made is that most native Americans are shot in cities where the median income is roughly $45k per year, based on the large spike at the $45k mark.</p>
</section>
</section>
<section id="question-2" class="level2">
<h2 class="anchored" data-anchor-id="question-2">Question 2</h2>
<ol start="2" type="1">
<li>In what ways do the analyses of hotspot states, hotspot cities, and racial distribution contribute to understanding the intersection of incidents of police use of force across diverse geographic areas?</li>
</ol>
<section id="description-of-analysis-1" class="level3">
<h3 class="anchored" data-anchor-id="description-of-analysis-1">Description of Analysis</h3>
<p>The comprehensive analysis includes three animated plots, each offering a unique perspective on the intersection of incidents of police use of force. The first plot highlights hotspot states, shedding light on regions with elevated rates of such incidents. The second plot zooms in on hotspot cities, providing a closer examination of urban areas experiencing heightened police use of force. Finally, the third plot delves into the racial distribution within these hotspot states, offering insights into how demographics intersect with incidences of police use of force. Together, these visualizations aim to provide a holistic understanding of the complex dynamics at play</p>
<p>The animated plot provides a comprehensive overview of state hotspots throughout 2015, 2016, and 2017. These hotspots are meticulously identified by considering population data and using a critical metric called “shooting intensity.” This intensity measures fatalities per million people, ensuring a fair assessment of states regardless of their population size. To ensure clarity and inclusivity, the visualization employs both U.S. and world maps. Since the U.S. map typically excludes Alaska, a comprehensive approach involves manually incorporating Alaska from the world map and custom annotating it onto the U.S. map for a holistic view. States where shooting intensity exceeds a threshold of 3 are specifically highlighted using geom_label_repel, drawing attention to regions with heightened incidents. Additionally, annotations identify the top three hotspot states, ranked by shooting intensity and total fatalities. This multifaceted approach offers a nuanced understanding of incident frequency and impact, facilitating comprehensive analysis across diverse geographical areas. The process for creating the plot starts with summarizing fatalities across different years and merging this data with state population datasets. Individual datasets are then created for each year (2015, 2016, and 2017) to focus on shooting intensity for each specific year. USA map data plays a crucial role in defining borders for the map visualization. Shooting intensities are calculated by dividing the fatalities count by the population and multiplying by 1,000,000 to obtain a per million population rate. Specific adjustments are made to ensure clear visualization of Alaska’s data on the map. Labels are strategically placed at the center of each state to convey clear information about shooting intensities for each respective year.</p>
<p>The second animated plot provides a detailed portrayal of major city hotspots throughout 2015, 2016, and 2017. These hotspots are identified using the same “shooting intensity” metric as in the previous plot. This intensity measures fatalities per million people, ensuring a consistent evaluation of cities regardless of their population size. To maintain coherence and comprehensiveness, the visualization retains the depiction of states from the previous plot to provide contextual continuity. Cities are marked using geom_point, and those with a high shooting intensity exceeding 28 are further emphasized using geom_label_repel. This approach effectively highlights cities within states that exhibit significantly higher shooting intensity, contributing to a nuanced understanding of localized dynamics within broader geographical contexts. This layered depiction elucidates the presence of cities with heightened incidents within states with relatively lower overall intensity. The process for creating the plot starts with summarizing fatalities across different years, similar to plot 1. Individual datasets are then created for each year (2015, 2016, and 2017), and shooting intensities are calculated by dividing the fatalities count by the population and multiplying by 1,000,000 to obtain a per million population rate. The use of USA map data is crucial in defining boundaries for the map visualization, bringing the visualization to life.</p>
<p>For the final animated plot</p>
</section>
<section id="plot-1" class="level3">
<h3 class="anchored" data-anchor-id="plot-1">Plot 1</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating state_abbreviations dataframe</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>state_abbreviations <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Alabama"</span> <span class="ot">=</span> <span class="st">"AL"</span>, <span class="st">"Alaska"</span> <span class="ot">=</span> <span class="st">"AK"</span>, </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Arizona"</span> <span class="ot">=</span> <span class="st">"AZ"</span>, <span class="st">"Arkansas"</span> <span class="ot">=</span> <span class="st">"AR"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span> <span class="ot">=</span> <span class="st">"CA"</span>, <span class="st">"Colorado"</span> <span class="ot">=</span> <span class="st">"CO"</span>, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Connecticut"</span> <span class="ot">=</span> <span class="st">"CT"</span>, <span class="st">"Delaware"</span> <span class="ot">=</span> <span class="st">"DE"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"District of Columbia"</span> <span class="ot">=</span> <span class="st">"DC"</span>, <span class="st">"Florida"</span> <span class="ot">=</span> <span class="st">"FL"</span>, </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Georgia"</span> <span class="ot">=</span> <span class="st">"GA"</span>, <span class="st">"Hawaii"</span> <span class="ot">=</span> <span class="st">"HI"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Idaho"</span> <span class="ot">=</span> <span class="st">"ID"</span>, <span class="st">"Illinois"</span> <span class="ot">=</span> <span class="st">"IL"</span>, <span class="st">"Indiana"</span> <span class="ot">=</span> <span class="st">"IN"</span>, </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Iowa"</span> <span class="ot">=</span> <span class="st">"IA"</span>, <span class="st">"Kansas"</span> <span class="ot">=</span> <span class="st">"KS"</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Kentucky"</span> <span class="ot">=</span> <span class="st">"KY"</span>, <span class="st">"Louisiana"</span> <span class="ot">=</span> <span class="st">"LA"</span>, </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Maine"</span> <span class="ot">=</span> <span class="st">"ME"</span>, <span class="st">"Maryland"</span> <span class="ot">=</span> <span class="st">"MD"</span>, </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span> <span class="ot">=</span> <span class="st">"MA"</span>, <span class="st">"Michigan"</span> <span class="ot">=</span> <span class="st">"MI"</span>, </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Minnesota"</span> <span class="ot">=</span> <span class="st">"MN"</span>, <span class="st">"Mississippi"</span> <span class="ot">=</span> <span class="st">"MS"</span>, </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Missouri"</span> <span class="ot">=</span> <span class="st">"MO"</span>, <span class="st">"Montana"</span> <span class="ot">=</span> <span class="st">"MT"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Nebraska"</span> <span class="ot">=</span> <span class="st">"NE"</span>, <span class="st">"Nevada"</span> <span class="ot">=</span> <span class="st">"NV"</span>, </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New Hampshire"</span> <span class="ot">=</span> <span class="st">"NH"</span>, <span class="st">"New Jersey"</span> <span class="ot">=</span> <span class="st">"NJ"</span>, </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New Mexico"</span> <span class="ot">=</span> <span class="st">"NM"</span>, <span class="st">"New York"</span> <span class="ot">=</span> <span class="st">"NY"</span>, </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"North Carolina"</span> <span class="ot">=</span> <span class="st">"NC"</span>, <span class="st">"North Dakota"</span> <span class="ot">=</span> <span class="st">"ND"</span>, </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ohio"</span> <span class="ot">=</span> <span class="st">"OH"</span>, <span class="st">"Oklahoma"</span> <span class="ot">=</span> <span class="st">"OK"</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Oregon"</span> <span class="ot">=</span> <span class="st">"OR"</span>, <span class="st">"Pennsylvania"</span> <span class="ot">=</span> <span class="st">"PA"</span>, </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Rhode Island"</span> <span class="ot">=</span> <span class="st">"RI"</span>, <span class="st">"South Carolina"</span> <span class="ot">=</span> <span class="st">"SC"</span>, </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"South Dakota"</span> <span class="ot">=</span> <span class="st">"SD"</span>, <span class="st">"Tennessee"</span> <span class="ot">=</span> <span class="st">"TN"</span>, </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span> <span class="ot">=</span> <span class="st">"TX"</span>, <span class="st">"Utah"</span> <span class="ot">=</span> <span class="st">"UT"</span>, </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Vermont"</span> <span class="ot">=</span> <span class="st">"VT"</span>, <span class="st">"Virginia"</span> <span class="ot">=</span> <span class="st">"VA"</span>, <span class="st">"Washington"</span> <span class="ot">=</span> <span class="st">"WA"</span>,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"West Virginia"</span> <span class="ot">=</span> <span class="st">"WV"</span>, <span class="st">"Wisconsin"</span> <span class="ot">=</span> <span class="st">"WI"</span>, <span class="st">"Wyoming"</span> <span class="ot">=</span> <span class="st">"WY"</span>, <span class="st">"Puerto Rico"</span> <span class="ot">=</span> <span class="st">"PR"</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>state_abbreviations_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">STATE =</span> <span class="fu">names</span>(state_abbreviations), <span class="at">state =</span> state_abbreviations, <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Fatalaties Summaries by Year</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>fatality_summaries_year <span class="ot">&lt;-</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  fatality <span class="sc">|&gt;</span> </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(fatality<span class="sc">$</span>date,<span class="at">format =</span> <span class="st">"%d/%m/%y"</span>))</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state,year) <span class="sc">|&gt;</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fatalities_count =</span> <span class="fu">n</span>() , <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading State Population dataset</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>state_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/Population_Estimate_data_Statewise_2010-2023.csv"</span>)</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating a long format State Population dataframe</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>state_pop_updated <span class="ot">&lt;-</span> </span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(state_pop,state_abbreviations_df) <span class="sc">|&gt;</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"POP"</span>),</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"popuplation"</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2010"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/10"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2011"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/11"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2012"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/12"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2013"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/13"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2014"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/14"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2015"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/15"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2016"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/16"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2017"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/17"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2018"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/18"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2019"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/19"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2020"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/20"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2021"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/21"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2022"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/22"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2023"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/23"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging Fatalaties Summaries by Year with State Population</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>fatalities_population <span class="ot">&lt;-</span> <span class="fu">merge</span>(fatality_summaries_year,state_pop_updated)</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating an individual fatalaties population wise dataset along with shooting intensity column - Year wise</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>fatalities_population_2015 <span class="ot">&lt;-</span> fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>popuplation)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(STATE)</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2015</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>fatalities_population_2016 <span class="ot">&lt;-</span> fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>popuplation)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(STATE)</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2016</span></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>fatalities_population_2017 <span class="ot">&lt;-</span> fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>popuplation)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(STATE)</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2017</span></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading USA MAP</span></span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>us_map_data <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading World Map and Subsetting Alaska</span></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>alaska <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"world"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">==</span> <span class="st">"USA"</span> <span class="sc">&amp;</span> (subregion <span class="sc">==</span> <span class="st">"Alaska"</span> ) </span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(subregion),</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">order =</span> <span class="fu">max</span>(us_map_data<span class="sc">$</span>order) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>    long <span class="sc">&lt;</span> <span class="dv">0</span></span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Year Wise Map data frame from the fatalies dataset </span></span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>merge_2015_us <span class="ot">&lt;-</span> <span class="fu">full_join</span>(us_map_data,</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">subset</span>(fatalities_population_2015,</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">!</span>(fatalities_population_2015<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span> <span class="sc">|</span></span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>                                      fatalities_population_2015<span class="sc">$</span>region<span class="sc">==</span><span class="st">"hawaii"</span>)))</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>merge_2015_alaska <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(alaska,fatalities_population_2015)</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>merge_2016_us <span class="ot">&lt;-</span> <span class="fu">full_join</span>(us_map_data,</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">subset</span>(fatalities_population_2016,</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">!</span>(fatalities_population_2016<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span> <span class="sc">|</span></span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>                                      fatalities_population_2016<span class="sc">$</span>region<span class="sc">==</span><span class="st">"hawaii"</span>)))</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>merge_2016_alaska <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(alaska,fatalities_population_2016)</span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>merge_2017_us <span class="ot">&lt;-</span> <span class="fu">full_join</span>(us_map_data,</span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">subset</span>(fatalities_population_2017,</span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">!</span>(fatalities_population_2017<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span> <span class="sc">|</span></span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>                                      fatalities_population_2017<span class="sc">$</span>region<span class="sc">==</span><span class="st">"hawaii"</span>)))</span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>merge_2017_alaska <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(alaska,fatalities_population_2017)</span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating District of Columbia Lat Long Manually</span></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a>dc_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">long =</span> <span class="sc">-</span><span class="fl">77.0369</span>,  <span class="co"># Longitude for Washington, D.C.</span></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lat =</span> <span class="fl">38.9072</span>,    <span class="co"># Latitude for Washington, D.C.</span></span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>                     <span class="at">state =</span> <span class="st">"District of Columbia"</span>,</span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>                     <span class="at">region =</span> <span class="fu">tolower</span>(<span class="st">"District of Columbia"</span>))</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Labels data frame to map the labels at the centre of each state with state name and intensity</span></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>label_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">long =</span> state.center<span class="sc">$</span>x,</span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lat =</span> state.center<span class="sc">$</span>y,</span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>                         <span class="at">state =</span> state.name) <span class="sc">|&gt;</span></span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(state)</span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>label_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(label_data, dc_row)</span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating each year intensity information in columns</span></span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a>label_data <span class="ot">&lt;-</span> <span class="fu">full_join</span>(label_data,fatalities_population_2015, <span class="at">by =</span> <span class="st">"region"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(long, lat, region, STATE,intensity) <span class="sc">|&gt;</span></span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity_2015 =</span> intensity)</span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a>label_data <span class="ot">&lt;-</span> <span class="fu">full_join</span>(label_data,fatalities_population_2016, <span class="at">by =</span> <span class="st">"region"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(long, lat, region, STATE.x,intensity_2015, intensity) <span class="sc">|&gt;</span></span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity_2016 =</span> intensity,</span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a>    <span class="at">STATE =</span> STATE.x)</span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a>label_data <span class="ot">&lt;-</span> <span class="fu">full_join</span>(label_data,fatalities_population_2017, <span class="at">by =</span> <span class="st">"region"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(long, lat,region, STATE.x,intensity_2015,intensity_2016, intensity) <span class="sc">|&gt;</span></span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity_2017 =</span> intensity,</span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a>    <span class="at">STATE =</span> STATE.x) <span class="sc">|&gt;</span></span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity_2017_up =</span> intensity_2017<span class="sc">*</span><span class="fl">1.75</span></span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Alaka Label information separately</span></span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a>alaska_label <span class="ot">&lt;-</span> label_data <span class="sc">|&gt;</span></span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>    STATE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Alaska"</span>)</span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a>    <span class="at">long =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">==</span> <span class="st">"Alaska"</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">150</span>,</span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">!=</span> <span class="st">"Alaska"</span> <span class="sc">~</span> long</span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">==</span> <span class="st">"Alaska"</span> <span class="sc">~</span> <span class="dv">65</span>,</span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">!=</span> <span class="st">"Alaska"</span> <span class="sc">~</span> lat</span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing Alaska from label_data as in above alaksa_label is already created</span></span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a>label_data <span class="ot">&lt;-</span>label_data <span class="sc">|&gt;</span></span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>(STATE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Hawaii"</span>, <span class="st">"Alaska"</span>))</span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a>label_data<span class="sc">$</span>STATE[label_data<span class="sc">$</span>region<span class="sc">==</span><span class="st">"rhode island"</span>] <span class="ot">&lt;-</span> <span class="st">"Rhode Island"</span></span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating 2015 Shooting Intensity plot for Alaska which will be annotated in usa map</span></span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2015_alaska,</span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat,<span class="at">group=</span>group), <span class="at">fill =</span> <span class="st">"#e69e91"</span>,</span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2015_alaska<span class="sc">$</span>long, <span class="at">y =</span> merge_2015_alaska<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> alaska_label, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(STATE,<span class="st">":</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity_2015,<span class="dv">1</span>))), <span class="at">size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>))</span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating 2015 Shooting Intensity plot for USA </span></span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a> plot_2015_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2015_us,</span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> intensity),</span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#fee5d9"</span>, <span class="at">high =</span> <span class="st">"#a50f15"</span>, <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"Intensity"</span>) <span class="sc">+</span></span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> label_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intensity_2015 <span class="sc">&gt;</span> <span class="dv">3</span>), <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(STATE,<span class="st">":</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity_2015,<span class="dv">1</span>))), <span class="at">size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2015_us<span class="sc">$</span>long, <span class="at">y =</span> merge_2015_us<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shooting Intensity by State : 2015"</span>,</span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Per Million of Population"</span>,</span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Highlighted states have shooting intensity &gt; 3 : #"</span>, <span class="fu">length</span>(fatalities_population_2015<span class="sc">$</span>intensity[fatalities_population_2015<span class="sc">$</span>intensity<span class="sc">&gt;</span><span class="dv">3</span>]),</span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\n</span><span class="st"> Grey states indicate no fatalties in that year"</span>)</span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a>       <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(plot1),<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">130</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">40</span>) <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">"cm"</span>),</span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">48</span>),</span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">48</span>),</span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">96</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">80</span>),</span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">40</span>)</span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span><span class="dv">80</span>,</span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">45</span>,</span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Top 3 by Shooting Intensity:</span></span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a><span class="st">    1) Wyoming</span></span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a><span class="st">    2) New Mexico</span></span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a><span class="st">    3) Oklahoma"</span>,</span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"italic"</span>,</span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span><span class="dv">70</span>,</span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">30</span>,</span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Top 3 by Total Fatalities:</span></span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a><span class="st">    1) California</span></span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a><span class="st">    2) Texas</span></span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a><span class="st">    3) Florida"</span>,</span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"italic"</span>,</span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating 2016 Shooting Intensity plot for Alaska which will be annotated in usa map</span></span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2016_alaska,</span>
<span id="cb9-266"><a href="#cb9-266" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat,<span class="at">group=</span>group), <span class="at">fill =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb9-267"><a href="#cb9-267" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb9-268"><a href="#cb9-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2016_alaska<span class="sc">$</span>long, <span class="at">y =</span> merge_2016_alaska<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb9-269"><a href="#cb9-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> alaska_label, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(STATE,<span class="st">":</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity_2016,<span class="dv">1</span>))), <span class="at">size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb9-270"><a href="#cb9-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb9-271"><a href="#cb9-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>))</span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating 2016 Shooting Intensity plot for USA </span></span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a>plot_2016_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2016_us,</span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> intensity),</span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#fee5d9"</span>, <span class="at">high =</span> <span class="st">"#a50f15"</span>, <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"Intensity"</span>) <span class="sc">+</span></span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> label_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intensity_2016 <span class="sc">&gt;</span> <span class="dv">3</span>), <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(STATE,<span class="st">":</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity_2016,<span class="dv">1</span>))), <span class="at">size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2016_us<span class="sc">$</span>long, <span class="at">y =</span> merge_2016_us<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shooting Intensity by State : 2016"</span>,</span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Per Million of Population"</span>,</span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Highlighted states have shooting intensity &gt; 3 : #"</span>, <span class="fu">length</span>(fatalities_population_2016<span class="sc">$</span>intensity[fatalities_population_2016<span class="sc">$</span>intensity<span class="sc">&gt;</span><span class="dv">3</span>]),</span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\n</span><span class="st"> Grey states indicate no fatalties in that year"</span>)</span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(plot2),<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">130</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">40</span>) <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">"cm"</span>),</span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">48</span>),</span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">48</span>),</span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">96</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">80</span>),</span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">40</span>)</span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span><span class="dv">80</span>,</span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">45</span>,</span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Top 3 by Shooting Intensity:</span></span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a><span class="st">    1) New Mexico</span></span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a><span class="st">    2) Alaska</span></span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a><span class="st">    3) District of Columbia"</span>,</span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"italic"</span>,</span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span><span class="dv">75</span>,</span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">30</span>,</span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Top 3 by Total Fatalities:</span></span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a><span class="st">    1) California</span></span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a><span class="st">    2) Texas</span></span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a><span class="st">    3) Florida"</span>,</span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"italic"</span>,</span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating 2017 Shooting Intensity plot for Alaska which will be annotated in usa map</span></span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2017_alaska,</span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat,<span class="at">group=</span>group), <span class="at">fill =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2017_alaska<span class="sc">$</span>long, <span class="at">y =</span> merge_2017_alaska<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> alaska_label, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(STATE,<span class="st">":</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity_2017_up,<span class="dv">1</span>))), <span class="at">size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>))</span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating 2017 Shooting Intensity plot for USA </span></span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a>plot_2017_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2017_us,</span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> intensity),</span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#fee5d9"</span>, <span class="at">high =</span> <span class="st">"#a50f15"</span>, <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"Intensity"</span>) <span class="sc">+</span></span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> label_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intensity_2017_up <span class="sc">&gt;</span> <span class="dv">3</span>), <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(STATE,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity_2017_up,<span class="dv">1</span>))), <span class="at">size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2017_us<span class="sc">$</span>long, <span class="at">y =</span> merge_2017_us<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shooting Intensity by State : 2017"</span>,</span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Per Million of Population"</span>,</span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Highlighted states have shooting intensity &gt; 3 : #"</span>, <span class="fu">length</span>(fatalities_population_2017<span class="sc">$</span>intensity[fatalities_population_2017<span class="sc">$</span>intensity<span class="sc">&gt;</span><span class="fl">1.75</span>]),</span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\n</span><span class="st"> data scaled by 1.75 times, original data was till July 2017"</span>,</span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\n</span><span class="st"> Grey states indicate no fatalties in that year"</span>)</span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(plot3),<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">130</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">40</span>) <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb9-355"><a href="#cb9-355" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">"cm"</span>),</span>
<span id="cb9-356"><a href="#cb9-356" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">48</span>),</span>
<span id="cb9-357"><a href="#cb9-357" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">48</span>),</span>
<span id="cb9-358"><a href="#cb9-358" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">96</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb9-359"><a href="#cb9-359" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">80</span>),</span>
<span id="cb9-360"><a href="#cb9-360" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">40</span>)</span>
<span id="cb9-361"><a href="#cb9-361" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb9-362"><a href="#cb9-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb9-363"><a href="#cb9-363" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb9-364"><a href="#cb9-364" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span><span class="dv">80</span>,</span>
<span id="cb9-365"><a href="#cb9-365" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">45</span>,</span>
<span id="cb9-366"><a href="#cb9-366" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Top 3 by Shooting Intensity:</span></span>
<span id="cb9-367"><a href="#cb9-367" aria-hidden="true" tabindex="-1"></a><span class="st">    1) Maine</span></span>
<span id="cb9-368"><a href="#cb9-368" aria-hidden="true" tabindex="-1"></a><span class="st">    2) Alaska</span></span>
<span id="cb9-369"><a href="#cb9-369" aria-hidden="true" tabindex="-1"></a><span class="st">    3) Oklahoma"</span>,</span>
<span id="cb9-370"><a href="#cb9-370" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb9-371"><a href="#cb9-371" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"italic"</span>,</span>
<span id="cb9-372"><a href="#cb9-372" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb9-373"><a href="#cb9-373" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb9-374"><a href="#cb9-374" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb9-375"><a href="#cb9-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb9-376"><a href="#cb9-376" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb9-377"><a href="#cb9-377" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span><span class="dv">75</span>,</span>
<span id="cb9-378"><a href="#cb9-378" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">30</span>,</span>
<span id="cb9-379"><a href="#cb9-379" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Top 3 by Total Fatalities:</span></span>
<span id="cb9-380"><a href="#cb9-380" aria-hidden="true" tabindex="-1"></a><span class="st">    1) California</span></span>
<span id="cb9-381"><a href="#cb9-381" aria-hidden="true" tabindex="-1"></a><span class="st">    2) Texas</span></span>
<span id="cb9-382"><a href="#cb9-382" aria-hidden="true" tabindex="-1"></a><span class="st">    3) Florida"</span>,</span>
<span id="cb9-383"><a href="#cb9-383" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb9-384"><a href="#cb9-384" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"italic"</span>,</span>
<span id="cb9-385"><a href="#cb9-385" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb9-386"><a href="#cb9-386" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb9-387"><a href="#cb9-387" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-388"><a href="#cb9-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-389"><a href="#cb9-389" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating an animation for above map plots with better resolution</span></span>
<span id="cb9-390"><a href="#cb9-390" aria-hidden="true" tabindex="-1"></a>animation<span class="sc">::</span><span class="fu">saveGIF</span>(</span>
<span id="cb9-391"><a href="#cb9-391" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb9-392"><a href="#cb9-392" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(plot_2015_map)</span>
<span id="cb9-393"><a href="#cb9-393" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(plot_2016_map)</span>
<span id="cb9-394"><a href="#cb9-394" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(plot_2017_map)</span>
<span id="cb9-395"><a href="#cb9-395" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb9-396"><a href="#cb9-396" aria-hidden="true" tabindex="-1"></a>  <span class="at">movie.name =</span> <span class="st">"shooting_intensity.gif"</span>,</span>
<span id="cb9-397"><a href="#cb9-397" aria-hidden="true" tabindex="-1"></a>  <span class="at">interval =</span> <span class="dv">4</span>,</span>
<span id="cb9-398"><a href="#cb9-398" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.width =</span> <span class="dv">4800</span>,</span>
<span id="cb9-399"><a href="#cb9-399" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.height =</span> <span class="dv">3000</span>,</span>
<span id="cb9-400"><a href="#cb9-400" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.dev =</span> <span class="st">"png"</span>,</span>
<span id="cb9-401"><a href="#cb9-401" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.type =</span> <span class="st">"cairo"</span>,</span>
<span id="cb9-402"><a href="#cb9-402" aria-hidden="true" tabindex="-1"></a>  <span class="at">res =</span> <span class="dv">200</span>,</span>
<span id="cb9-403"><a href="#cb9-403" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.x =</span> <span class="st">"in"</span>,</span>
<span id="cb9-404"><a href="#cb9-404" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.y =</span> <span class="st">"in"</span>,</span>
<span id="cb9-405"><a href="#cb9-405" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.unit =</span> <span class="st">"in"</span>,</span>
<span id="cb9-406"><a href="#cb9-406" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.bg =</span> <span class="st">"white"</span>,</span>
<span id="cb9-407"><a href="#cb9-407" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.fps =</span> <span class="dv">3</span></span>
<span id="cb9-408"><a href="#cb9-408" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/shooting_intensity.gif" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="plot-2" class="level3">
<h3 class="anchored" data-anchor-id="plot-2">Plot 2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>city_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/us-cities-top-1k-multi-year.csv"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>state_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/Population_Estimate_data_Statewise_2010-2023.csv"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>state_abbreviations <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Alabama"</span> <span class="ot">=</span> <span class="st">"AL"</span>, <span class="st">"Alaska"</span> <span class="ot">=</span> <span class="st">"AK"</span>, <span class="st">"Arizona"</span> <span class="ot">=</span> <span class="st">"AZ"</span>, <span class="st">"Arkansas"</span> <span class="ot">=</span> <span class="st">"AR"</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span> <span class="ot">=</span> <span class="st">"CA"</span>, <span class="st">"Colorado"</span> <span class="ot">=</span> <span class="st">"CO"</span>, <span class="st">"Connecticut"</span> <span class="ot">=</span> <span class="st">"CT"</span>, <span class="st">"Delaware"</span> <span class="ot">=</span> <span class="st">"DE"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"District of Columbia"</span> <span class="ot">=</span> <span class="st">"DC"</span>, <span class="st">"Florida"</span> <span class="ot">=</span> <span class="st">"FL"</span>, <span class="st">"Georgia"</span> <span class="ot">=</span> <span class="st">"GA"</span>, <span class="st">"Hawaii"</span> <span class="ot">=</span> <span class="st">"HI"</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Idaho"</span> <span class="ot">=</span> <span class="st">"ID"</span>, <span class="st">"Illinois"</span> <span class="ot">=</span> <span class="st">"IL"</span>, <span class="st">"Indiana"</span> <span class="ot">=</span> <span class="st">"IN"</span>, <span class="st">"Iowa"</span> <span class="ot">=</span> <span class="st">"IA"</span>, <span class="st">"Kansas"</span> <span class="ot">=</span> <span class="st">"KS"</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Kentucky"</span> <span class="ot">=</span> <span class="st">"KY"</span>, <span class="st">"Louisiana"</span> <span class="ot">=</span> <span class="st">"LA"</span>, <span class="st">"Maine"</span> <span class="ot">=</span> <span class="st">"ME"</span>, <span class="st">"Maryland"</span> <span class="ot">=</span> <span class="st">"MD"</span>, <span class="st">"Massachusetts"</span> <span class="ot">=</span> <span class="st">"MA"</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Michigan"</span> <span class="ot">=</span> <span class="st">"MI"</span>, <span class="st">"Minnesota"</span> <span class="ot">=</span> <span class="st">"MN"</span>, <span class="st">"Mississippi"</span> <span class="ot">=</span> <span class="st">"MS"</span>, <span class="st">"Missouri"</span> <span class="ot">=</span> <span class="st">"MO"</span>, <span class="st">"Montana"</span> <span class="ot">=</span> <span class="st">"MT"</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Nebraska"</span> <span class="ot">=</span> <span class="st">"NE"</span>, <span class="st">"Nevada"</span> <span class="ot">=</span> <span class="st">"NV"</span>, <span class="st">"New Hampshire"</span> <span class="ot">=</span> <span class="st">"NH"</span>, <span class="st">"New Jersey"</span> <span class="ot">=</span> <span class="st">"NJ"</span>, <span class="st">"New Mexico"</span> <span class="ot">=</span> <span class="st">"NM"</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New York"</span> <span class="ot">=</span> <span class="st">"NY"</span>, <span class="st">"North Carolina"</span> <span class="ot">=</span> <span class="st">"NC"</span>, <span class="st">"North Dakota"</span> <span class="ot">=</span> <span class="st">"ND"</span>, <span class="st">"Ohio"</span> <span class="ot">=</span> <span class="st">"OH"</span>, <span class="st">"Oklahoma"</span> <span class="ot">=</span> <span class="st">"OK"</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Oregon"</span> <span class="ot">=</span> <span class="st">"OR"</span>, <span class="st">"Pennsylvania"</span> <span class="ot">=</span> <span class="st">"PA"</span>, <span class="st">"Rhode Island"</span> <span class="ot">=</span> <span class="st">"RI"</span>, <span class="st">"South Carolina"</span> <span class="ot">=</span> <span class="st">"SC"</span>, <span class="st">"South Dakota"</span> <span class="ot">=</span> <span class="st">"SD"</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tennessee"</span> <span class="ot">=</span> <span class="st">"TN"</span>, <span class="st">"Texas"</span> <span class="ot">=</span> <span class="st">"TX"</span>, <span class="st">"Utah"</span> <span class="ot">=</span> <span class="st">"UT"</span>, <span class="st">"Vermont"</span> <span class="ot">=</span> <span class="st">"VT"</span>, <span class="st">"Virginia"</span> <span class="ot">=</span> <span class="st">"VA"</span>, <span class="st">"Washington"</span> <span class="ot">=</span> <span class="st">"WA"</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"West Virginia"</span> <span class="ot">=</span> <span class="st">"WV"</span>, <span class="st">"Wisconsin"</span> <span class="ot">=</span> <span class="st">"WI"</span>, <span class="st">"Wyoming"</span> <span class="ot">=</span> <span class="st">"WY"</span>, <span class="st">"Puerto Rico"</span> <span class="ot">=</span> <span class="st">"PR"</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>state_abbreviations_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">STATE =</span> <span class="fu">names</span>(state_abbreviations),</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">state =</span> state_abbreviations,</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>fatality_summaries_year <span class="ot">&lt;-</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  fatality <span class="sc">|&gt;</span> </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(fatality<span class="sc">$</span>date,<span class="at">format =</span> <span class="st">"%d/%m/%y"</span>))</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state,year) <span class="sc">|&gt;</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fatalities_count =</span> <span class="fu">n</span>() , <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>state_pop_updated <span class="ot">&lt;-</span> </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(state_pop,state_abbreviations_df) <span class="sc">|&gt;</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"POP"</span>),</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"popuplation"</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2010"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/10"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2011"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/11"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2012"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/12"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2013"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/13"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2014"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/14"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2015"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/15"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2016"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/16"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2017"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/17"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2018"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/18"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2019"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/19"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2020"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/20"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2021"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/21"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2022"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/22"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2023"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/23"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>fatalities_population <span class="ot">&lt;-</span> <span class="fu">merge</span>(fatality_summaries_year,state_pop_updated)</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>city_fatality_summaries_year <span class="ot">&lt;-</span> fatality <span class="sc">|&gt;</span> </span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(fatality<span class="sc">$</span>date,<span class="at">format =</span> <span class="st">"%d/%m/%y"</span>))</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state,city,year) <span class="sc">|&gt;</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fatalities_count =</span> <span class="fu">n</span>() , <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>city_fatality_summaries_year1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(city_fatality_summaries_year,</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>                                        city_fatality_summaries_year<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2015</span>)</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>city_fatality_summaries_year2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(city_fatality_summaries_year,</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>                                        city_fatality_summaries_year<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2016</span>)</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>fatality_summaries_year <span class="ot">&lt;-</span> <span class="fu">rbind</span>(city_fatality_summaries_year1,</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>                                 city_fatality_summaries_year2)</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(city_fatality_summaries_year1,city_fatality_summaries_year2)</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>city_fatalities_population <span class="ot">&lt;-</span> <span class="fu">merge</span>(city_fatality_summaries_year,</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>                                    city_pop,</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">by.x =</span> <span class="fu">c</span>(<span class="st">"city"</span>,<span class="st">"year"</span>),</span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">by.y =</span> <span class="fu">c</span>(<span class="st">"City"</span>,<span class="st">"year"</span>))</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a>city_fatalities_population_2015 <span class="ot">&lt;-</span> city_fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>Population)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(State)</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2015</span>,</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>    lon <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">150</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(intensity)) <span class="sc">|&gt;</span> </span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(city, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>city_fatalities_population_2016 <span class="ot">&lt;-</span> city_fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>Population)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(State)</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2016</span></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(intensity)) <span class="sc">|&gt;</span> </span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(city, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>fatalities_population_2015 <span class="ot">&lt;-</span> fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>popuplation)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(STATE)</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2015</span></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>fatalities_population_2016 <span class="ot">&lt;-</span> fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>popuplation)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(STATE)</span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2016</span></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>us_map_data <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a>alaska <span class="ot">&lt;-</span></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_data</span>(<span class="st">"world"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">==</span> <span class="st">"USA"</span> <span class="sc">&amp;</span> (subregion <span class="sc">==</span> <span class="st">"Alaska"</span> ) </span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(subregion),</span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">order =</span> <span class="fu">max</span>(us_map_data<span class="sc">$</span>order) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>    long <span class="sc">&lt;</span> <span class="dv">0</span></span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>merge_2015_us <span class="ot">&lt;-</span> <span class="fu">full_join</span>(us_map_data,</span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">subset</span>(fatalities_population_2015,</span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">!</span>(fatalities_population_2015<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span> <span class="sc">|</span></span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a>                                      fatalities_population_2015<span class="sc">$</span>region<span class="sc">==</span><span class="st">"hawaii"</span>)))</span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>merge_2015_alaska <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(alaska,fatalities_population_2015)</span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a>merge_2016_us <span class="ot">&lt;-</span> <span class="fu">full_join</span>(us_map_data,</span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">subset</span>(fatalities_population_2016,</span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">!</span>(fatalities_population_2016<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span> <span class="sc">|</span></span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>                                      fatalities_population_2016<span class="sc">$</span>region<span class="sc">==</span><span class="st">"hawaii"</span>)))</span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a>merge_2016_alaska <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(alaska,fatalities_population_2016)</span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a>plot1_city <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2015_alaska,</span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat,<span class="at">group=</span>group), <span class="at">fill =</span> <span class="st">"#e69e91"</span>,</span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2015_alaska<span class="sc">$</span>long, <span class="at">y =</span> merge_2015_alaska<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(city_fatalities_population_2015,city_fatalities_population_2015<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span>),<span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y=</span>lat), <span class="at">color =</span> <span class="st">"darkred"</span>)</span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a>map_2015_city <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2015_us,</span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> intensity),</span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#fee5d9"</span>, <span class="at">high =</span> <span class="st">"#a50f15"</span>, <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"State"</span>) <span class="sc">+</span></span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2015_us<span class="sc">$</span>long, <span class="at">y =</span> merge_2015_us<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(plot1_city),<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">130</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">40</span>) <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(city_fatalities_population_2015,city_fatalities_population_2015<span class="sc">$</span>lon<span class="sc">&gt;-</span><span class="dv">140</span>),<span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y=</span>lat, <span class="at">size =</span> intensity),</span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a>                                                                                                         <span class="at">color =</span> <span class="st">"#8B0020"</span>) <span class="sc">+</span></span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> city_fatalities_population_2015 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intensity <span class="sc">&gt;</span> <span class="dv">28</span>), </span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(city,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity,<span class="dv">1</span>))), </span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a>                   <span class="co">#color = "#56007C",</span></span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">"#000000"</span>,</span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nudge_x =</span> <span class="fu">ifelse</span>(city_fatalities_population_2015<span class="sc">$</span>city <span class="sc">==</span> <span class="st">"Oakland"</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nudge_y =</span> <span class="fu">ifelse</span>(city_fatalities_population_2015<span class="sc">$</span>city <span class="sc">==</span> <span class="st">"Oakland"</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size =</span> <span class="fl">3.5</span>, </span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>))) <span class="sc">+</span> </span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shooting Intensity by City : 2015"</span>,</span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Per Million of Population"</span>,</span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="st">"City"</span>,</span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Cities labels are of shooting intensity &gt; 28 </span><span class="sc">\n</span><span class="st"> Grey highlighted states have NO fatalities"</span></span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">"black"</span>), </span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a>    <span class="co">#legend.key.size = unit(4, "cm"),</span></span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb10-193"><a href="#cb10-193" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a>plot2_city <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2016_alaska,</span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat,<span class="at">group=</span>group), <span class="at">fill =</span> <span class="st">"#e69e91"</span>,</span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2016_alaska<span class="sc">$</span>long, <span class="at">y =</span> merge_2016_alaska<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb10-201"><a href="#cb10-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(city_fatalities_population_2016,city_fatalities_population_2016<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span>),<span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y=</span>lat), <span class="at">color =</span> <span class="st">"darkred"</span>)</span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a>map_2016_city <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2016_us,</span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> intensity),</span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#fee5d9"</span>, <span class="at">high =</span> <span class="st">"#a50f15"</span>, <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"State"</span>) <span class="sc">+</span></span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2016_us<span class="sc">$</span>long, <span class="at">y =</span> merge_2016_us<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(plot2_city),<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">130</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">40</span>) <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(city_fatalities_population_2016,city_fatalities_population_2016<span class="sc">$</span>lon<span class="sc">&gt;-</span><span class="dv">140</span>),<span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y=</span>lat, <span class="at">size =</span> intensity),</span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"#8B0020"</span>) <span class="sc">+</span></span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> city_fatalities_population_2016 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intensity <span class="sc">&gt;</span> <span class="dv">28</span>), </span>
<span id="cb10-216"><a href="#cb10-216" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(city,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity,<span class="dv">1</span>))), </span>
<span id="cb10-217"><a href="#cb10-217" aria-hidden="true" tabindex="-1"></a>                   <span class="co">#color = "#56007C",</span></span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">"#000000"</span>,</span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size =</span> <span class="fl">3.5</span>, </span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb10-221"><a href="#cb10-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>))) <span class="sc">+</span> </span>
<span id="cb10-222"><a href="#cb10-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shooting Intensity by City : 2016"</span>,</span>
<span id="cb10-223"><a href="#cb10-223" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Per Million of Population"</span>,</span>
<span id="cb10-224"><a href="#cb10-224" aria-hidden="true" tabindex="-1"></a>       <span class="at">size =</span> <span class="st">"City"</span>,</span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Cities labels are of shooting intensity &gt; 28 </span><span class="sc">\n</span><span class="st"> Grey highlighted states have NO fatalities"</span></span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">"black"</span>), </span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a><span class="co"># explicit</span></span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a>animation<span class="sc">::</span><span class="fu">saveGIF</span>(</span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(map_2015_city)</span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(map_2016_city)</span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a>  <span class="at">movie.name =</span> <span class="st">"shooting_intensity_city.gif"</span>,</span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a>  <span class="at">interval =</span> <span class="dv">4</span>,</span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.width =</span> <span class="dv">1200</span>,</span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.height =</span> <span class="dv">700</span>,</span>
<span id="cb10-245"><a href="#cb10-245" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.dev =</span> <span class="st">"png"</span>,</span>
<span id="cb10-246"><a href="#cb10-246" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.type =</span> <span class="st">"cairo"</span>,</span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a>  <span class="at">res =</span> <span class="dv">300</span>,</span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.x =</span> <span class="st">"in"</span>,</span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.y =</span> <span class="st">"in"</span>,</span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.unit =</span> <span class="st">"in"</span>,</span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.bg =</span> <span class="st">"white"</span>,</span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.fps =</span> <span class="dv">3</span></span>
<span id="cb10-253"><a href="#cb10-253" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/shooting_intensity_city.gif" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="plot-3" class="level3">
<h3 class="anchored" data-anchor-id="plot-3">Plot 3</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>state_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/Population_Estimate_data_Statewise_2010-2023.csv"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>fatality<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(fatality<span class="sc">$</span>date, <span class="at">format =</span> <span class="st">"%d/%m/%y"</span>), <span class="st">"%Y"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by year, state, and race, then count occurrences</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>race_count <span class="ot">&lt;-</span> fatality <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, state, race) <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Spread the 'race' column to create individual columns for each race</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>race_count <span class="ot">&lt;-</span> race_count <span class="sc">|&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> race, <span class="at">value =</span> count, <span class="at">fill =</span> <span class="dv">0</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column for the total count of races in each state and year</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>race_count <span class="ot">&lt;-</span> race_count <span class="sc">|&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Total =</span> <span class="fu">rowSums</span>(<span class="fu">select</span>(., <span class="sc">-</span><span class="fu">c</span>(year, state)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange the data by year and state</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>race_count <span class="ot">&lt;-</span> race_count <span class="sc">|&gt;</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, state)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>race_perc <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/ShareRaceByCity.csv"</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the 'City' column from race_perc dataframe</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>race_perc <span class="ot">&lt;-</span> race_perc <span class="sc">|&gt;</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>City)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert columns to numeric</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>share_white <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc<span class="sc">$</span>share_white)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>share_black <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc<span class="sc">$</span>share_black)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>share_native_american <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc<span class="sc">$</span>share_native_american)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>share_asian <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc<span class="sc">$</span>share_asian)</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>share_hispanic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc<span class="sc">$</span>share_hispanic)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column for the sum of all race percentages</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>sum_race_percentages <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(race_perc[, <span class="fu">c</span>(<span class="st">"share_white"</span>, <span class="st">"share_black"</span>, <span class="st">"share_native_american"</span>, <span class="st">"share_asian"</span>, <span class="st">"share_hispanic"</span>)])</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming race_perc is already loaded as a dataframe</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>race_perc <span class="ot">&lt;-</span> race_perc <span class="sc">|&gt;</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Geographic.area) <span class="sc">|&gt;</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_white =</span> <span class="fu">mean</span>(share_white, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_black =</span> <span class="fu">mean</span>(share_black, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_native_american =</span> <span class="fu">mean</span>(share_native_american, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_asian =</span> <span class="fu">mean</span>(share_asian, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_hispanic =</span> <span class="fu">mean</span>(share_hispanic, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_race_percentages=</span><span class="fu">mean</span>(sum_race_percentages,<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize race percentages</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>race_perc <span class="ot">&lt;-</span> race_perc <span class="sc">|&gt;</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_white =</span> share_white <span class="sc">/</span> sum_race_percentages,</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_black =</span> share_black <span class="sc">/</span> sum_race_percentages,</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_native_american =</span> share_native_american <span class="sc">/</span> sum_race_percentages,</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_asian =</span> share_asian <span class="sc">/</span> sum_race_percentages,</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_hispanic =</span> share_hispanic <span class="sc">/</span> sum_race_percentages</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Recalculate sum_race_percentages</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>sum_race_percentages <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">select</span>(race_perc, <span class="fu">starts_with</span>(<span class="st">"share_"</span>)))</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting desired columns from state_pop</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>state_pop_subset <span class="ot">&lt;-</span> state_pop[, <span class="fu">c</span>(<span class="st">"STATE"</span>,</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"POPESTIMATE2015"</span>,</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"POPESTIMATE2016"</span>,</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"POPESTIMATE2017"</span>)]</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the dataframe to have Year, State, and Population columns</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>state_pop_long <span class="ot">&lt;-</span> state_pop_subset <span class="sc">|&gt;</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"POPESTIMATE2015"</span>, <span class="st">"POPESTIMATE2016"</span>, <span class="st">"POPESTIMATE2017"</span>),</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Year"</span>,</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Population"</span>)</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove "POPESTIMATE" from the Year column</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>state_pop_long <span class="ot">&lt;-</span> state_pop_long <span class="sc">|&gt;</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">str_remove</span>(Year, <span class="st">"POPESTIMATE"</span>))</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Year column to numeric for sorting</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>state_pop_long<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(state_pop_long<span class="sc">$</span>Year)</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the dataframe by Year in ascending order</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>state_pop_long <span class="ot">&lt;-</span> state_pop_long <span class="sc">|&gt;</span></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Year)</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a mapping of state names to state codes</span></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>state_mapping <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Alabama"</span> <span class="ot">=</span> <span class="st">"AL"</span>, <span class="st">"Alaska"</span> <span class="ot">=</span> <span class="st">"AK"</span>, <span class="st">"Arizona"</span> <span class="ot">=</span> <span class="st">"AZ"</span>, <span class="st">"Arkansas"</span> <span class="ot">=</span> <span class="st">"AR"</span>,</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span> <span class="ot">=</span> <span class="st">"CA"</span>, <span class="st">"Colorado"</span> <span class="ot">=</span> <span class="st">"CO"</span>, <span class="st">"Connecticut"</span> <span class="ot">=</span> <span class="st">"CT"</span>, <span class="st">"Delaware"</span> <span class="ot">=</span> <span class="st">"DE"</span>,</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>  <span class="st">"District of Columbia"</span> <span class="ot">=</span> <span class="st">"DC"</span>, <span class="st">"Florida"</span> <span class="ot">=</span> <span class="st">"FL"</span>, <span class="st">"Georgia"</span> <span class="ot">=</span> <span class="st">"GA"</span>, <span class="st">"Hawaii"</span> <span class="ot">=</span> <span class="st">"HI"</span>,</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Idaho"</span> <span class="ot">=</span> <span class="st">"ID"</span>, <span class="st">"Illinois"</span> <span class="ot">=</span> <span class="st">"IL"</span>, <span class="st">"Indiana"</span> <span class="ot">=</span> <span class="st">"IN"</span>, <span class="st">"Iowa"</span> <span class="ot">=</span> <span class="st">"IA"</span>,</span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Kansas"</span> <span class="ot">=</span> <span class="st">"KS"</span>, <span class="st">"Kentucky"</span> <span class="ot">=</span> <span class="st">"KY"</span>, <span class="st">"Louisiana"</span> <span class="ot">=</span> <span class="st">"LA"</span>, <span class="st">"Maine"</span> <span class="ot">=</span> <span class="st">"ME"</span>,</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Maryland"</span> <span class="ot">=</span> <span class="st">"MD"</span>, <span class="st">"Massachusetts"</span> <span class="ot">=</span> <span class="st">"MA"</span>, <span class="st">"Michigan"</span> <span class="ot">=</span> <span class="st">"MI"</span>, <span class="st">"Minnesota"</span> <span class="ot">=</span> <span class="st">"MN"</span>,</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Mississippi"</span> <span class="ot">=</span> <span class="st">"MS"</span>, <span class="st">"Missouri"</span> <span class="ot">=</span> <span class="st">"MO"</span>, <span class="st">"Montana"</span> <span class="ot">=</span> <span class="st">"MT"</span>, <span class="st">"Nebraska"</span> <span class="ot">=</span> <span class="st">"NE"</span>,</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Nevada"</span> <span class="ot">=</span> <span class="st">"NV"</span>, <span class="st">"New Hampshire"</span> <span class="ot">=</span> <span class="st">"NH"</span>, <span class="st">"New Jersey"</span> <span class="ot">=</span> <span class="st">"NJ"</span>, <span class="st">"New Mexico"</span> <span class="ot">=</span> <span class="st">"NM"</span>,</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New York"</span> <span class="ot">=</span> <span class="st">"NY"</span>, <span class="st">"North Carolina"</span> <span class="ot">=</span> <span class="st">"NC"</span>, <span class="st">"North Dakota"</span> <span class="ot">=</span> <span class="st">"ND"</span>, <span class="st">"Ohio"</span> <span class="ot">=</span> <span class="st">"OH"</span>,</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Oklahoma"</span> <span class="ot">=</span> <span class="st">"OK"</span>, <span class="st">"Oregon"</span> <span class="ot">=</span> <span class="st">"OR"</span>, <span class="st">"Pennsylvania"</span> <span class="ot">=</span> <span class="st">"PA"</span>, <span class="st">"Rhode Island"</span> <span class="ot">=</span> <span class="st">"RI"</span>,</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>  <span class="st">"South Carolina"</span> <span class="ot">=</span> <span class="st">"SC"</span>, <span class="st">"South Dakota"</span> <span class="ot">=</span> <span class="st">"SD"</span>, <span class="st">"Tennessee"</span> <span class="ot">=</span> <span class="st">"TN"</span>, <span class="st">"Texas"</span> <span class="ot">=</span> <span class="st">"TX"</span>,</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Utah"</span> <span class="ot">=</span> <span class="st">"UT"</span>, <span class="st">"Vermont"</span> <span class="ot">=</span> <span class="st">"VT"</span>, <span class="st">"Virginia"</span> <span class="ot">=</span> <span class="st">"VA"</span>, <span class="st">"Washington"</span> <span class="ot">=</span> <span class="st">"WA"</span>,</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>  <span class="st">"West Virginia"</span> <span class="ot">=</span> <span class="st">"WV"</span>, <span class="st">"Wisconsin"</span> <span class="ot">=</span> <span class="st">"WI"</span>, <span class="st">"Wyoming"</span> <span class="ot">=</span> <span class="st">"WY"</span>, <span class="st">"Puerto Rico"</span> <span class="ot">=</span> <span class="st">"PR"</span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Add STATE CODE column to state_pop dataframe</span></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>state_pop_long <span class="ot">&lt;-</span> <span class="fu">mutate</span>(state_pop_long, <span class="at">STATE_CODE =</span> state_mapping[STATE])</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Rearrange columns with STATE CODE after STATE</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>state_pop_long <span class="ot">&lt;-</span> state_pop_long <span class="sc">|&gt;</span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(STATE, STATE_CODE, <span class="fu">everything</span>())</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge race_perc and state_pop_long dataframes based on state information</span></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(race_perc, state_pop_long, <span class="at">by.x =</span> <span class="st">"Geographic.area"</span>, <span class="at">by.y =</span> <span class="st">"STATE_CODE"</span>)</span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert race percentage columns to numeric</span></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>percentage_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"share_white"</span>, <span class="st">"share_black"</span>, <span class="st">"share_native_american"</span>, <span class="st">"share_asian"</span>, <span class="st">"share_hispanic"</span>)</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>merged_data[percentage_cols] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(merged_data[percentage_cols], as.numeric)</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">white_population =</span> share_white <span class="sc">*</span> Population,</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">black_population =</span> share_black <span class="sc">*</span> Population,</span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">native_american_population =</span> share_native_american <span class="sc">*</span> Population,</span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">asian_population =</span> share_asian <span class="sc">*</span> Population,</span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_population =</span> share_hispanic <span class="sc">*</span> Population</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the desired columns</span></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Geographic.area, Year, Population, white_population, black_population, </span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>         native_american_population, asian_population, hispanic_population)</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>fatality <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/PoliceKillingsUS.csv"</span>, <span class="at">na.strings =</span> <span class="st">""</span>)</span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>fatality<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(fatality<span class="sc">$</span>date, <span class="at">format =</span> <span class="st">"%d/%m/%y"</span>), <span class="st">"%Y"</span>)</span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only the required columns</span></span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a>fatality <span class="ot">&lt;-</span> fatality <span class="sc">|&gt;</span></span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(race,state,year)</span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot the data wider</span></span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>fatality_spread <span class="ot">&lt;-</span> fatality <span class="sc">|&gt;</span></span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(state, year),</span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> race,</span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> race,</span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fn =</span> length,</span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the racial columns</span></span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a>fatality_spread <span class="ot">&lt;-</span> fatality_spread <span class="sc">|&gt;</span></span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_white =</span> W,</span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_black =</span> B,</span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_native_american =</span> <span class="st">'NA'</span>,</span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_asian =</span> A,</span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_hispanic =</span> H</span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge "N" and "O" columns into "Other" column</span></span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a>fatality_spread <span class="ot">&lt;-</span> fatality_spread <span class="sc">|&gt;</span></span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Other =</span> N <span class="sc">+</span> O) <span class="sc">|&gt;</span></span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>N, <span class="sc">-</span>O)</span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename 'Geographic.area' to 'state' in grouped_merged_data for consistency</span></span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">state =</span> Geographic.area)</span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Year column in grouped_merged_data to character</span></span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.character</span>(Year))</span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform left join</span></span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a>Final_racial_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(merged_data, fatality_spread, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span> <span class="ot">=</span> <span class="st">"state"</span>, <span class="st">"Year"</span> <span class="ot">=</span> <span class="st">"year"</span>))</span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate racial intensity for each racial group</span></span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a>Final_racial_data <span class="ot">&lt;-</span> Final_racial_data <span class="sc">|&gt;</span></span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a>    <span class="at">white_intensity =</span> <span class="fu">round</span>((share_white <span class="sc">/</span> white_population) <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">2</span>),</span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">black_intensity =</span> <span class="fu">round</span>((share_black <span class="sc">/</span> black_population) <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">2</span>),</span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">native_american_intensity =</span> <span class="fu">round</span>((share_native_american <span class="sc">/</span> native_american_population) <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">2</span>),</span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">asian_intensity =</span> <span class="fu">round</span>((share_asian <span class="sc">/</span> asian_population) <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">2</span>),</span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_intensity =</span> <span class="fu">round</span>((share_hispanic <span class="sc">/</span> hispanic_population) <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">2</span>)</span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a template dataframe with all combinations of states and years</span></span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a>template <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">state =</span> <span class="fu">unique</span>(Final_racial_data<span class="sc">$</span>state), </span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Year =</span> <span class="fu">c</span>(<span class="st">"2015"</span>, <span class="st">"2016"</span>, <span class="st">"2017"</span>))</span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the template dataframe with Final_racial_data</span></span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true" tabindex="-1"></a>Final_racial_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(template, Final_racial_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"Year"</span>), <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NA values with 0</span></span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true" tabindex="-1"></a>Final_racial_data[<span class="fu">is.na</span>(Final_racial_data)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder columns to match the original dataframe</span></span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true" tabindex="-1"></a>Final_racial_data <span class="ot">&lt;-</span> Final_racial_data[, <span class="fu">names</span>(Final_racial_data)]</span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the state_mapping_reversed dictionary</span></span>
<span id="cb11-197"><a href="#cb11-197" aria-hidden="true" tabindex="-1"></a>state_mapping_reversed <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb11-198"><a href="#cb11-198" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AL"</span> <span class="ot">=</span> <span class="st">"Alabama"</span>, <span class="st">"AK"</span> <span class="ot">=</span> <span class="st">"Alaska"</span>, <span class="st">"AZ"</span> <span class="ot">=</span> <span class="st">"Arizona"</span>, <span class="st">"AR"</span> <span class="ot">=</span> <span class="st">"Arkansas"</span>,</span>
<span id="cb11-199"><a href="#cb11-199" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CA"</span> <span class="ot">=</span> <span class="st">"California"</span>, <span class="st">"CO"</span> <span class="ot">=</span> <span class="st">"Colorado"</span>, <span class="st">"CT"</span> <span class="ot">=</span> <span class="st">"Connecticut"</span>, <span class="st">"DE"</span> <span class="ot">=</span> <span class="st">"Delaware"</span>,</span>
<span id="cb11-200"><a href="#cb11-200" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DC"</span> <span class="ot">=</span> <span class="st">"District of Columbia"</span>, <span class="st">"FL"</span> <span class="ot">=</span> <span class="st">"Florida"</span>, <span class="st">"GA"</span> <span class="ot">=</span> <span class="st">"Georgia"</span>, <span class="st">"HI"</span> <span class="ot">=</span> <span class="st">"Hawaii"</span>,</span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ID"</span> <span class="ot">=</span> <span class="st">"Idaho"</span>, <span class="st">"IL"</span> <span class="ot">=</span> <span class="st">"Illinois"</span>, <span class="st">"IN"</span> <span class="ot">=</span> <span class="st">"Indiana"</span>, <span class="st">"IA"</span> <span class="ot">=</span> <span class="st">"Iowa"</span>,</span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true" tabindex="-1"></a>  <span class="st">"KS"</span> <span class="ot">=</span> <span class="st">"Kansas"</span>, <span class="st">"KY"</span> <span class="ot">=</span> <span class="st">"Kentucky"</span>, <span class="st">"LA"</span> <span class="ot">=</span> <span class="st">"Louisiana"</span>, <span class="st">"ME"</span> <span class="ot">=</span> <span class="st">"Maine"</span>,</span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MD"</span> <span class="ot">=</span> <span class="st">"Maryland"</span>, <span class="st">"MA"</span> <span class="ot">=</span> <span class="st">"Massachusetts"</span>, <span class="st">"MI"</span> <span class="ot">=</span> <span class="st">"Michigan"</span>, <span class="st">"MN"</span> <span class="ot">=</span> <span class="st">"Minnesota"</span>,</span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MS"</span> <span class="ot">=</span> <span class="st">"Mississippi"</span>, <span class="st">"MO"</span> <span class="ot">=</span> <span class="st">"Missouri"</span>, <span class="st">"MT"</span> <span class="ot">=</span> <span class="st">"Montana"</span>, <span class="st">"NE"</span> <span class="ot">=</span> <span class="st">"Nebraska"</span>,</span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NV"</span> <span class="ot">=</span> <span class="st">"Nevada"</span>, <span class="st">"NH"</span> <span class="ot">=</span> <span class="st">"New Hampshire"</span>, <span class="st">"NJ"</span> <span class="ot">=</span> <span class="st">"New Jersey"</span>, <span class="st">"NM"</span> <span class="ot">=</span> <span class="st">"New Mexico"</span>,</span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NY"</span> <span class="ot">=</span> <span class="st">"New York"</span>, <span class="st">"NC"</span> <span class="ot">=</span> <span class="st">"North Carolina"</span>, <span class="st">"ND"</span> <span class="ot">=</span> <span class="st">"North Dakota"</span>, <span class="st">"OH"</span> <span class="ot">=</span> <span class="st">"Ohio"</span>,</span>
<span id="cb11-207"><a href="#cb11-207" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OK"</span> <span class="ot">=</span> <span class="st">"Oklahoma"</span>, <span class="st">"OR"</span> <span class="ot">=</span> <span class="st">"Oregon"</span>, <span class="st">"PA"</span> <span class="ot">=</span> <span class="st">"Pennsylvania"</span>, <span class="st">"RI"</span> <span class="ot">=</span> <span class="st">"Rhode Island"</span>,</span>
<span id="cb11-208"><a href="#cb11-208" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SC"</span> <span class="ot">=</span> <span class="st">"South Carolina"</span>, <span class="st">"SD"</span> <span class="ot">=</span> <span class="st">"South Dakota"</span>, <span class="st">"TN"</span> <span class="ot">=</span> <span class="st">"Tennessee"</span>, <span class="st">"TX"</span> <span class="ot">=</span> <span class="st">"Texas"</span>,</span>
<span id="cb11-209"><a href="#cb11-209" aria-hidden="true" tabindex="-1"></a>  <span class="st">"UT"</span> <span class="ot">=</span> <span class="st">"Utah"</span>, <span class="st">"VT"</span> <span class="ot">=</span> <span class="st">"Vermont"</span>, <span class="st">"VA"</span> <span class="ot">=</span> <span class="st">"Virginia"</span>, <span class="st">"WA"</span> <span class="ot">=</span> <span class="st">"Washington"</span>,</span>
<span id="cb11-210"><a href="#cb11-210" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WV"</span> <span class="ot">=</span> <span class="st">"West Virginia"</span>, <span class="st">"WI"</span> <span class="ot">=</span> <span class="st">"Wisconsin"</span>, <span class="st">"WY"</span> <span class="ot">=</span> <span class="st">"Wyoming"</span>, <span class="st">"PR"</span> <span class="ot">=</span> <span class="st">"Puerto Rico"</span></span>
<span id="cb11-211"><a href="#cb11-211" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-212"><a href="#cb11-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-213"><a href="#cb11-213" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace values in the state column using state_mapping_reversed</span></span>
<span id="cb11-214"><a href="#cb11-214" aria-hidden="true" tabindex="-1"></a>Final_racial_data<span class="sc">$</span>state <span class="ot">&lt;-</span> state_mapping_reversed[<span class="fu">as.character</span>(Final_racial_data<span class="sc">$</span>state)]</span>
<span id="cb11-215"><a href="#cb11-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-216"><a href="#cb11-216" aria-hidden="true" tabindex="-1"></a><span class="co"># Correcting the use of pivot_longer</span></span>
<span id="cb11-217"><a href="#cb11-217" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> Final_racial_data <span class="sc">|&gt;</span></span>
<span id="cb11-218"><a href="#cb11-218" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-219"><a href="#cb11-219" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(state, Year, <span class="fu">ends_with</span>(<span class="st">"intensity"</span>)) <span class="sc">|&gt;</span>  <span class="co"># Select columns that end with 'intensity' and include state, Year</span></span>
<span id="cb11-220"><a href="#cb11-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb11-221"><a href="#cb11-221" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">"intensity"</span>,<span class="cn">FALSE</span>),  <span class="co"># This selects all columns that end with 'intensity'</span></span>
<span id="cb11-222"><a href="#cb11-222" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"racial_group"</span>,</span>
<span id="cb11-223"><a href="#cb11-223" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"intensity"</span></span>
<span id="cb11-224"><a href="#cb11-224" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb11-225"><a href="#cb11-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(intensity)  <span class="co"># Drop NA values in the intensity column</span></span>
<span id="cb11-226"><a href="#cb11-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-227"><a href="#cb11-227" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove "intensity" from racial_group column</span></span>
<span id="cb11-228"><a href="#cb11-228" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> long_data <span class="sc">|&gt;</span></span>
<span id="cb11-229"><a href="#cb11-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">racial_group =</span> <span class="fu">gsub</span>(<span class="st">"_intensity"</span>, <span class="st">""</span>, racial_group))</span>
<span id="cb11-230"><a href="#cb11-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-231"><a href="#cb11-231" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Year to character</span></span>
<span id="cb11-232"><a href="#cb11-232" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> long_data <span class="sc">|&gt;</span></span>
<span id="cb11-233"><a href="#cb11-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.character</span>(Year))</span>
<span id="cb11-234"><a href="#cb11-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-235"><a href="#cb11-235" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming the rest of the plotting code works, here's how to include the year in the animation</span></span>
<span id="cb11-236"><a href="#cb11-236" aria-hidden="true" tabindex="-1"></a>animated_heatmap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(long_data,</span>
<span id="cb11-237"><a href="#cb11-237" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">str_to_title</span>(racial_group),</span>
<span id="cb11-238"><a href="#cb11-238" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y =</span> state,</span>
<span id="cb11-239"><a href="#cb11-239" aria-hidden="true" tabindex="-1"></a>                               <span class="at">fill =</span> intensity)) <span class="sc">+</span></span>
<span id="cb11-240"><a href="#cb11-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb11-241"><a href="#cb11-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb11-242"><a href="#cb11-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"State vs. Racial Intensity Heatmap: Year {frame_time}"</span>, </span>
<span id="cb11-243"><a href="#cb11-243" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Racial Group"</span>, </span>
<span id="cb11-244"><a href="#cb11-244" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"State"</span>,</span>
<span id="cb11-245"><a href="#cb11-245" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Intensity"</span>) <span class="sc">+</span>  <span class="co"># Set the legend title to "Intensity"</span></span>
<span id="cb11-246"><a href="#cb11-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-247"><a href="#cb11-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>), </span>
<span id="cb11-248"><a href="#cb11-248" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb11-249"><a href="#cb11-249" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb11-250"><a href="#cb11-250" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb11-251"><a href="#cb11-251" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-252"><a href="#cb11-252" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),  <span class="co"># Increase legend title size and make it bold</span></span>
<span id="cb11-253"><a href="#cb11-253" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),  <span class="co"># Increase legend text size</span></span>
<span id="cb11-254"><a href="#cb11-254" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">1.6</span>, <span class="st">"cm"</span>),  <span class="co"># Increase legend key width</span></span>
<span id="cb11-255"><a href="#cb11-255" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">1.6</span>, <span class="st">"cm"</span>)) <span class="sc">+</span>  <span class="co"># Increase legend key height</span></span>
<span id="cb11-256"><a href="#cb11-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_time</span>(<span class="fu">as.integer</span>(Year)) <span class="sc">+</span>  <span class="co"># Ensure 'Year' is treated as an integer</span></span>
<span id="cb11-257"><a href="#cb11-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ease_aes</span>(<span class="st">'linear'</span>)</span>
<span id="cb11-258"><a href="#cb11-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-259"><a href="#cb11-259" aria-hidden="true" tabindex="-1"></a><span class="co"># Render and save the animation</span></span>
<span id="cb11-260"><a href="#cb11-260" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(animated_heatmap, <span class="at">fps =</span> <span class="dv">1</span>, <span class="at">duration =</span> <span class="dv">15</span>, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">800</span>, <span class="at">renderer =</span> <span class="fu">gifski_renderer</span>())</span>
<span id="cb11-261"><a href="#cb11-261" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">"images/racial_intensity_heatmap.gif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/racial_intensity_heatmap.gif" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</section>
<section id="discussion-1" class="level3">
<h3 class="anchored" data-anchor-id="discussion-1">Discussion</h3>
<section id="plot-1-1" class="level4">
<h4 class="anchored" data-anchor-id="plot-1-1">Plot 1</h4>
<p>The map analyzes the shooting intensity across all 50 states in the United States from 2015 to 2017. It visualizes this intensity by color-coding each state based on the number of shootings per million people. States with higher shooting rates are shaded darker, while those with lower rates are lighter. States with no fatalities are marked in gray. Additionally, the map labels the top three states with the highest shooting intensities and total fatalities for each year.</p>
<p>In 2015, Wyoming, New Mexico, and Oklahoma stood out for their high shooting intensities, while California, Texas, and Florida led in total fatalities. The map annotations highlight these top states for both intensity and fatalities.</p>
<p>In 2016, the states with the highest shooting intensities shifted to New Mexico, Alaska, and the District of Columbia, while California, Texas, and Florida maintained the highest fatalities.</p>
<p>By 2017, Maine, Alaska, and Oklahoma had the highest shooting intensities, while California, Texas, and Florida continued to lead in fatalities.</p>
<p>Overall, the visualization illustrates the variation in shooting intensity across states over the three years. While the states with the most fatalities remain consistent, the states with the highest shooting intensities change over time. Notably, New Mexico and Oklahoma consistently appear among the top states for shooting intensity in two out of the three years.</p>
</section>
<section id="plot-2-1" class="level4">
<h4 class="anchored" data-anchor-id="plot-2-1">Plot 2</h4>
<p>This map visualizes police shootings’ intensity and resulting fatalities in major cities across the United States for the years 2015, 2016, and 2017, measured per million of the population. Each dot on the map represents shootings in different cities. Larger dots indicate cities with higher shooting intensities, while smaller dots represent cities with lower shooting intensities. States are also color-coded based on their shooting intensity, with lighter shades for lower intensity and darker shades for higher intensity.</p>
<p>The labels on the map specifically highlight cities with shooting intensities exceeding 28 for that particular year. Notably, Chicago and Los Angeles are consistently among the cities with shootings exceeding this intensity threshold in two out of the three years, indicating their ongoing significance in this regard.</p>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb12" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Analysis and Visualization of Police Shootings in the United States"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "INFO 526 - Final Project"</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> </span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "RoboCops - Peter, Sachin, Arun, Surajit, Christian, Valerie"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations:</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">      - name: "School of Information, University of Arizona"</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "This project aims to comprehensively analyze fatal police shootings in the United States, delving into the underlying factors and motivations driving these tragic events."</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">   html:</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">    embed-resources: true</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-packages</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages here</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(dplyr,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>               ggplot2,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>               ggridges,</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>               scales,</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>               patchwork,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>               stringr,</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>               tidyr,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>               grep,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>               kableExtra,</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>               plotly,</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>               maps,</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>               ggrepel,</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>               animation,</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>               gganimate,</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>               utiles,</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>               RColorBrewer)</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-dataset</span></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in the datasets</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>fatality <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/PoliceKillingsUS.csv"</span>, <span class="at">na.strings =</span> <span class="st">""</span>)</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>median_income <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/MedianHouseholdIncome2015.csv"</span>)</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>poverty_perc <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/PercentagePeopleBelowPovertyLevel.csv"</span>)</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>hs_perc <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/PercentOver25CompletedHighSchool.csv"</span>)</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>race_perc <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/ShareRaceByCity.csv"</span>)</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>city_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/us-cities-top-1k-multi-year.csv"</span>)</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>state_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/Population_Estimate_data_Statewise_2010-2023.csv"</span>)</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-setup</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode Fatality NA</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>fatality <span class="ot">&lt;-</span> fatality <span class="sc">|&gt;</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">race =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">%in%</span> <span class="st">"A"</span> <span class="sc">~</span> <span class="st">"Asian"</span>,</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">%in%</span> <span class="st">"B"</span> <span class="sc">~</span> <span class="st">"Black"</span>,</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">%in%</span> <span class="st">"H"</span> <span class="sc">~</span> <span class="st">"Hispanic"</span>,</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">%in%</span> <span class="st">"N"</span> <span class="sc">~</span> <span class="st">"Native American"</span>,</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">%in%</span> <span class="st">"O"</span> <span class="sc">~</span> <span class="st">"Other"</span>,</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">%in%</span> <span class="st">"W"</span> <span class="sc">~</span> <span class="st">"White"</span>,</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(race) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Unknown"</span>,</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> race</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode non-numeric values as "", remove NA</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>median_income <span class="ot">&lt;-</span> median_income <span class="sc">|&gt;</span></span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">Median.Income =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>      Median.Income <span class="sc">%in%</span> <span class="st">"-"</span> <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>      Median.Income <span class="sc">%in%</span> <span class="st">"(X)"</span> <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> Median.Income</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>median_income<span class="sc">$</span>Median.Income <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(median_income<span class="sc">$</span>Median.Income)</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>median_income <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(median_income)</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean race data</span></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>race_perc[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc[,<span class="dv">3</span>])</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>race_perc[,<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc[,<span class="dv">4</span>])</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>race_perc[,<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc[,<span class="dv">5</span>])</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>race_perc[,<span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc[,<span class="dv">6</span>])</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>race_perc[,<span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc[,<span class="dv">7</span>])</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(race_perc) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Geographic.Area"</span>, <span class="st">"City"</span>,</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"White"</span>, <span class="st">"Black"</span>, <span class="st">"Native"</span>, <span class="st">"Asian"</span>, <span class="st">"Hispanic"</span>)</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the state abbreviations to full name</span></span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>state_pop <span class="ot">&lt;-</span> state_pop <span class="sc">|&gt;</span></span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">STATE =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Alabama"</span> <span class="sc">~</span> <span class="st">"AL"</span>,</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Alaska"</span> <span class="sc">~</span> <span class="st">"AK"</span>,</span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Arizona"</span> <span class="sc">~</span> <span class="st">"AZ"</span>,</span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Arkansas"</span> <span class="sc">~</span> <span class="st">"AR"</span>,</span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"California"</span> <span class="sc">~</span> <span class="st">"CA"</span>,</span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Colorado"</span> <span class="sc">~</span> <span class="st">"CO"</span>,</span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Connecticut"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Delaware"</span> <span class="sc">~</span> <span class="st">"DE"</span>,</span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"District of Columbia"</span> <span class="sc">~</span> <span class="st">"DC"</span>,</span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Florida"</span> <span class="sc">~</span> <span class="st">"FL"</span>,</span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Georgia"</span> <span class="sc">~</span> <span class="st">"GA"</span>,</span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Hawaii"</span> <span class="sc">~</span> <span class="st">"HI"</span>,</span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Idaho"</span> <span class="sc">~</span> <span class="st">"ID"</span>,</span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Illinois"</span> <span class="sc">~</span> <span class="st">"IL"</span>,</span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Indiana"</span> <span class="sc">~</span> <span class="st">"IN"</span>,</span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Iowa"</span> <span class="sc">~</span> <span class="st">"IA"</span>,</span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Kansas"</span> <span class="sc">~</span> <span class="st">"KS"</span>,</span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Kentucky"</span> <span class="sc">~</span> <span class="st">"KY"</span>,</span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Louisiana"</span> <span class="sc">~</span> <span class="st">"LA"</span>,</span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Maine"</span> <span class="sc">~</span> <span class="st">"ME"</span>,</span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Maryland"</span> <span class="sc">~</span> <span class="st">"MD"</span>,</span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Massachusetts"</span> <span class="sc">~</span> <span class="st">"MA"</span>,</span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Michigan"</span> <span class="sc">~</span> <span class="st">"MI"</span>,</span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Minnesota"</span> <span class="sc">~</span> <span class="st">"MN"</span>,</span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Mississipi"</span> <span class="sc">~</span> <span class="st">"MS"</span>,</span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Missouri"</span> <span class="sc">~</span> <span class="st">"MO"</span>,</span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Montana"</span> <span class="sc">~</span> <span class="st">"MT"</span>,</span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Nebraska"</span> <span class="sc">~</span> <span class="st">"NE"</span>,</span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Nevada"</span> <span class="sc">~</span> <span class="st">"NV"</span>,</span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"New Hampshire"</span> <span class="sc">~</span> <span class="st">"NH"</span>,</span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"New Jersey"</span> <span class="sc">~</span> <span class="st">"NJ"</span>,</span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"New Mexico"</span> <span class="sc">~</span> <span class="st">"NM"</span>,</span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"New York"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"North Carolina"</span> <span class="sc">~</span> <span class="st">"NC"</span>,</span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"North Dakota"</span> <span class="sc">~</span> <span class="st">"ND"</span>,</span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Ohio"</span> <span class="sc">~</span> <span class="st">"OH"</span>,</span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Oklahoma"</span> <span class="sc">~</span> <span class="st">"OK"</span>,</span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Oregon"</span> <span class="sc">~</span> <span class="st">"OR"</span>,</span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Pennsylvania"</span> <span class="sc">~</span> <span class="st">"PA"</span>,</span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Puerto Rico"</span> <span class="sc">~</span> <span class="st">"PR"</span>,</span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Rhode Island"</span> <span class="sc">~</span> <span class="st">"RI"</span>,</span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"South Carolina"</span> <span class="sc">~</span> <span class="st">"SC"</span>,</span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"South Dakota"</span> <span class="sc">~</span> <span class="st">"SD"</span>,</span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Tennessee"</span> <span class="sc">~</span> <span class="st">"TN"</span>,</span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Texas"</span> <span class="sc">~</span> <span class="st">"TX"</span>,</span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Utah"</span> <span class="sc">~</span> <span class="st">"UT"</span>,</span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Vermont"</span> <span class="sc">~</span> <span class="st">"VT"</span>,</span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Virginia"</span> <span class="sc">~</span> <span class="st">"VA"</span>,</span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Washington"</span> <span class="sc">~</span> <span class="st">"WA"</span>,</span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"West Virginia"</span> <span class="sc">~</span> <span class="st">"WV"</span>,</span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Wisconsin"</span> <span class="sc">~</span> <span class="st">"WI"</span>,</span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">%in%</span> <span class="st">"Wyoming"</span> <span class="sc">~</span> <span class="st">"WY"</span></span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Change colnames for easier matching</span></span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(state_pop) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"State"</span>, <span class="fu">colnames</span>(state_pop[<span class="sc">-</span><span class="dv">1</span>]))</span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Select State and 2015 column</span></span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a>state_pop_2015 <span class="ot">&lt;-</span> state_pop[, <span class="fu">c</span>(<span class="st">"State"</span>, <span class="st">"POPESTIMATE2015"</span>)]</span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a><span class="co"># City population modify state</span></span>
<span id="cb12-168"><a href="#cb12-168" aria-hidden="true" tabindex="-1"></a>city_pop <span class="ot">&lt;-</span> city_pop <span class="sc">|&gt;</span></span>
<span id="cb12-169"><a href="#cb12-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-170"><a href="#cb12-170" aria-hidden="true" tabindex="-1"></a>    <span class="at">State =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-171"><a href="#cb12-171" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Alabama"</span> <span class="sc">~</span> <span class="st">"AL"</span>,</span>
<span id="cb12-172"><a href="#cb12-172" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Alaska"</span> <span class="sc">~</span> <span class="st">"AK"</span>,</span>
<span id="cb12-173"><a href="#cb12-173" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Arizona"</span> <span class="sc">~</span> <span class="st">"AZ"</span>,</span>
<span id="cb12-174"><a href="#cb12-174" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Arkansas"</span> <span class="sc">~</span> <span class="st">"AR"</span>,</span>
<span id="cb12-175"><a href="#cb12-175" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"California"</span> <span class="sc">~</span> <span class="st">"CA"</span>,</span>
<span id="cb12-176"><a href="#cb12-176" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Colorado"</span> <span class="sc">~</span> <span class="st">"CO"</span>,</span>
<span id="cb12-177"><a href="#cb12-177" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Connecticut"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb12-178"><a href="#cb12-178" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Delaware"</span> <span class="sc">~</span> <span class="st">"DE"</span>,</span>
<span id="cb12-179"><a href="#cb12-179" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"District of Columbia"</span> <span class="sc">~</span> <span class="st">"DC"</span>,</span>
<span id="cb12-180"><a href="#cb12-180" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Florida"</span> <span class="sc">~</span> <span class="st">"FL"</span>,</span>
<span id="cb12-181"><a href="#cb12-181" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Georgia"</span> <span class="sc">~</span> <span class="st">"GA"</span>,</span>
<span id="cb12-182"><a href="#cb12-182" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Hawaii"</span> <span class="sc">~</span> <span class="st">"HI"</span>,</span>
<span id="cb12-183"><a href="#cb12-183" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Idaho"</span> <span class="sc">~</span> <span class="st">"ID"</span>,</span>
<span id="cb12-184"><a href="#cb12-184" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Illinois"</span> <span class="sc">~</span> <span class="st">"IL"</span>,</span>
<span id="cb12-185"><a href="#cb12-185" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Indiana"</span> <span class="sc">~</span> <span class="st">"IN"</span>,</span>
<span id="cb12-186"><a href="#cb12-186" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Iowa"</span> <span class="sc">~</span> <span class="st">"IA"</span>,</span>
<span id="cb12-187"><a href="#cb12-187" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Kansas"</span> <span class="sc">~</span> <span class="st">"KS"</span>,</span>
<span id="cb12-188"><a href="#cb12-188" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Kentucky"</span> <span class="sc">~</span> <span class="st">"KY"</span>,</span>
<span id="cb12-189"><a href="#cb12-189" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Louisiana"</span> <span class="sc">~</span> <span class="st">"LA"</span>,</span>
<span id="cb12-190"><a href="#cb12-190" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Maine"</span> <span class="sc">~</span> <span class="st">"ME"</span>,</span>
<span id="cb12-191"><a href="#cb12-191" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Maryland"</span> <span class="sc">~</span> <span class="st">"MD"</span>,</span>
<span id="cb12-192"><a href="#cb12-192" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Massachusetts"</span> <span class="sc">~</span> <span class="st">"MA"</span>,</span>
<span id="cb12-193"><a href="#cb12-193" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Michigan"</span> <span class="sc">~</span> <span class="st">"MI"</span>,</span>
<span id="cb12-194"><a href="#cb12-194" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Minnesota"</span> <span class="sc">~</span> <span class="st">"MN"</span>,</span>
<span id="cb12-195"><a href="#cb12-195" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Mississipi"</span> <span class="sc">~</span> <span class="st">"MS"</span>,</span>
<span id="cb12-196"><a href="#cb12-196" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Missouri"</span> <span class="sc">~</span> <span class="st">"MO"</span>,</span>
<span id="cb12-197"><a href="#cb12-197" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Montana"</span> <span class="sc">~</span> <span class="st">"MT"</span>,</span>
<span id="cb12-198"><a href="#cb12-198" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Nebraska"</span> <span class="sc">~</span> <span class="st">"NE"</span>,</span>
<span id="cb12-199"><a href="#cb12-199" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Nevada"</span> <span class="sc">~</span> <span class="st">"NV"</span>,</span>
<span id="cb12-200"><a href="#cb12-200" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"New Hampshire"</span> <span class="sc">~</span> <span class="st">"NH"</span>,</span>
<span id="cb12-201"><a href="#cb12-201" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"New Jersey"</span> <span class="sc">~</span> <span class="st">"NJ"</span>,</span>
<span id="cb12-202"><a href="#cb12-202" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"New Mexico"</span> <span class="sc">~</span> <span class="st">"NM"</span>,</span>
<span id="cb12-203"><a href="#cb12-203" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"New York"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb12-204"><a href="#cb12-204" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"North Carolina"</span> <span class="sc">~</span> <span class="st">"NC"</span>,</span>
<span id="cb12-205"><a href="#cb12-205" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"North Dakota"</span> <span class="sc">~</span> <span class="st">"ND"</span>,</span>
<span id="cb12-206"><a href="#cb12-206" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Ohio"</span> <span class="sc">~</span> <span class="st">"OH"</span>,</span>
<span id="cb12-207"><a href="#cb12-207" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Oklahoma"</span> <span class="sc">~</span> <span class="st">"OK"</span>,</span>
<span id="cb12-208"><a href="#cb12-208" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Oregon"</span> <span class="sc">~</span> <span class="st">"OR"</span>,</span>
<span id="cb12-209"><a href="#cb12-209" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Pennsylvania"</span> <span class="sc">~</span> <span class="st">"PA"</span>,</span>
<span id="cb12-210"><a href="#cb12-210" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Puerto Rico"</span> <span class="sc">~</span> <span class="st">"PR"</span>,</span>
<span id="cb12-211"><a href="#cb12-211" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Rhode Island"</span> <span class="sc">~</span> <span class="st">"RI"</span>,</span>
<span id="cb12-212"><a href="#cb12-212" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"South Carolina"</span> <span class="sc">~</span> <span class="st">"SC"</span>,</span>
<span id="cb12-213"><a href="#cb12-213" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"South Dakota"</span> <span class="sc">~</span> <span class="st">"SD"</span>,</span>
<span id="cb12-214"><a href="#cb12-214" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Tennessee"</span> <span class="sc">~</span> <span class="st">"TN"</span>,</span>
<span id="cb12-215"><a href="#cb12-215" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Texas"</span> <span class="sc">~</span> <span class="st">"TX"</span>,</span>
<span id="cb12-216"><a href="#cb12-216" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Utah"</span> <span class="sc">~</span> <span class="st">"UT"</span>,</span>
<span id="cb12-217"><a href="#cb12-217" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Vermont"</span> <span class="sc">~</span> <span class="st">"VT"</span>,</span>
<span id="cb12-218"><a href="#cb12-218" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Virginia"</span> <span class="sc">~</span> <span class="st">"VA"</span>,</span>
<span id="cb12-219"><a href="#cb12-219" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Washington"</span> <span class="sc">~</span> <span class="st">"WA"</span>,</span>
<span id="cb12-220"><a href="#cb12-220" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"West Virginia"</span> <span class="sc">~</span> <span class="st">"WV"</span>,</span>
<span id="cb12-221"><a href="#cb12-221" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Wisconsin"</span> <span class="sc">~</span> <span class="st">"WI"</span>,</span>
<span id="cb12-222"><a href="#cb12-222" aria-hidden="true" tabindex="-1"></a>      State <span class="sc">%in%</span> <span class="st">"Wyoming"</span> <span class="sc">~</span> <span class="st">"WY"</span></span>
<span id="cb12-223"><a href="#cb12-223" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-224"><a href="#cb12-224" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-225"><a href="#cb12-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-226"><a href="#cb12-226" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter city population by 2015</span></span>
<span id="cb12-227"><a href="#cb12-227" aria-hidden="true" tabindex="-1"></a>city_pop_2015 <span class="ot">&lt;-</span> city_pop[<span class="fu">which</span>(city_pop<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2015</span>),]</span>
<span id="cb12-228"><a href="#cb12-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-229"><a href="#cb12-229" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate supplementary datasets</span></span>
<span id="cb12-230"><a href="#cb12-230" aria-hidden="true" tabindex="-1"></a>supp_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(hs_perc, median_income,</span>
<span id="cb12-231"><a href="#cb12-231" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Geographic.Area"</span> , <span class="st">"City"</span>))</span>
<span id="cb12-232"><a href="#cb12-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-233"><a href="#cb12-233" aria-hidden="true" tabindex="-1"></a>supp_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(supp_data, poverty_perc,</span>
<span id="cb12-234"><a href="#cb12-234" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Geographic.Area"</span> , <span class="st">"City"</span>))</span>
<span id="cb12-235"><a href="#cb12-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-236"><a href="#cb12-236" aria-hidden="true" tabindex="-1"></a>supp_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(supp_data, race_perc)</span>
<span id="cb12-237"><a href="#cb12-237" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(supp_data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"State"</span>,</span>
<span id="cb12-238"><a href="#cb12-238" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"City"</span>,</span>
<span id="cb12-239"><a href="#cb12-239" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"HSDegree"</span>,</span>
<span id="cb12-240"><a href="#cb12-240" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Median"</span>,</span>
<span id="cb12-241"><a href="#cb12-241" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Poverty"</span>,</span>
<span id="cb12-242"><a href="#cb12-242" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"White"</span>,</span>
<span id="cb12-243"><a href="#cb12-243" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Black"</span>,</span>
<span id="cb12-244"><a href="#cb12-244" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Native"</span>,</span>
<span id="cb12-245"><a href="#cb12-245" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Asian"</span>,</span>
<span id="cb12-246"><a href="#cb12-246" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Hispanic"</span>)</span>
<span id="cb12-247"><a href="#cb12-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-248"><a href="#cb12-248" aria-hidden="true" tabindex="-1"></a>supp_data<span class="sc">$</span>City <span class="ot">&lt;-</span> <span class="fu">iconv</span>(supp_data<span class="sc">$</span>City, <span class="at">to =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb12-249"><a href="#cb12-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-250"><a href="#cb12-250" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove " city" from the Location column</span></span>
<span id="cb12-251"><a href="#cb12-251" aria-hidden="true" tabindex="-1"></a>supp_data<span class="sc">$</span>City <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" city"</span>, <span class="st">""</span>, supp_data<span class="sc">$</span>City)</span>
<span id="cb12-252"><a href="#cb12-252" aria-hidden="true" tabindex="-1"></a>supp_data<span class="sc">$</span>City <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" town"</span>, <span class="st">""</span>, supp_data<span class="sc">$</span>City)</span>
<span id="cb12-253"><a href="#cb12-253" aria-hidden="true" tabindex="-1"></a>supp_data<span class="sc">$</span>City <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" CDP"</span>, <span class="st">""</span>, supp_data<span class="sc">$</span>City)</span>
<span id="cb12-254"><a href="#cb12-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-255"><a href="#cb12-255" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge supplementary data and state population data</span></span>
<span id="cb12-256"><a href="#cb12-256" aria-hidden="true" tabindex="-1"></a>supp_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(supp_data, city_pop_2015,</span>
<span id="cb12-257"><a href="#cb12-257" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"State"</span>, <span class="st">"City"</span>))</span>
<span id="cb12-258"><a href="#cb12-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-259"><a href="#cb12-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-260"><a href="#cb12-260" aria-hidden="true" tabindex="-1"></a><span class="fu">## Abstract</span></span>
<span id="cb12-261"><a href="#cb12-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-262"><a href="#cb12-262" aria-hidden="true" tabindex="-1"></a>The objective of this project is to analyze and contextualize police shootings, aiming to understand the underlying reasons and factors contributing to these unfortunate events. Acknowledging the necessity of police interventions for public safety, there has been a concerning uptick of documented unjustified shootings in recent years. We seek to expand the analysis beyond individual cases to explore socioeconomic factors like housing income, poverty rates and population demographics, and uncover correlations and patterns that shed light on the broader societal context.</span>
<span id="cb12-263"><a href="#cb12-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-264"><a href="#cb12-264" aria-hidden="true" tabindex="-1"></a>This will be achieved through the use of data visualizations to contribute to a deeper understanding of police shootings.</span>
<span id="cb12-265"><a href="#cb12-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-266"><a href="#cb12-266" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb12-267"><a href="#cb12-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-268"><a href="#cb12-268" aria-hidden="true" tabindex="-1"></a>Police shootings are a sad reality of policing practices that date back decades. While many are justified to protect the lives of innocent civilians, there has been an uptick in recent years of police shooting people whom they perceive to be a threat in the heat of the moment, but are proven innocent after the fact. These shootings can often be hard to analyze because there are many psychological factors that come into play when an officer decides to discharge their weapon, such as their training, the perceived threat, and an officer's internalized prejudice. Without further information on the psyche of a police officer, the reason why they discharge their weapon cannot be determined. However, their actions and surroundings can be analyzed to provide context into communities and situations that may be more prone to police shootings.</span>
<span id="cb12-269"><a href="#cb12-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-270"><a href="#cb12-270" aria-hidden="true" tabindex="-1"></a>The police shooting data set is sourced from a Kaggle dataset originally created by Karolina Wullum. The dataset consists of shootings from all fifty states and DC, and is supplemented with informations on demographics including as median household income, distribution of race, city population, percent of people below poverty line, and percent of people over 25 who completed high school. The data is from 2015 to 2017. </span>
<span id="cb12-271"><a href="#cb12-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-272"><a href="#cb12-272" aria-hidden="true" tabindex="-1"></a>This analysis aims to understand the dataset on police killings, extending its scope beyond the original focus tracked by the Washington Post. Socioeconomic factors like housing income, poverty rates, and population demographics will be used to understand and contextualize any patterns that appear. The goal is to explore how socioeconomic factors can play into incidents of police violence. The following table represents the variables relevant to the analysis.</span>
<span id="cb12-273"><a href="#cb12-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-276"><a href="#cb12-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-277"><a href="#cb12-277" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: dataset-table</span></span>
<span id="cb12-278"><a href="#cb12-278" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb12-279"><a href="#cb12-279" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-280"><a href="#cb12-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-281"><a href="#cb12-281" aria-hidden="true" tabindex="-1"></a><span class="co"># Create columns for data</span></span>
<span id="cb12-282"><a href="#cb12-282" aria-hidden="true" tabindex="-1"></a>fatality_var <span class="ot">&lt;-</span> <span class="fu">colnames</span>(fatality)</span>
<span id="cb12-283"><a href="#cb12-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-284"><a href="#cb12-284" aria-hidden="true" tabindex="-1"></a>fatality_desc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Data ID"</span>,</span>
<span id="cb12-285"><a href="#cb12-285" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Name of deceased"</span>,</span>
<span id="cb12-286"><a href="#cb12-286" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Date of shooting"</span>,</span>
<span id="cb12-287"><a href="#cb12-287" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Means of death"</span>,</span>
<span id="cb12-288"><a href="#cb12-288" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Weapon/Tool"</span>,</span>
<span id="cb12-289"><a href="#cb12-289" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Age of deceased"</span>,</span>
<span id="cb12-290"><a href="#cb12-290" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Gender of deceased"</span>,</span>
<span id="cb12-291"><a href="#cb12-291" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Race of deceased"</span>,</span>
<span id="cb12-292"><a href="#cb12-292" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"City"</span>,</span>
<span id="cb12-293"><a href="#cb12-293" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"State"</span>,</span>
<span id="cb12-294"><a href="#cb12-294" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Sign of mental illness during incident"</span>,</span>
<span id="cb12-295"><a href="#cb12-295" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Deceased's threat level"</span>,</span>
<span id="cb12-296"><a href="#cb12-296" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Method to evade police"</span>,</span>
<span id="cb12-297"><a href="#cb12-297" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"Reports of police with body camera"</span>)</span>
<span id="cb12-298"><a href="#cb12-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-299"><a href="#cb12-299" aria-hidden="true" tabindex="-1"></a>fatality_type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"numeric"</span>,</span>
<span id="cb12-300"><a href="#cb12-300" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"character"</span>,</span>
<span id="cb12-301"><a href="#cb12-301" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"date"</span>,</span>
<span id="cb12-302"><a href="#cb12-302" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"categorical"</span>,</span>
<span id="cb12-303"><a href="#cb12-303" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"categorical"</span>,</span>
<span id="cb12-304"><a href="#cb12-304" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"numeric"</span>,</span>
<span id="cb12-305"><a href="#cb12-305" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"logical"</span>,</span>
<span id="cb12-306"><a href="#cb12-306" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"categorical"</span>,</span>
<span id="cb12-307"><a href="#cb12-307" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"categorical"</span>,</span>
<span id="cb12-308"><a href="#cb12-308" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"categorical"</span>,</span>
<span id="cb12-309"><a href="#cb12-309" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"logical"</span>,</span>
<span id="cb12-310"><a href="#cb12-310" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"categorical"</span>,</span>
<span id="cb12-311"><a href="#cb12-311" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"categorical"</span>,</span>
<span id="cb12-312"><a href="#cb12-312" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"logical"</span>)</span>
<span id="cb12-313"><a href="#cb12-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-314"><a href="#cb12-314" aria-hidden="true" tabindex="-1"></a>fatality_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2535 entries"</span>,</span>
<span id="cb12-315"><a href="#cb12-315" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Names"</span>,</span>
<span id="cb12-316"><a href="#cb12-316" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"dd/mm/yy from 2015-2017"</span>,</span>
<span id="cb12-317"><a href="#cb12-317" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"shot, shot and tasered"</span>,</span>
<span id="cb12-318"><a href="#cb12-318" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"69 categories"</span>,</span>
<span id="cb12-319"><a href="#cb12-319" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"6-91 years old"</span>,</span>
<span id="cb12-320"><a href="#cb12-320" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"F/M"</span>,</span>
<span id="cb12-321"><a href="#cb12-321" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"A, B, H, N, O, W, Unknown"</span>,</span>
<span id="cb12-322"><a href="#cb12-322" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"1417 cities"</span>,</span>
<span id="cb12-323"><a href="#cb12-323" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"State 2 letter abbreviations and DC"</span>,</span>
<span id="cb12-324"><a href="#cb12-324" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"True/False"</span>,</span>
<span id="cb12-325"><a href="#cb12-325" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"attack, other, undetermined"</span>,</span>
<span id="cb12-326"><a href="#cb12-326" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Car, Foot, Not fleeing, Other"</span>,</span>
<span id="cb12-327"><a href="#cb12-327" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"True/False"</span>)</span>
<span id="cb12-328"><a href="#cb12-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-329"><a href="#cb12-329" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind the vectors into a dataframe</span></span>
<span id="cb12-330"><a href="#cb12-330" aria-hidden="true" tabindex="-1"></a>fatality_table <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(fatality_var,</span>
<span id="cb12-331"><a href="#cb12-331" aria-hidden="true" tabindex="-1"></a>                                      fatality_desc,</span>
<span id="cb12-332"><a href="#cb12-332" aria-hidden="true" tabindex="-1"></a>                                      fatality_type,</span>
<span id="cb12-333"><a href="#cb12-333" aria-hidden="true" tabindex="-1"></a>                                     fatality_values))</span>
<span id="cb12-334"><a href="#cb12-334" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(fatality_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Variable"</span>, <span class="st">"Description"</span>, <span class="st">"Data Type"</span>, <span class="st">"Values"</span>)</span>
<span id="cb12-335"><a href="#cb12-335" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(fatality_table) <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)</span>
<span id="cb12-336"><a href="#cb12-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-337"><a href="#cb12-337" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a nice table with kable</span></span>
<span id="cb12-338"><a href="#cb12-338" aria-hidden="true" tabindex="-1"></a>my_table <span class="ot">&lt;-</span> <span class="fu">kable</span>(fatality_table, <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-339"><a href="#cb12-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-340"><a href="#cb12-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-341"><a href="#cb12-341" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the table</span></span>
<span id="cb12-342"><a href="#cb12-342" aria-hidden="true" tabindex="-1"></a>my_table</span>
<span id="cb12-343"><a href="#cb12-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-344"><a href="#cb12-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-345"><a href="#cb12-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-346"><a href="#cb12-346" aria-hidden="true" tabindex="-1"></a>Additionally, six .csv files are utilized to provide supplemental demographic data such as poverty levels, percent high school graduates, city and state population, race percentage by city, and median household income.</span>
<span id="cb12-347"><a href="#cb12-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-350"><a href="#cb12-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-351"><a href="#cb12-351" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: census-table</span></span>
<span id="cb12-352"><a href="#cb12-352" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb12-353"><a href="#cb12-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-354"><a href="#cb12-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-355"><a href="#cb12-355" aria-hidden="true" tabindex="-1"></a><span class="co"># Create columns for data</span></span>
<span id="cb12-356"><a href="#cb12-356" aria-hidden="true" tabindex="-1"></a>census_data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PercentOver25CompletedHighSchool.csv"</span>,</span>
<span id="cb12-357"><a href="#cb12-357" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"MedianHouseholdIncome2015.csv"</span>,</span>
<span id="cb12-358"><a href="#cb12-358" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"PercentagePeopleBelowPovertyLevel.csv"</span>,</span>
<span id="cb12-359"><a href="#cb12-359" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"ShareRaceByCity.csv"</span>, </span>
<span id="cb12-360"><a href="#cb12-360" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Population_Estimate_data_Statewise_2010-2023.csv"</span>, </span>
<span id="cb12-361"><a href="#cb12-361" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"us-cities-top-1k-multi-year.csv"</span>)</span>
<span id="cb12-362"><a href="#cb12-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-363"><a href="#cb12-363" aria-hidden="true" tabindex="-1"></a>census_desc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Contains the percentage of individuals 25 years and older that are highschool graduates for cities"</span>,</span>
<span id="cb12-364"><a href="#cb12-364" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Contains the median income for cities"</span>,</span>
<span id="cb12-365"><a href="#cb12-365" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Contains the percentage of the population below poverty for cities"</span>,</span>
<span id="cb12-366"><a href="#cb12-366" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Contains the demographics for cities"</span>, </span>
<span id="cb12-367"><a href="#cb12-367" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Contains state populations"</span>, </span>
<span id="cb12-368"><a href="#cb12-368" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Contains populations of the top 1000 largest cities in the US"</span>)</span>
<span id="cb12-369"><a href="#cb12-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-370"><a href="#cb12-370" aria-hidden="true" tabindex="-1"></a>census_n <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">nrow</span>(hs_perc),</span>
<span id="cb12-371"><a href="#cb12-371" aria-hidden="true" tabindex="-1"></a>              <span class="fu">nrow</span>(median_income),</span>
<span id="cb12-372"><a href="#cb12-372" aria-hidden="true" tabindex="-1"></a>              <span class="fu">nrow</span>(poverty_perc),</span>
<span id="cb12-373"><a href="#cb12-373" aria-hidden="true" tabindex="-1"></a>              <span class="fu">nrow</span>(race_perc), </span>
<span id="cb12-374"><a href="#cb12-374" aria-hidden="true" tabindex="-1"></a>              <span class="fu">nrow</span>(state_pop), </span>
<span id="cb12-375"><a href="#cb12-375" aria-hidden="true" tabindex="-1"></a>              <span class="fu">nrow</span>(city_pop))</span>
<span id="cb12-376"><a href="#cb12-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-377"><a href="#cb12-377" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind the vectors into a dataframe</span></span>
<span id="cb12-378"><a href="#cb12-378" aria-hidden="true" tabindex="-1"></a>census_table <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(census_data, census_desc, census_n))</span>
<span id="cb12-379"><a href="#cb12-379" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(census_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Data"</span>, <span class="st">"Description"</span>, <span class="st">"Number of Rows"</span>)</span>
<span id="cb12-380"><a href="#cb12-380" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(census_table) <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb12-381"><a href="#cb12-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-382"><a href="#cb12-382" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a nice table with kable</span></span>
<span id="cb12-383"><a href="#cb12-383" aria-hidden="true" tabindex="-1"></a>my_table <span class="ot">&lt;-</span> <span class="fu">kable</span>(census_table, <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-384"><a href="#cb12-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-385"><a href="#cb12-385" aria-hidden="true" tabindex="-1"></a>my_table</span>
<span id="cb12-386"><a href="#cb12-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-387"><a href="#cb12-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-388"><a href="#cb12-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-389"><a href="#cb12-389" aria-hidden="true" tabindex="-1"></a>By incorporating these additional factors, correlations and patterns can be uncovered that provide insight into the broader societal context surrounding police use of force. Through data visualization and analysis, contributions to a deeper understanding of these issues and support evidence-based policy-making for promoting equity and justice.</span>
<span id="cb12-390"><a href="#cb12-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-391"><a href="#cb12-391" aria-hidden="true" tabindex="-1"></a><span class="fu">## Question 1</span></span>
<span id="cb12-392"><a href="#cb12-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-393"><a href="#cb12-393" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>How do socioeconomic factors such as median income, poverty rates, and education relate with incidents of police use of force?</span>
<span id="cb12-394"><a href="#cb12-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-395"><a href="#cb12-395" aria-hidden="true" tabindex="-1"></a><span class="fu">### Description of Analysis</span></span>
<span id="cb12-396"><a href="#cb12-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-397"><a href="#cb12-397" aria-hidden="true" tabindex="-1"></a>For the bar plot which illustrates the socio-economic backdrop of fatal police encounters is classified meticulously by poverty and education levels. The underlying data, standardized for consistency, undergoes a transformation to quantify both poverty rates and high school completion rates, subsequently binned into quintiles for a granular analysis. The methodology ensures that each bracket spans an equal range of the data, capturing a full spectrum of socio-economic statuses. These brackets are then labeled with intuitive percentage ranges, setting the stage for the ensuing visual assessment. This careful numerical and categorical preparation underpins the creation of two bar charts, which, through the nuanced lens of ggplot2, lay bare the stark contrasts in threat level distributions across different socio-economic strata, painting a telling picture of the intersection between socio-economic factors and lethal police interventions.</span>
<span id="cb12-398"><a href="#cb12-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-399"><a href="#cb12-399" aria-hidden="true" tabindex="-1"></a>For the density ridge plots, the population for each race was calculated from the supplemental datasets by multiplying the 2015 city population estimate with the estimated racial proportion of the city and divided by 100. The police shooting dataset, median income dataset, and the cities race estimates were concatenated according to city and state. The merged data was then subsetted to only include incidents with a median income and race estimates. The first ridge plot, which is organized by the total count of fatalities by race, refactorized the race levels according to the total counts and used a geom_density_ridge() with the median income as the horizontal axis and the race as the vertical axis.</span>
<span id="cb12-400"><a href="#cb12-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-401"><a href="#cb12-401" aria-hidden="true" tabindex="-1"></a>The second density ridge plot, which is organized by the race's relative proportion of fatalities (ie the number of fatalities divided by the estimated race's total population). The race's population estimate was calculated by summing the estimated race's population for all cities included in the subsetted data. The data race levels were refactorized according to the proportions with Other and Unknown set to the bottom of the plot. Other and Unknown were set to the bottom of the plot since the interest of this analysis is focused on the potential difference in incidence when race is considered.</span>
<span id="cb12-402"><a href="#cb12-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-403"><a href="#cb12-403" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot 1a</span></span>
<span id="cb12-404"><a href="#cb12-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-407"><a href="#cb12-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-408"><a href="#cb12-408" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Q1-plot1</span></span>
<span id="cb12-409"><a href="#cb12-409" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb12-410"><a href="#cb12-410" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.8</span></span>
<span id="cb12-411"><a href="#cb12-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-412"><a href="#cb12-412" aria-hidden="true" tabindex="-1"></a><span class="co"># supp_data</span></span>
<span id="cb12-413"><a href="#cb12-413" aria-hidden="true" tabindex="-1"></a>supp_data <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(supp_data)</span>
<span id="cb12-414"><a href="#cb12-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-415"><a href="#cb12-415" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the column names are correctly formatted before merging</span></span>
<span id="cb12-416"><a href="#cb12-416" aria-hidden="true" tabindex="-1"></a>fatality<span class="sc">$</span>city <span class="ot">&lt;-</span> <span class="fu">as.character</span>(fatality<span class="sc">$</span>city)</span>
<span id="cb12-417"><a href="#cb12-417" aria-hidden="true" tabindex="-1"></a>fatality<span class="sc">$</span>state <span class="ot">&lt;-</span> <span class="fu">as.character</span>(fatality<span class="sc">$</span>state)</span>
<span id="cb12-418"><a href="#cb12-418" aria-hidden="true" tabindex="-1"></a>supp_data<span class="sc">$</span>City <span class="ot">&lt;-</span> <span class="fu">as.character</span>(supp_data<span class="sc">$</span>City)</span>
<span id="cb12-419"><a href="#cb12-419" aria-hidden="true" tabindex="-1"></a>supp_data<span class="sc">$</span>State <span class="ot">&lt;-</span> <span class="fu">as.character</span>(supp_data<span class="sc">$</span>State)</span>
<span id="cb12-420"><a href="#cb12-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-421"><a href="#cb12-421" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the main fatality data with the supplementary socio-economic data</span></span>
<span id="cb12-422"><a href="#cb12-422" aria-hidden="true" tabindex="-1"></a>analysis_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(fatality,</span>
<span id="cb12-423"><a href="#cb12-423" aria-hidden="true" tabindex="-1"></a>                       supp_data,</span>
<span id="cb12-424"><a href="#cb12-424" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by.x =</span> <span class="fu">c</span>(<span class="st">"city"</span>, <span class="st">"state"</span>),</span>
<span id="cb12-425"><a href="#cb12-425" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by.y =</span> <span class="fu">c</span>(<span class="st">"City"</span>, <span class="st">"State"</span>))</span>
<span id="cb12-426"><a href="#cb12-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-427"><a href="#cb12-427" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Poverty from character to numeric to handle in quantile calculation</span></span>
<span id="cb12-428"><a href="#cb12-428" aria-hidden="true" tabindex="-1"></a>analysis_data<span class="sc">$</span>Poverty <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(analysis_data<span class="sc">$</span>Poverty))</span>
<span id="cb12-429"><a href="#cb12-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-430"><a href="#cb12-430" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for NA in Poverty which might disrupt quantile calculation</span></span>
<span id="cb12-431"><a href="#cb12-431" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(analysis_data<span class="sc">$</span>Poverty))) {</span>
<span id="cb12-432"><a href="#cb12-432" aria-hidden="true" tabindex="-1"></a>  analysis_data<span class="sc">$</span>Poverty[<span class="fu">is.na</span>(analysis_data<span class="sc">$</span>Poverty)] <span class="ot">&lt;-</span> <span class="fu">median</span>(analysis_data<span class="sc">$</span>Poverty, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-433"><a href="#cb12-433" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-434"><a href="#cb12-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-435"><a href="#cb12-435" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure Poverty is numeric</span></span>
<span id="cb12-436"><a href="#cb12-436" aria-hidden="true" tabindex="-1"></a>analysis_data<span class="sc">$</span>Poverty <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(analysis_data<span class="sc">$</span>Poverty))</span>
<span id="cb12-437"><a href="#cb12-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-438"><a href="#cb12-438" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert HSDegree to numeric, coercing non-numeric values to NA</span></span>
<span id="cb12-439"><a href="#cb12-439" aria-hidden="true" tabindex="-1"></a>analysis_data<span class="sc">$</span>HSDegree <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(analysis_data<span class="sc">$</span>HSDegree))</span>
<span id="cb12-440"><a href="#cb12-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-441"><a href="#cb12-441" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the range for Poverty and HSDegree</span></span>
<span id="cb12-442"><a href="#cb12-442" aria-hidden="true" tabindex="-1"></a>range_poverty <span class="ot">&lt;-</span> <span class="fu">max</span>(analysis_data<span class="sc">$</span>Poverty, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(analysis_data<span class="sc">$</span>Poverty, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-443"><a href="#cb12-443" aria-hidden="true" tabindex="-1"></a>range_hsdegree <span class="ot">&lt;-</span> <span class="fu">max</span>(analysis_data<span class="sc">$</span>HSDegree, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(analysis_data<span class="sc">$</span>HSDegree, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-444"><a href="#cb12-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-445"><a href="#cb12-445" aria-hidden="true" tabindex="-1"></a><span class="co"># Define consistent breaks based on the range</span></span>
<span id="cb12-446"><a href="#cb12-446" aria-hidden="true" tabindex="-1"></a>number_of_brackets <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="co"># For example, 5 equal brackets</span></span>
<span id="cb12-447"><a href="#cb12-447" aria-hidden="true" tabindex="-1"></a>breaks_poverty <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(analysis_data<span class="sc">$</span>Poverty, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb12-448"><a href="#cb12-448" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">max</span>(analysis_data<span class="sc">$</span>Poverty, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb12-449"><a href="#cb12-449" aria-hidden="true" tabindex="-1"></a>                      <span class="at">length.out =</span> number_of_brackets <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb12-450"><a href="#cb12-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-451"><a href="#cb12-451" aria-hidden="true" tabindex="-1"></a>breaks_hsdegree <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(analysis_data<span class="sc">$</span>HSDegree, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb12-452"><a href="#cb12-452" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">max</span>(analysis_data<span class="sc">$</span>HSDegree, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb12-453"><a href="#cb12-453" aria-hidden="true" tabindex="-1"></a>                       <span class="at">length.out =</span> number_of_brackets <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb12-454"><a href="#cb12-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-455"><a href="#cb12-455" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create labels based on breaks</span></span>
<span id="cb12-456"><a href="#cb12-456" aria-hidden="true" tabindex="-1"></a>create_labels <span class="ot">&lt;-</span> <span class="cf">function</span>(breaks) {</span>
<span id="cb12-457"><a href="#cb12-457" aria-hidden="true" tabindex="-1"></a>  labels <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb12-458"><a href="#cb12-458" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(breaks) <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb12-459"><a href="#cb12-459" aria-hidden="true" tabindex="-1"></a>    labels <span class="ot">&lt;-</span> <span class="fu">c</span>(labels, <span class="fu">paste</span>(<span class="fu">formatC</span>(breaks[i], <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">0</span>), <span class="st">"-"</span>, <span class="fu">formatC</span>(breaks[i<span class="sc">+</span><span class="dv">1</span>], <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">0</span>), <span class="st">"%"</span>))</span>
<span id="cb12-460"><a href="#cb12-460" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-461"><a href="#cb12-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(labels)</span>
<span id="cb12-462"><a href="#cb12-462" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-463"><a href="#cb12-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-464"><a href="#cb12-464" aria-hidden="true" tabindex="-1"></a><span class="co"># Use these breaks to make the cuts consistent</span></span>
<span id="cb12-465"><a href="#cb12-465" aria-hidden="true" tabindex="-1"></a>analysis_data<span class="sc">$</span>poverty_bracket <span class="ot">&lt;-</span> <span class="fu">cut</span>(analysis_data<span class="sc">$</span>Poverty,</span>
<span id="cb12-466"><a href="#cb12-466" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">breaks =</span> breaks_poverty,</span>
<span id="cb12-467"><a href="#cb12-467" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-468"><a href="#cb12-468" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">labels =</span> <span class="fu">create_labels</span>(breaks_poverty))</span>
<span id="cb12-469"><a href="#cb12-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-470"><a href="#cb12-470" aria-hidden="true" tabindex="-1"></a>analysis_data<span class="sc">$</span>edu_bracket <span class="ot">&lt;-</span> <span class="fu">cut</span>(analysis_data<span class="sc">$</span>HSDegree,</span>
<span id="cb12-471"><a href="#cb12-471" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">breaks =</span> breaks_hsdegree,</span>
<span id="cb12-472"><a href="#cb12-472" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-473"><a href="#cb12-473" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">labels =</span> <span class="fu">create_labels</span>(breaks_hsdegree))</span>
<span id="cb12-474"><a href="#cb12-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-475"><a href="#cb12-475" aria-hidden="true" tabindex="-1"></a>analysis_data<span class="sc">$</span>threat_level <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(analysis_data<span class="sc">$</span>threat_level)</span>
<span id="cb12-476"><a href="#cb12-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-477"><a href="#cb12-477" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting for Poverty Bracket</span></span>
<span id="cb12-478"><a href="#cb12-478" aria-hidden="true" tabindex="-1"></a>poverty_plot  <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(analysis_data, <span class="fu">aes</span>(<span class="at">x =</span> poverty_bracket, <span class="at">fill =</span> threat_level)) <span class="sc">+</span></span>
<span id="cb12-479"><a href="#cb12-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb12-480"><a href="#cb12-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">'Set3'</span>) <span class="sc">+</span> </span>
<span id="cb12-481"><a href="#cb12-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-482"><a href="#cb12-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Threat Levels by Poverty Bracket"</span>,</span>
<span id="cb12-483"><a href="#cb12-483" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Percentage of Population Below Poverty Line"</span>,</span>
<span id="cb12-484"><a href="#cb12-484" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count of Incidents"</span>,</span>
<span id="cb12-485"><a href="#cb12-485" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Threat Level"</span>) <span class="sc">+</span> </span>
<span id="cb12-486"><a href="#cb12-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'right'</span>)  <span class="co"># Adjusted theme settings here</span></span>
<span id="cb12-487"><a href="#cb12-487" aria-hidden="true" tabindex="-1"></a>poverty_plot</span>
<span id="cb12-488"><a href="#cb12-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-489"><a href="#cb12-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-490"><a href="#cb12-490" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot 1b</span></span>
<span id="cb12-491"><a href="#cb12-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-494"><a href="#cb12-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-495"><a href="#cb12-495" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Q1-plot2</span></span>
<span id="cb12-496"><a href="#cb12-496" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb12-497"><a href="#cb12-497" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-asp: 0.8</span></span>
<span id="cb12-498"><a href="#cb12-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-499"><a href="#cb12-499" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting for Educational Bracket</span></span>
<span id="cb12-500"><a href="#cb12-500" aria-hidden="true" tabindex="-1"></a>education_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(analysis_data, <span class="fu">aes</span>(<span class="at">x =</span> edu_bracket, <span class="at">fill =</span> threat_level)) <span class="sc">+</span></span>
<span id="cb12-501"><a href="#cb12-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb12-502"><a href="#cb12-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">'Set3'</span>) <span class="sc">+</span> </span>
<span id="cb12-503"><a href="#cb12-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-504"><a href="#cb12-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Threat Levels by High School Pass Rate"</span>,</span>
<span id="cb12-505"><a href="#cb12-505" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Percentage of Population with High School Degree"</span>,</span>
<span id="cb12-506"><a href="#cb12-506" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count of Incidents"</span>,</span>
<span id="cb12-507"><a href="#cb12-507" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Threat Level"</span>) <span class="sc">+</span> </span>
<span id="cb12-508"><a href="#cb12-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'right'</span>)  <span class="co"># Adjusted theme settings here</span></span>
<span id="cb12-509"><a href="#cb12-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-510"><a href="#cb12-510" aria-hidden="true" tabindex="-1"></a>education_plot</span>
<span id="cb12-511"><a href="#cb12-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-512"><a href="#cb12-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-513"><a href="#cb12-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-514"><a href="#cb12-514" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot 2a</span></span>
<span id="cb12-515"><a href="#cb12-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-518"><a href="#cb12-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-519"><a href="#cb12-519" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Q1-plot2a</span></span>
<span id="cb12-520"><a href="#cb12-520" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-521"><a href="#cb12-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-522"><a href="#cb12-522" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the populations of each population for each city</span></span>
<span id="cb12-523"><a href="#cb12-523" aria-hidden="true" tabindex="-1"></a>supp_stat <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(supp_data)</span>
<span id="cb12-524"><a href="#cb12-524" aria-hidden="true" tabindex="-1"></a>supp_stat <span class="ot">&lt;-</span> supp_stat <span class="sc">|&gt;</span></span>
<span id="cb12-525"><a href="#cb12-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-526"><a href="#cb12-526" aria-hidden="true" tabindex="-1"></a>    white_pop <span class="ot">&lt;-</span> White <span class="sc">*</span> Population <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb12-527"><a href="#cb12-527" aria-hidden="true" tabindex="-1"></a>    black_pop <span class="ot">&lt;-</span> Black <span class="sc">*</span> Population <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb12-528"><a href="#cb12-528" aria-hidden="true" tabindex="-1"></a>    native_pop <span class="ot">&lt;-</span> Native <span class="sc">*</span> Population <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb12-529"><a href="#cb12-529" aria-hidden="true" tabindex="-1"></a>    asian_pop <span class="ot">&lt;-</span> Asian <span class="sc">*</span> Population <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb12-530"><a href="#cb12-530" aria-hidden="true" tabindex="-1"></a>    hispanic_pop <span class="ot">&lt;-</span> Hispanic <span class="sc">*</span> Population <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb12-531"><a href="#cb12-531" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-532"><a href="#cb12-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-533"><a href="#cb12-533" aria-hidden="true" tabindex="-1"></a><span class="co"># Select specific columns of the supplementary data</span></span>
<span id="cb12-534"><a href="#cb12-534" aria-hidden="true" tabindex="-1"></a>supp_stat <span class="ot">&lt;-</span> supp_stat[,<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">15</span><span class="sc">:</span><span class="dv">19</span>)]</span>
<span id="cb12-535"><a href="#cb12-535" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(supp_stat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"State"</span>,</span>
<span id="cb12-536"><a href="#cb12-536" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"City"</span>,</span>
<span id="cb12-537"><a href="#cb12-537" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Median"</span>,</span>
<span id="cb12-538"><a href="#cb12-538" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"White"</span>,</span>
<span id="cb12-539"><a href="#cb12-539" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Black"</span>,</span>
<span id="cb12-540"><a href="#cb12-540" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Native"</span>,</span>
<span id="cb12-541"><a href="#cb12-541" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Asian"</span>,</span>
<span id="cb12-542"><a href="#cb12-542" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Hispanic"</span>)</span>
<span id="cb12-543"><a href="#cb12-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-544"><a href="#cb12-544" aria-hidden="true" tabindex="-1"></a><span class="co"># Select specific columns of the fatality data</span></span>
<span id="cb12-545"><a href="#cb12-545" aria-hidden="true" tabindex="-1"></a>fatality_subset <span class="ot">&lt;-</span> fatality[,<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb12-546"><a href="#cb12-546" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(fatality_subset) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Race"</span>, <span class="st">"City"</span>, <span class="st">"State"</span>)</span>
<span id="cb12-547"><a href="#cb12-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-548"><a href="#cb12-548" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge dataset and remove rows with NAs</span></span>
<span id="cb12-549"><a href="#cb12-549" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(fatality_subset, supp_stat,</span>
<span id="cb12-550"><a href="#cb12-550" aria-hidden="true" tabindex="-1"></a>                         <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"State"</span>, <span class="st">"City"</span>))</span>
<span id="cb12-551"><a href="#cb12-551" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(merged_data)</span>
<span id="cb12-552"><a href="#cb12-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-553"><a href="#cb12-553" aria-hidden="true" tabindex="-1"></a><span class="co"># Acquire counts of race:</span></span>
<span id="cb12-554"><a href="#cb12-554" aria-hidden="true" tabindex="-1"></a><span class="co"># Asian = 23, Black = 409, Hispanic = 301, Native American = 13, Other = 17,</span></span>
<span id="cb12-555"><a href="#cb12-555" aria-hidden="true" tabindex="-1"></a><span class="co"># Unknown = 92, White = 466</span></span>
<span id="cb12-556"><a href="#cb12-556" aria-hidden="true" tabindex="-1"></a>race_count <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(<span class="fu">as.factor</span>(merged_data<span class="sc">$</span>Race)))</span>
<span id="cb12-557"><a href="#cb12-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-558"><a href="#cb12-558" aria-hidden="true" tabindex="-1"></a><span class="co"># Refactor levels according to the total counts</span></span>
<span id="cb12-559"><a href="#cb12-559" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>Race <span class="ot">&lt;-</span> <span class="fu">factor</span>(merged_data<span class="sc">$</span>Race,</span>
<span id="cb12-560"><a href="#cb12-560" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Unknown"</span>,</span>
<span id="cb12-561"><a href="#cb12-561" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Other"</span>,</span>
<span id="cb12-562"><a href="#cb12-562" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Native American"</span>,</span>
<span id="cb12-563"><a href="#cb12-563" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Asian"</span>,</span>
<span id="cb12-564"><a href="#cb12-564" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Hispanic"</span>,</span>
<span id="cb12-565"><a href="#cb12-565" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Black"</span>,</span>
<span id="cb12-566"><a href="#cb12-566" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"White"</span>))</span>
<span id="cb12-567"><a href="#cb12-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-568"><a href="#cb12-568" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the density ridge plot (smallest count at the bottom)</span></span>
<span id="cb12-569"><a href="#cb12-569" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(merged_data, <span class="fu">aes</span>(<span class="at">x =</span> Median, <span class="at">y =</span> Race)) <span class="sc">+</span></span>
<span id="cb12-570"><a href="#cb12-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb12-571"><a href="#cb12-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb12-572"><a href="#cb12-572" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">"K"</span>)) <span class="sc">+</span></span>
<span id="cb12-573"><a href="#cb12-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb12-574"><a href="#cb12-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">1.2</span>, <span class="at">label =</span> <span class="st">"13"</span>)) <span class="sc">+</span></span>
<span id="cb12-575"><a href="#cb12-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">2.2</span>, <span class="at">label =</span> <span class="st">"17"</span>)) <span class="sc">+</span></span>
<span id="cb12-576"><a href="#cb12-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">3.2</span>, <span class="at">label =</span> <span class="st">"23"</span>)) <span class="sc">+</span></span>
<span id="cb12-577"><a href="#cb12-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">4.2</span>, <span class="at">label =</span> <span class="st">"92"</span>)) <span class="sc">+</span></span>
<span id="cb12-578"><a href="#cb12-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">5.2</span>, <span class="at">label =</span> <span class="st">"301"</span>)) <span class="sc">+</span></span>
<span id="cb12-579"><a href="#cb12-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">6.2</span>, <span class="at">label =</span> <span class="st">"409"</span>)) <span class="sc">+</span></span>
<span id="cb12-580"><a href="#cb12-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">7.2</span>, <span class="at">label =</span> <span class="st">"466"</span>)) <span class="sc">+</span></span>
<span id="cb12-581"><a href="#cb12-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density Plots of Police Shootings"</span>,</span>
<span id="cb12-582"><a href="#cb12-582" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Ordered by descending counts"</span>) <span class="sc">+</span></span>
<span id="cb12-583"><a href="#cb12-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Median Income of City"</span>) <span class="sc">+</span></span>
<span id="cb12-584"><a href="#cb12-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Race"</span>) <span class="sc">+</span></span>
<span id="cb12-585"><a href="#cb12-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb12-586"><a href="#cb12-586" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-587"><a href="#cb12-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-588"><a href="#cb12-588" aria-hidden="true" tabindex="-1"></a><span class="fu">### Median Insights</span></span>
<span id="cb12-591"><a href="#cb12-591" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-592"><a href="#cb12-592" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Q1-median</span></span>
<span id="cb12-593"><a href="#cb12-593" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-594"><a href="#cb12-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-595"><a href="#cb12-595" aria-hidden="true" tabindex="-1"></a><span class="co"># Find distinct city and states and only keep numerical data</span></span>
<span id="cb12-596"><a href="#cb12-596" aria-hidden="true" tabindex="-1"></a>distinct_city <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb12-597"><a href="#cb12-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(State, City, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-598"><a href="#cb12-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Median, White, Black, Native, Asian, Hispanic)</span>
<span id="cb12-599"><a href="#cb12-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-600"><a href="#cb12-600" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate dataset for geom_smooth</span></span>
<span id="cb12-601"><a href="#cb12-601" aria-hidden="true" tabindex="-1"></a>distinct_city <span class="ot">&lt;-</span> distinct_city <span class="sc">|&gt;</span> <span class="co"># Find the proportions for each race</span></span>
<span id="cb12-602"><a href="#cb12-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-603"><a href="#cb12-603" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(White<span class="sc">:</span>Hispanic)),</span>
<span id="cb12-604"><a href="#cb12-604" aria-hidden="true" tabindex="-1"></a>    <span class="at">White =</span> White <span class="sc">/</span> Total,</span>
<span id="cb12-605"><a href="#cb12-605" aria-hidden="true" tabindex="-1"></a>    <span class="at">Black =</span> Black <span class="sc">/</span> Total,</span>
<span id="cb12-606"><a href="#cb12-606" aria-hidden="true" tabindex="-1"></a>    <span class="at">Native =</span> Native <span class="sc">/</span> Total,</span>
<span id="cb12-607"><a href="#cb12-607" aria-hidden="true" tabindex="-1"></a>    <span class="at">Asian =</span> Asian <span class="sc">/</span> Total,</span>
<span id="cb12-608"><a href="#cb12-608" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hispanic =</span> Hispanic <span class="sc">/</span> Total</span>
<span id="cb12-609"><a href="#cb12-609" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="co"># Pivot data so race and values are columns</span></span>
<span id="cb12-610"><a href="#cb12-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb12-611"><a href="#cb12-611" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(White, Black, Native, Asian, Hispanic),</span>
<span id="cb12-612"><a href="#cb12-612" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Race"</span>,</span>
<span id="cb12-613"><a href="#cb12-613" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Percent"</span></span>
<span id="cb12-614"><a href="#cb12-614" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="co"># Create legend column so that races can have colors later</span></span>
<span id="cb12-615"><a href="#cb12-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-616"><a href="#cb12-616" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-617"><a href="#cb12-617" aria-hidden="true" tabindex="-1"></a>      Race <span class="sc">%in%</span> <span class="st">"White"</span> <span class="sc">~</span> <span class="st">"White"</span>,</span>
<span id="cb12-618"><a href="#cb12-618" aria-hidden="true" tabindex="-1"></a>      Race <span class="sc">%in%</span> <span class="st">"Black"</span> <span class="sc">~</span> <span class="st">"Black"</span>,</span>
<span id="cb12-619"><a href="#cb12-619" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb12-620"><a href="#cb12-620" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-621"><a href="#cb12-621" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-622"><a href="#cb12-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-623"><a href="#cb12-623" aria-hidden="true" tabindex="-1"></a><span class="co"># Refactor levels for legends order</span></span>
<span id="cb12-624"><a href="#cb12-624" aria-hidden="true" tabindex="-1"></a>distinct_city<span class="sc">$</span>legend <span class="ot">&lt;-</span> <span class="fu">factor</span>(distinct_city<span class="sc">$</span>legend,</span>
<span id="cb12-625"><a href="#cb12-625" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Black"</span>, <span class="st">"White"</span>, <span class="st">"Other"</span>))</span>
<span id="cb12-626"><a href="#cb12-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-627"><a href="#cb12-627" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate smooth plot</span></span>
<span id="cb12-628"><a href="#cb12-628" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> distinct_city,</span>
<span id="cb12-629"><a href="#cb12-629" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> Median, <span class="at">y =</span> Percent, <span class="at">group =</span> Race, <span class="at">color =</span> legend)) <span class="sc">+</span></span>
<span id="cb12-630"><a href="#cb12-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb12-631"><a href="#cb12-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"grey"</span>)) <span class="sc">+</span></span>
<span id="cb12-632"><a href="#cb12-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">"K"</span>)) <span class="sc">+</span></span>
<span id="cb12-633"><a href="#cb12-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb12-634"><a href="#cb12-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">35000</span>, <span class="dv">75000</span>)) <span class="sc">+</span></span>
<span id="cb12-635"><a href="#cb12-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"City Race Proportions"</span>,</span>
<span id="cb12-636"><a href="#cb12-636" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Over city median income"</span>,</span>
<span id="cb12-637"><a href="#cb12-637" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Median Income of City"</span>,</span>
<span id="cb12-638"><a href="#cb12-638" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Proportion of Population"</span>) <span class="sc">+</span></span>
<span id="cb12-639"><a href="#cb12-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="st">"Race"</span>)) <span class="sc">+</span></span>
<span id="cb12-640"><a href="#cb12-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-641"><a href="#cb12-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>()</span>
<span id="cb12-642"><a href="#cb12-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-643"><a href="#cb12-643" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-644"><a href="#cb12-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-645"><a href="#cb12-645" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot 2b</span></span>
<span id="cb12-646"><a href="#cb12-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-649"><a href="#cb12-649" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-650"><a href="#cb12-650" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Q1-plot2b</span></span>
<span id="cb12-651"><a href="#cb12-651" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-652"><a href="#cb12-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-653"><a href="#cb12-653" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the race populations</span></span>
<span id="cb12-654"><a href="#cb12-654" aria-hidden="true" tabindex="-1"></a><span class="co"># White = 135231935, Black = 30170898, Native = 1827873, Asian = 12570851,</span></span>
<span id="cb12-655"><a href="#cb12-655" aria-hidden="true" tabindex="-1"></a><span class="co"># Hispanic = 51034800</span></span>
<span id="cb12-656"><a href="#cb12-656" aria-hidden="true" tabindex="-1"></a>race_pop <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb12-657"><a href="#cb12-657" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(State, City, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-658"><a href="#cb12-658" aria-hidden="true" tabindex="-1"></a>race_total <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">colSums</span>(race_pop[,<span class="dv">5</span><span class="sc">:</span><span class="dv">9</span>]))</span>
<span id="cb12-659"><a href="#cb12-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-660"><a href="#cb12-660" aria-hidden="true" tabindex="-1"></a><span class="co"># Proportion shot for each race:</span></span>
<span id="cb12-661"><a href="#cb12-661" aria-hidden="true" tabindex="-1"></a><span class="co"># Asian:0.000182963</span></span>
<span id="cb12-662"><a href="#cb12-662" aria-hidden="true" tabindex="-1"></a><span class="co"># race_count[1,1]/race_total[4,1] * 100</span></span>
<span id="cb12-663"><a href="#cb12-663" aria-hidden="true" tabindex="-1"></a><span class="co"># Black: 0.001355611</span></span>
<span id="cb12-664"><a href="#cb12-664" aria-hidden="true" tabindex="-1"></a><span class="co"># race_count[2,1]/race_total[2,1] * 100</span></span>
<span id="cb12-665"><a href="#cb12-665" aria-hidden="true" tabindex="-1"></a><span class="co"># Hispanic: 0.0005897936</span></span>
<span id="cb12-666"><a href="#cb12-666" aria-hidden="true" tabindex="-1"></a><span class="co"># race_count[3,1]/race_total[5,1] * 100</span></span>
<span id="cb12-667"><a href="#cb12-667" aria-hidden="true" tabindex="-1"></a><span class="co"># Native: 0.0007112093</span></span>
<span id="cb12-668"><a href="#cb12-668" aria-hidden="true" tabindex="-1"></a><span class="co"># race_count[4,1]/race_total[3,1] * 100</span></span>
<span id="cb12-669"><a href="#cb12-669" aria-hidden="true" tabindex="-1"></a><span class="co"># White: 0.0003445932</span></span>
<span id="cb12-670"><a href="#cb12-670" aria-hidden="true" tabindex="-1"></a><span class="co"># race_count[7,1]/race_total[1,1] * 100</span></span>
<span id="cb12-671"><a href="#cb12-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-672"><a href="#cb12-672" aria-hidden="true" tabindex="-1"></a><span class="co"># Refactor levels according to the proportions</span></span>
<span id="cb12-673"><a href="#cb12-673" aria-hidden="true" tabindex="-1"></a>merged_data<span class="sc">$</span>Race <span class="ot">&lt;-</span> <span class="fu">factor</span>(merged_data<span class="sc">$</span>Race,</span>
<span id="cb12-674"><a href="#cb12-674" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Unknown"</span>,</span>
<span id="cb12-675"><a href="#cb12-675" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Other"</span>,</span>
<span id="cb12-676"><a href="#cb12-676" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Asian"</span>,</span>
<span id="cb12-677"><a href="#cb12-677" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"White"</span>,</span>
<span id="cb12-678"><a href="#cb12-678" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Hispanic"</span>,</span>
<span id="cb12-679"><a href="#cb12-679" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Native American"</span>,</span>
<span id="cb12-680"><a href="#cb12-680" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Black"</span>))</span>
<span id="cb12-681"><a href="#cb12-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-682"><a href="#cb12-682" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the density ridge plot (smallest proportion at the bottom)</span></span>
<span id="cb12-683"><a href="#cb12-683" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(merged_data, <span class="fu">aes</span>(<span class="at">x =</span> Median, <span class="at">y =</span> Race)) <span class="sc">+</span></span>
<span id="cb12-684"><a href="#cb12-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density_ridges</span>() <span class="sc">+</span></span>
<span id="cb12-685"><a href="#cb12-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb12-686"><a href="#cb12-686" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">label_dollar</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">"K"</span>)) <span class="sc">+</span></span>
<span id="cb12-687"><a href="#cb12-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb12-688"><a href="#cb12-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">3.2</span>, <span class="at">label =</span> <span class="st">"0.0002%"</span>)) <span class="sc">+</span></span>
<span id="cb12-689"><a href="#cb12-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">4.2</span>, <span class="at">label =</span> <span class="st">"0.0003%"</span>)) <span class="sc">+</span></span>
<span id="cb12-690"><a href="#cb12-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">5.2</span>, <span class="at">label =</span> <span class="st">"0.0006%"</span>)) <span class="sc">+</span></span>
<span id="cb12-691"><a href="#cb12-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">6.2</span>, <span class="at">label =</span> <span class="st">"0.0007%"</span>)) <span class="sc">+</span></span>
<span id="cb12-692"><a href="#cb12-692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">125000</span>, <span class="at">y =</span> <span class="fl">7.2</span>, <span class="at">label =</span> <span class="st">"0.0014%"</span>)) <span class="sc">+</span></span>
<span id="cb12-693"><a href="#cb12-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density Plots of Police Shootings"</span>,</span>
<span id="cb12-694"><a href="#cb12-694" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Ordered by descending proportion within race"</span>) <span class="sc">+</span></span>
<span id="cb12-695"><a href="#cb12-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Median Income of City"</span>) <span class="sc">+</span></span>
<span id="cb12-696"><a href="#cb12-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Race"</span>) <span class="sc">+</span></span>
<span id="cb12-697"><a href="#cb12-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb12-698"><a href="#cb12-698" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-699"><a href="#cb12-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-700"><a href="#cb12-700" aria-hidden="true" tabindex="-1"></a><span class="fu">### Discussion</span></span>
<span id="cb12-701"><a href="#cb12-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-702"><a href="#cb12-702" aria-hidden="true" tabindex="-1"></a>The above visualizations focus on the distribution of shootings across three demographic categories: median income, percent high school graduates, and poverty level. Plot 1 take takes this further by breaking down the shootings by threat level across poverty level and percent high school graduates. Looking further at Plot 1, two major observations can be made: cities with greater than 75% high school graduates and poverty levels between 18-25% experience the most shootings with roughly half of all incidents showing a threat level of "Attack", meaning the shooting officer felt their safety was at risk via the suspect. Additionally, most shootings had a threat level of "Attack" or "Other", and a minority of the shootings are undetermined, meaning most officers recorded a reason for discharging their weapon. These observations suggest that cities with more high school edcuated individuals and a poverty level that is twice the US average will experience more shootings. One explanation for this is very large US cities like New York City and Chicago. These cities have large populations and a large wage gap between class levels, so the high school graduate percentage is supplemented by higher income classes and the poverty level is driven up by lower income classes, and because of the sheer size of these large cities, there are more cases of shootings, even if the rate per count of population is the same as other cities. Additionally, it can be safely assumed that the lower percentages of high school graduate cities are outliers in the dataset.</span>
<span id="cb12-703"><a href="#cb12-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-704"><a href="#cb12-704" aria-hidden="true" tabindex="-1"></a>Plot 2a breaks down these incidents by raw count of victims in each race population, and Plot 2b takes these raw counts and converts them to overall percent of victims per total population of each race. These plots show these representations across the median income of each city where the shooting occured. From these plots, a few insights can be gained. First, most shootings occur in cities where the median income is roughly between \$40k - \$50k per year, with more shootings at the higher end of that range. Second, out of all races in a given city, white people are shot the most, with the highest raw count. However, when compared to the overal population of each race, black are shot the most, at 0.0014% of the black population being shot, the equivalent of 1 in every 7,143 black people being shot by the police. In contrast, white people have a 0.0003% chance of being shot by the police, or 1 in every 333,334 white people. That means that black people are 47 times more likely to be shot by police, a striking statistic. Finally, the last major observation that can be made is that most native Americans are shot in cities where the median income is roughly \$45k per year, based on the large spike at the \$45k mark.</span>
<span id="cb12-705"><a href="#cb12-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-706"><a href="#cb12-706" aria-hidden="true" tabindex="-1"></a><span class="fu">## Question 2</span></span>
<span id="cb12-707"><a href="#cb12-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-708"><a href="#cb12-708" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>In what ways do the analyses of hotspot states, hotspot cities, and racial distribution contribute to understanding the intersection of incidents of police use of force across diverse geographic areas?</span>
<span id="cb12-709"><a href="#cb12-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-710"><a href="#cb12-710" aria-hidden="true" tabindex="-1"></a><span class="fu">### Description of Analysis</span></span>
<span id="cb12-711"><a href="#cb12-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-712"><a href="#cb12-712" aria-hidden="true" tabindex="-1"></a>The comprehensive analysis includes three animated plots, each offering a unique perspective on the intersection of incidents of police use of force. The first plot highlights hotspot states, shedding light on regions with elevated rates of such incidents. The second plot zooms in on hotspot cities, providing a closer examination of urban areas experiencing heightened police use of force. Finally, the third plot delves into the racial distribution within these hotspot states, offering insights into how demographics intersect with incidences of police use of force. Together, these visualizations aim to provide a holistic understanding of the complex dynamics at play</span>
<span id="cb12-713"><a href="#cb12-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-714"><a href="#cb12-714" aria-hidden="true" tabindex="-1"></a>The animated plot provides a comprehensive overview of state hotspots throughout 2015, 2016, and 2017. These hotspots are meticulously identified by considering population data and using a critical metric called "shooting intensity." This intensity measures fatalities per million people, ensuring a fair assessment of states regardless of their population size. To ensure clarity and inclusivity, the visualization employs both U.S. and world maps. Since the U.S. map typically excludes Alaska, a comprehensive approach involves manually incorporating Alaska from the world map and custom annotating it onto the U.S. map for a holistic view. States where shooting intensity exceeds a threshold of 3 are specifically highlighted using geom_label_repel, drawing attention to regions with heightened incidents. Additionally, annotations identify the top three hotspot states, ranked by shooting intensity and total fatalities. This multifaceted approach offers a nuanced understanding of incident frequency and impact, facilitating comprehensive analysis across diverse geographical areas. The process for creating the plot starts with summarizing fatalities across different years and merging this data with state population datasets. Individual datasets are then created for each year (2015, 2016, and 2017) to focus on shooting intensity for each specific year. USA map data plays a crucial role in defining borders for the map visualization. Shooting intensities are calculated by dividing the fatalities count by the population and multiplying by 1,000,000 to obtain a per million population rate. Specific adjustments are made to ensure clear visualization of Alaska's data on the map. Labels are strategically placed at the center of each state to convey clear information about shooting intensities for each respective year.</span>
<span id="cb12-715"><a href="#cb12-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-716"><a href="#cb12-716" aria-hidden="true" tabindex="-1"></a>The second animated plot provides a detailed portrayal of major city hotspots throughout 2015, 2016, and 2017. These hotspots are identified using the same "shooting intensity" metric as in the previous plot. This intensity measures fatalities per million people, ensuring a consistent evaluation of cities regardless of their population size. To maintain coherence and comprehensiveness, the visualization retains the depiction of states from the previous plot to provide contextual continuity. Cities are marked using geom_point, and those with a high shooting intensity exceeding 28 are further emphasized using geom_label_repel. This approach effectively highlights cities within states that exhibit significantly higher shooting intensity, contributing to a nuanced understanding of localized dynamics within broader geographical contexts. This layered depiction elucidates the presence of cities with heightened incidents within states with relatively lower overall intensity. The process for creating the plot starts with summarizing fatalities across different years, similar to plot 1. Individual datasets are then created for each year (2015, 2016, and 2017), and shooting intensities are calculated by dividing the fatalities count by the population and multiplying by 1,000,000 to obtain a per million population rate. The use of USA map data is crucial in defining boundaries for the map visualization, bringing the visualization to life.</span>
<span id="cb12-717"><a href="#cb12-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-718"><a href="#cb12-718" aria-hidden="true" tabindex="-1"></a>For the final animated plot</span>
<span id="cb12-719"><a href="#cb12-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-720"><a href="#cb12-720" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot 1</span></span>
<span id="cb12-721"><a href="#cb12-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-724"><a href="#cb12-724" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-725"><a href="#cb12-725" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Q2-plot1-shooting-intensity-state-wise</span></span>
<span id="cb12-726"><a href="#cb12-726" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-727"><a href="#cb12-727" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb12-728"><a href="#cb12-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-729"><a href="#cb12-729" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating state_abbreviations dataframe</span></span>
<span id="cb12-730"><a href="#cb12-730" aria-hidden="true" tabindex="-1"></a>state_abbreviations <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb12-731"><a href="#cb12-731" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Alabama"</span> <span class="ot">=</span> <span class="st">"AL"</span>, <span class="st">"Alaska"</span> <span class="ot">=</span> <span class="st">"AK"</span>, </span>
<span id="cb12-732"><a href="#cb12-732" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Arizona"</span> <span class="ot">=</span> <span class="st">"AZ"</span>, <span class="st">"Arkansas"</span> <span class="ot">=</span> <span class="st">"AR"</span>,</span>
<span id="cb12-733"><a href="#cb12-733" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span> <span class="ot">=</span> <span class="st">"CA"</span>, <span class="st">"Colorado"</span> <span class="ot">=</span> <span class="st">"CO"</span>, </span>
<span id="cb12-734"><a href="#cb12-734" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Connecticut"</span> <span class="ot">=</span> <span class="st">"CT"</span>, <span class="st">"Delaware"</span> <span class="ot">=</span> <span class="st">"DE"</span>,</span>
<span id="cb12-735"><a href="#cb12-735" aria-hidden="true" tabindex="-1"></a>  <span class="st">"District of Columbia"</span> <span class="ot">=</span> <span class="st">"DC"</span>, <span class="st">"Florida"</span> <span class="ot">=</span> <span class="st">"FL"</span>, </span>
<span id="cb12-736"><a href="#cb12-736" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Georgia"</span> <span class="ot">=</span> <span class="st">"GA"</span>, <span class="st">"Hawaii"</span> <span class="ot">=</span> <span class="st">"HI"</span>,</span>
<span id="cb12-737"><a href="#cb12-737" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Idaho"</span> <span class="ot">=</span> <span class="st">"ID"</span>, <span class="st">"Illinois"</span> <span class="ot">=</span> <span class="st">"IL"</span>, <span class="st">"Indiana"</span> <span class="ot">=</span> <span class="st">"IN"</span>, </span>
<span id="cb12-738"><a href="#cb12-738" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Iowa"</span> <span class="ot">=</span> <span class="st">"IA"</span>, <span class="st">"Kansas"</span> <span class="ot">=</span> <span class="st">"KS"</span>,</span>
<span id="cb12-739"><a href="#cb12-739" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Kentucky"</span> <span class="ot">=</span> <span class="st">"KY"</span>, <span class="st">"Louisiana"</span> <span class="ot">=</span> <span class="st">"LA"</span>, </span>
<span id="cb12-740"><a href="#cb12-740" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Maine"</span> <span class="ot">=</span> <span class="st">"ME"</span>, <span class="st">"Maryland"</span> <span class="ot">=</span> <span class="st">"MD"</span>, </span>
<span id="cb12-741"><a href="#cb12-741" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Massachusetts"</span> <span class="ot">=</span> <span class="st">"MA"</span>, <span class="st">"Michigan"</span> <span class="ot">=</span> <span class="st">"MI"</span>, </span>
<span id="cb12-742"><a href="#cb12-742" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Minnesota"</span> <span class="ot">=</span> <span class="st">"MN"</span>, <span class="st">"Mississippi"</span> <span class="ot">=</span> <span class="st">"MS"</span>, </span>
<span id="cb12-743"><a href="#cb12-743" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Missouri"</span> <span class="ot">=</span> <span class="st">"MO"</span>, <span class="st">"Montana"</span> <span class="ot">=</span> <span class="st">"MT"</span>,</span>
<span id="cb12-744"><a href="#cb12-744" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Nebraska"</span> <span class="ot">=</span> <span class="st">"NE"</span>, <span class="st">"Nevada"</span> <span class="ot">=</span> <span class="st">"NV"</span>, </span>
<span id="cb12-745"><a href="#cb12-745" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New Hampshire"</span> <span class="ot">=</span> <span class="st">"NH"</span>, <span class="st">"New Jersey"</span> <span class="ot">=</span> <span class="st">"NJ"</span>, </span>
<span id="cb12-746"><a href="#cb12-746" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New Mexico"</span> <span class="ot">=</span> <span class="st">"NM"</span>, <span class="st">"New York"</span> <span class="ot">=</span> <span class="st">"NY"</span>, </span>
<span id="cb12-747"><a href="#cb12-747" aria-hidden="true" tabindex="-1"></a>  <span class="st">"North Carolina"</span> <span class="ot">=</span> <span class="st">"NC"</span>, <span class="st">"North Dakota"</span> <span class="ot">=</span> <span class="st">"ND"</span>, </span>
<span id="cb12-748"><a href="#cb12-748" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ohio"</span> <span class="ot">=</span> <span class="st">"OH"</span>, <span class="st">"Oklahoma"</span> <span class="ot">=</span> <span class="st">"OK"</span>,</span>
<span id="cb12-749"><a href="#cb12-749" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Oregon"</span> <span class="ot">=</span> <span class="st">"OR"</span>, <span class="st">"Pennsylvania"</span> <span class="ot">=</span> <span class="st">"PA"</span>, </span>
<span id="cb12-750"><a href="#cb12-750" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Rhode Island"</span> <span class="ot">=</span> <span class="st">"RI"</span>, <span class="st">"South Carolina"</span> <span class="ot">=</span> <span class="st">"SC"</span>, </span>
<span id="cb12-751"><a href="#cb12-751" aria-hidden="true" tabindex="-1"></a>  <span class="st">"South Dakota"</span> <span class="ot">=</span> <span class="st">"SD"</span>, <span class="st">"Tennessee"</span> <span class="ot">=</span> <span class="st">"TN"</span>, </span>
<span id="cb12-752"><a href="#cb12-752" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Texas"</span> <span class="ot">=</span> <span class="st">"TX"</span>, <span class="st">"Utah"</span> <span class="ot">=</span> <span class="st">"UT"</span>, </span>
<span id="cb12-753"><a href="#cb12-753" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Vermont"</span> <span class="ot">=</span> <span class="st">"VT"</span>, <span class="st">"Virginia"</span> <span class="ot">=</span> <span class="st">"VA"</span>, <span class="st">"Washington"</span> <span class="ot">=</span> <span class="st">"WA"</span>,</span>
<span id="cb12-754"><a href="#cb12-754" aria-hidden="true" tabindex="-1"></a>  <span class="st">"West Virginia"</span> <span class="ot">=</span> <span class="st">"WV"</span>, <span class="st">"Wisconsin"</span> <span class="ot">=</span> <span class="st">"WI"</span>, <span class="st">"Wyoming"</span> <span class="ot">=</span> <span class="st">"WY"</span>, <span class="st">"Puerto Rico"</span> <span class="ot">=</span> <span class="st">"PR"</span></span>
<span id="cb12-755"><a href="#cb12-755" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-756"><a href="#cb12-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-757"><a href="#cb12-757" aria-hidden="true" tabindex="-1"></a>state_abbreviations_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">STATE =</span> <span class="fu">names</span>(state_abbreviations), <span class="at">state =</span> state_abbreviations, <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb12-758"><a href="#cb12-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-759"><a href="#cb12-759" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Fatalaties Summaries by Year</span></span>
<span id="cb12-760"><a href="#cb12-760" aria-hidden="true" tabindex="-1"></a>fatality_summaries_year <span class="ot">&lt;-</span></span>
<span id="cb12-761"><a href="#cb12-761" aria-hidden="true" tabindex="-1"></a>  fatality <span class="sc">|&gt;</span> </span>
<span id="cb12-762"><a href="#cb12-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-763"><a href="#cb12-763" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(fatality<span class="sc">$</span>date,<span class="at">format =</span> <span class="st">"%d/%m/%y"</span>))</span>
<span id="cb12-764"><a href="#cb12-764" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-765"><a href="#cb12-765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state,year) <span class="sc">|&gt;</span></span>
<span id="cb12-766"><a href="#cb12-766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fatalities_count =</span> <span class="fu">n</span>() , <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb12-767"><a href="#cb12-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-768"><a href="#cb12-768" aria-hidden="true" tabindex="-1"></a><span class="do">## Loading State Population dataset</span></span>
<span id="cb12-769"><a href="#cb12-769" aria-hidden="true" tabindex="-1"></a>state_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/Population_Estimate_data_Statewise_2010-2023.csv"</span>)</span>
<span id="cb12-770"><a href="#cb12-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-771"><a href="#cb12-771" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating a long format State Population dataframe</span></span>
<span id="cb12-772"><a href="#cb12-772" aria-hidden="true" tabindex="-1"></a>state_pop_updated <span class="ot">&lt;-</span> </span>
<span id="cb12-773"><a href="#cb12-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(state_pop,state_abbreviations_df) <span class="sc">|&gt;</span></span>
<span id="cb12-774"><a href="#cb12-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb12-775"><a href="#cb12-775" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"POP"</span>),</span>
<span id="cb12-776"><a href="#cb12-776" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb12-777"><a href="#cb12-777" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"popuplation"</span></span>
<span id="cb12-778"><a href="#cb12-778" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb12-779"><a href="#cb12-779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-780"><a href="#cb12-780" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-781"><a href="#cb12-781" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2010"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/10"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-782"><a href="#cb12-782" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2011"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/11"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-783"><a href="#cb12-783" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2012"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/12"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-784"><a href="#cb12-784" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2013"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/13"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-785"><a href="#cb12-785" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2014"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/14"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-786"><a href="#cb12-786" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2015"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/15"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-787"><a href="#cb12-787" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2016"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/16"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-788"><a href="#cb12-788" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2017"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/17"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-789"><a href="#cb12-789" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2018"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/18"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-790"><a href="#cb12-790" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2019"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/19"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-791"><a href="#cb12-791" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2020"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/20"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-792"><a href="#cb12-792" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2021"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/21"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-793"><a href="#cb12-793" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2022"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/22"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-794"><a href="#cb12-794" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2023"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/23"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-795"><a href="#cb12-795" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-796"><a href="#cb12-796" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-797"><a href="#cb12-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-798"><a href="#cb12-798" aria-hidden="true" tabindex="-1"></a><span class="co"># Merging Fatalaties Summaries by Year with State Population</span></span>
<span id="cb12-799"><a href="#cb12-799" aria-hidden="true" tabindex="-1"></a>fatalities_population <span class="ot">&lt;-</span> <span class="fu">merge</span>(fatality_summaries_year,state_pop_updated)</span>
<span id="cb12-800"><a href="#cb12-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-801"><a href="#cb12-801" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating an individual fatalaties population wise dataset along with shooting intensity column - Year wise</span></span>
<span id="cb12-802"><a href="#cb12-802" aria-hidden="true" tabindex="-1"></a>fatalities_population_2015 <span class="ot">&lt;-</span> fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb12-803"><a href="#cb12-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-804"><a href="#cb12-804" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>popuplation)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb12-805"><a href="#cb12-805" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(STATE)</span>
<span id="cb12-806"><a href="#cb12-806" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-807"><a href="#cb12-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-808"><a href="#cb12-808" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2015</span></span>
<span id="cb12-809"><a href="#cb12-809" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-810"><a href="#cb12-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-811"><a href="#cb12-811" aria-hidden="true" tabindex="-1"></a>fatalities_population_2016 <span class="ot">&lt;-</span> fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb12-812"><a href="#cb12-812" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-813"><a href="#cb12-813" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>popuplation)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb12-814"><a href="#cb12-814" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(STATE)</span>
<span id="cb12-815"><a href="#cb12-815" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-816"><a href="#cb12-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-817"><a href="#cb12-817" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2016</span></span>
<span id="cb12-818"><a href="#cb12-818" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-819"><a href="#cb12-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-820"><a href="#cb12-820" aria-hidden="true" tabindex="-1"></a>fatalities_population_2017 <span class="ot">&lt;-</span> fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb12-821"><a href="#cb12-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-822"><a href="#cb12-822" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>popuplation)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb12-823"><a href="#cb12-823" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(STATE)</span>
<span id="cb12-824"><a href="#cb12-824" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-825"><a href="#cb12-825" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-826"><a href="#cb12-826" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2017</span></span>
<span id="cb12-827"><a href="#cb12-827" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-828"><a href="#cb12-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-829"><a href="#cb12-829" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading USA MAP</span></span>
<span id="cb12-830"><a href="#cb12-830" aria-hidden="true" tabindex="-1"></a>us_map_data <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb12-831"><a href="#cb12-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-832"><a href="#cb12-832" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading World Map and Subsetting Alaska</span></span>
<span id="cb12-833"><a href="#cb12-833" aria-hidden="true" tabindex="-1"></a>alaska <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"world"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-834"><a href="#cb12-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-835"><a href="#cb12-835" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">==</span> <span class="st">"USA"</span> <span class="sc">&amp;</span> (subregion <span class="sc">==</span> <span class="st">"Alaska"</span> ) </span>
<span id="cb12-836"><a href="#cb12-836" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-837"><a href="#cb12-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-838"><a href="#cb12-838" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(subregion),</span>
<span id="cb12-839"><a href="#cb12-839" aria-hidden="true" tabindex="-1"></a>    <span class="at">order =</span> <span class="fu">max</span>(us_map_data<span class="sc">$</span>order) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb12-840"><a href="#cb12-840" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-841"><a href="#cb12-841" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-842"><a href="#cb12-842" aria-hidden="true" tabindex="-1"></a>    long <span class="sc">&lt;</span> <span class="dv">0</span></span>
<span id="cb12-843"><a href="#cb12-843" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-844"><a href="#cb12-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-845"><a href="#cb12-845" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Year Wise Map data frame from the fatalies dataset </span></span>
<span id="cb12-846"><a href="#cb12-846" aria-hidden="true" tabindex="-1"></a>merge_2015_us <span class="ot">&lt;-</span> <span class="fu">full_join</span>(us_map_data,</span>
<span id="cb12-847"><a href="#cb12-847" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">subset</span>(fatalities_population_2015,</span>
<span id="cb12-848"><a href="#cb12-848" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">!</span>(fatalities_population_2015<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span> <span class="sc">|</span></span>
<span id="cb12-849"><a href="#cb12-849" aria-hidden="true" tabindex="-1"></a>                                      fatalities_population_2015<span class="sc">$</span>region<span class="sc">==</span><span class="st">"hawaii"</span>)))</span>
<span id="cb12-850"><a href="#cb12-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-851"><a href="#cb12-851" aria-hidden="true" tabindex="-1"></a>merge_2015_alaska <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(alaska,fatalities_population_2015)</span>
<span id="cb12-852"><a href="#cb12-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-853"><a href="#cb12-853" aria-hidden="true" tabindex="-1"></a>merge_2016_us <span class="ot">&lt;-</span> <span class="fu">full_join</span>(us_map_data,</span>
<span id="cb12-854"><a href="#cb12-854" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">subset</span>(fatalities_population_2016,</span>
<span id="cb12-855"><a href="#cb12-855" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">!</span>(fatalities_population_2016<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span> <span class="sc">|</span></span>
<span id="cb12-856"><a href="#cb12-856" aria-hidden="true" tabindex="-1"></a>                                      fatalities_population_2016<span class="sc">$</span>region<span class="sc">==</span><span class="st">"hawaii"</span>)))</span>
<span id="cb12-857"><a href="#cb12-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-858"><a href="#cb12-858" aria-hidden="true" tabindex="-1"></a>merge_2016_alaska <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(alaska,fatalities_population_2016)</span>
<span id="cb12-859"><a href="#cb12-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-860"><a href="#cb12-860" aria-hidden="true" tabindex="-1"></a>merge_2017_us <span class="ot">&lt;-</span> <span class="fu">full_join</span>(us_map_data,</span>
<span id="cb12-861"><a href="#cb12-861" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">subset</span>(fatalities_population_2017,</span>
<span id="cb12-862"><a href="#cb12-862" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">!</span>(fatalities_population_2017<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span> <span class="sc">|</span></span>
<span id="cb12-863"><a href="#cb12-863" aria-hidden="true" tabindex="-1"></a>                                      fatalities_population_2017<span class="sc">$</span>region<span class="sc">==</span><span class="st">"hawaii"</span>)))</span>
<span id="cb12-864"><a href="#cb12-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-865"><a href="#cb12-865" aria-hidden="true" tabindex="-1"></a>merge_2017_alaska <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(alaska,fatalities_population_2017)</span>
<span id="cb12-866"><a href="#cb12-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-867"><a href="#cb12-867" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating District of Columbia Lat Long Manually</span></span>
<span id="cb12-868"><a href="#cb12-868" aria-hidden="true" tabindex="-1"></a>dc_row <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">long =</span> <span class="sc">-</span><span class="fl">77.0369</span>,  <span class="co"># Longitude for Washington, D.C.</span></span>
<span id="cb12-869"><a href="#cb12-869" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lat =</span> <span class="fl">38.9072</span>,    <span class="co"># Latitude for Washington, D.C.</span></span>
<span id="cb12-870"><a href="#cb12-870" aria-hidden="true" tabindex="-1"></a>                     <span class="at">state =</span> <span class="st">"District of Columbia"</span>,</span>
<span id="cb12-871"><a href="#cb12-871" aria-hidden="true" tabindex="-1"></a>                     <span class="at">region =</span> <span class="fu">tolower</span>(<span class="st">"District of Columbia"</span>))</span>
<span id="cb12-872"><a href="#cb12-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-873"><a href="#cb12-873" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Labels data frame to map the labels at the centre of each state with state name and intensity</span></span>
<span id="cb12-874"><a href="#cb12-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-875"><a href="#cb12-875" aria-hidden="true" tabindex="-1"></a>label_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">long =</span> state.center<span class="sc">$</span>x,</span>
<span id="cb12-876"><a href="#cb12-876" aria-hidden="true" tabindex="-1"></a>                         <span class="at">lat =</span> state.center<span class="sc">$</span>y,</span>
<span id="cb12-877"><a href="#cb12-877" aria-hidden="true" tabindex="-1"></a>                         <span class="at">state =</span> state.name) <span class="sc">|&gt;</span></span>
<span id="cb12-878"><a href="#cb12-878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-879"><a href="#cb12-879" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(state)</span>
<span id="cb12-880"><a href="#cb12-880" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-881"><a href="#cb12-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-882"><a href="#cb12-882" aria-hidden="true" tabindex="-1"></a>label_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(label_data, dc_row)</span>
<span id="cb12-883"><a href="#cb12-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-884"><a href="#cb12-884" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating each year intensity information in columns</span></span>
<span id="cb12-885"><a href="#cb12-885" aria-hidden="true" tabindex="-1"></a>label_data <span class="ot">&lt;-</span> <span class="fu">full_join</span>(label_data,fatalities_population_2015, <span class="at">by =</span> <span class="st">"region"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-886"><a href="#cb12-886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(long, lat, region, STATE,intensity) <span class="sc">|&gt;</span></span>
<span id="cb12-887"><a href="#cb12-887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb12-888"><a href="#cb12-888" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity_2015 =</span> intensity)</span>
<span id="cb12-889"><a href="#cb12-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-890"><a href="#cb12-890" aria-hidden="true" tabindex="-1"></a>label_data <span class="ot">&lt;-</span> <span class="fu">full_join</span>(label_data,fatalities_population_2016, <span class="at">by =</span> <span class="st">"region"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-891"><a href="#cb12-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(long, lat, region, STATE.x,intensity_2015, intensity) <span class="sc">|&gt;</span></span>
<span id="cb12-892"><a href="#cb12-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb12-893"><a href="#cb12-893" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity_2016 =</span> intensity,</span>
<span id="cb12-894"><a href="#cb12-894" aria-hidden="true" tabindex="-1"></a>    <span class="at">STATE =</span> STATE.x)</span>
<span id="cb12-895"><a href="#cb12-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-896"><a href="#cb12-896" aria-hidden="true" tabindex="-1"></a>label_data <span class="ot">&lt;-</span> <span class="fu">full_join</span>(label_data,fatalities_population_2017, <span class="at">by =</span> <span class="st">"region"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-897"><a href="#cb12-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(long, lat,region, STATE.x,intensity_2015,intensity_2016, intensity) <span class="sc">|&gt;</span></span>
<span id="cb12-898"><a href="#cb12-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb12-899"><a href="#cb12-899" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity_2017 =</span> intensity,</span>
<span id="cb12-900"><a href="#cb12-900" aria-hidden="true" tabindex="-1"></a>    <span class="at">STATE =</span> STATE.x) <span class="sc">|&gt;</span></span>
<span id="cb12-901"><a href="#cb12-901" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-902"><a href="#cb12-902" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity_2017_up =</span> intensity_2017<span class="sc">*</span><span class="fl">1.75</span></span>
<span id="cb12-903"><a href="#cb12-903" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-904"><a href="#cb12-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-905"><a href="#cb12-905" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Alaka Label information separately</span></span>
<span id="cb12-906"><a href="#cb12-906" aria-hidden="true" tabindex="-1"></a>alaska_label <span class="ot">&lt;-</span> label_data <span class="sc">|&gt;</span></span>
<span id="cb12-907"><a href="#cb12-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-908"><a href="#cb12-908" aria-hidden="true" tabindex="-1"></a>    STATE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Alaska"</span>)</span>
<span id="cb12-909"><a href="#cb12-909" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb12-910"><a href="#cb12-910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-911"><a href="#cb12-911" aria-hidden="true" tabindex="-1"></a>    <span class="at">long =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-912"><a href="#cb12-912" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">==</span> <span class="st">"Alaska"</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">150</span>,</span>
<span id="cb12-913"><a href="#cb12-913" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">!=</span> <span class="st">"Alaska"</span> <span class="sc">~</span> long</span>
<span id="cb12-914"><a href="#cb12-914" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb12-915"><a href="#cb12-915" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-916"><a href="#cb12-916" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">==</span> <span class="st">"Alaska"</span> <span class="sc">~</span> <span class="dv">65</span>,</span>
<span id="cb12-917"><a href="#cb12-917" aria-hidden="true" tabindex="-1"></a>      STATE <span class="sc">!=</span> <span class="st">"Alaska"</span> <span class="sc">~</span> lat</span>
<span id="cb12-918"><a href="#cb12-918" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-919"><a href="#cb12-919" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-920"><a href="#cb12-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-921"><a href="#cb12-921" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing Alaska from label_data as in above alaksa_label is already created</span></span>
<span id="cb12-922"><a href="#cb12-922" aria-hidden="true" tabindex="-1"></a>label_data <span class="ot">&lt;-</span>label_data <span class="sc">|&gt;</span></span>
<span id="cb12-923"><a href="#cb12-923" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-924"><a href="#cb12-924" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span>(STATE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Hawaii"</span>, <span class="st">"Alaska"</span>))</span>
<span id="cb12-925"><a href="#cb12-925" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-926"><a href="#cb12-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-927"><a href="#cb12-927" aria-hidden="true" tabindex="-1"></a>label_data<span class="sc">$</span>STATE[label_data<span class="sc">$</span>region<span class="sc">==</span><span class="st">"rhode island"</span>] <span class="ot">&lt;-</span> <span class="st">"Rhode Island"</span></span>
<span id="cb12-928"><a href="#cb12-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-929"><a href="#cb12-929" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating 2015 Shooting Intensity plot for Alaska which will be annotated in usa map</span></span>
<span id="cb12-930"><a href="#cb12-930" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-931"><a href="#cb12-931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2015_alaska,</span>
<span id="cb12-932"><a href="#cb12-932" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat,<span class="at">group=</span>group), <span class="at">fill =</span> <span class="st">"#e69e91"</span>,</span>
<span id="cb12-933"><a href="#cb12-933" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb12-934"><a href="#cb12-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2015_alaska<span class="sc">$</span>long, <span class="at">y =</span> merge_2015_alaska<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb12-935"><a href="#cb12-935" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> alaska_label, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(STATE,<span class="st">":</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity_2015,<span class="dv">1</span>))), <span class="at">size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb12-936"><a href="#cb12-936" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb12-937"><a href="#cb12-937" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb12-938"><a href="#cb12-938" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>))</span>
<span id="cb12-939"><a href="#cb12-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-940"><a href="#cb12-940" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating 2015 Shooting Intensity plot for USA </span></span>
<span id="cb12-941"><a href="#cb12-941" aria-hidden="true" tabindex="-1"></a> plot_2015_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-942"><a href="#cb12-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2015_us,</span>
<span id="cb12-943"><a href="#cb12-943" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> intensity),</span>
<span id="cb12-944"><a href="#cb12-944" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb12-945"><a href="#cb12-945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#fee5d9"</span>, <span class="at">high =</span> <span class="st">"#a50f15"</span>, <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb12-946"><a href="#cb12-946" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"Intensity"</span>) <span class="sc">+</span></span>
<span id="cb12-947"><a href="#cb12-947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> label_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intensity_2015 <span class="sc">&gt;</span> <span class="dv">3</span>), <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(STATE,<span class="st">":</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity_2015,<span class="dv">1</span>))), <span class="at">size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb12-948"><a href="#cb12-948" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2015_us<span class="sc">$</span>long, <span class="at">y =</span> merge_2015_us<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb12-949"><a href="#cb12-949" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shooting Intensity by State : 2015"</span>,</span>
<span id="cb12-950"><a href="#cb12-950" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Per Million of Population"</span>,</span>
<span id="cb12-951"><a href="#cb12-951" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Highlighted states have shooting intensity &gt; 3 : #"</span>, <span class="fu">length</span>(fatalities_population_2015<span class="sc">$</span>intensity[fatalities_population_2015<span class="sc">$</span>intensity<span class="sc">&gt;</span><span class="dv">3</span>]),</span>
<span id="cb12-952"><a href="#cb12-952" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\n</span><span class="st"> Grey states indicate no fatalties in that year"</span>)</span>
<span id="cb12-953"><a href="#cb12-953" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb12-954"><a href="#cb12-954" aria-hidden="true" tabindex="-1"></a>       <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(plot1),<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">130</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">40</span>) <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb12-955"><a href="#cb12-955" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-956"><a href="#cb12-956" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb12-957"><a href="#cb12-957" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">"cm"</span>),</span>
<span id="cb12-958"><a href="#cb12-958" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">48</span>),</span>
<span id="cb12-959"><a href="#cb12-959" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">48</span>),</span>
<span id="cb12-960"><a href="#cb12-960" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">96</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb12-961"><a href="#cb12-961" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">80</span>),</span>
<span id="cb12-962"><a href="#cb12-962" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">40</span>)</span>
<span id="cb12-963"><a href="#cb12-963" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb12-964"><a href="#cb12-964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb12-965"><a href="#cb12-965" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb12-966"><a href="#cb12-966" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span><span class="dv">80</span>,</span>
<span id="cb12-967"><a href="#cb12-967" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">45</span>,</span>
<span id="cb12-968"><a href="#cb12-968" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Top 3 by Shooting Intensity:</span></span>
<span id="cb12-969"><a href="#cb12-969" aria-hidden="true" tabindex="-1"></a><span class="st">    1) Wyoming</span></span>
<span id="cb12-970"><a href="#cb12-970" aria-hidden="true" tabindex="-1"></a><span class="st">    2) New Mexico</span></span>
<span id="cb12-971"><a href="#cb12-971" aria-hidden="true" tabindex="-1"></a><span class="st">    3) Oklahoma"</span>,</span>
<span id="cb12-972"><a href="#cb12-972" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb12-973"><a href="#cb12-973" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"italic"</span>,</span>
<span id="cb12-974"><a href="#cb12-974" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb12-975"><a href="#cb12-975" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb12-976"><a href="#cb12-976" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb12-977"><a href="#cb12-977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb12-978"><a href="#cb12-978" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb12-979"><a href="#cb12-979" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span><span class="dv">70</span>,</span>
<span id="cb12-980"><a href="#cb12-980" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">30</span>,</span>
<span id="cb12-981"><a href="#cb12-981" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Top 3 by Total Fatalities:</span></span>
<span id="cb12-982"><a href="#cb12-982" aria-hidden="true" tabindex="-1"></a><span class="st">    1) California</span></span>
<span id="cb12-983"><a href="#cb12-983" aria-hidden="true" tabindex="-1"></a><span class="st">    2) Texas</span></span>
<span id="cb12-984"><a href="#cb12-984" aria-hidden="true" tabindex="-1"></a><span class="st">    3) Florida"</span>,</span>
<span id="cb12-985"><a href="#cb12-985" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb12-986"><a href="#cb12-986" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"italic"</span>,</span>
<span id="cb12-987"><a href="#cb12-987" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb12-988"><a href="#cb12-988" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb12-989"><a href="#cb12-989" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-990"><a href="#cb12-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-991"><a href="#cb12-991" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating 2016 Shooting Intensity plot for Alaska which will be annotated in usa map</span></span>
<span id="cb12-992"><a href="#cb12-992" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-993"><a href="#cb12-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2016_alaska,</span>
<span id="cb12-994"><a href="#cb12-994" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat,<span class="at">group=</span>group), <span class="at">fill =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb12-995"><a href="#cb12-995" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb12-996"><a href="#cb12-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2016_alaska<span class="sc">$</span>long, <span class="at">y =</span> merge_2016_alaska<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb12-997"><a href="#cb12-997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> alaska_label, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(STATE,<span class="st">":</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity_2016,<span class="dv">1</span>))), <span class="at">size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb12-998"><a href="#cb12-998" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb12-999"><a href="#cb12-999" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb12-1000"><a href="#cb12-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>))</span>
<span id="cb12-1001"><a href="#cb12-1001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1002"><a href="#cb12-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1003"><a href="#cb12-1003" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating 2016 Shooting Intensity plot for USA </span></span>
<span id="cb12-1004"><a href="#cb12-1004" aria-hidden="true" tabindex="-1"></a>plot_2016_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-1005"><a href="#cb12-1005" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2016_us,</span>
<span id="cb12-1006"><a href="#cb12-1006" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> intensity),</span>
<span id="cb12-1007"><a href="#cb12-1007" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb12-1008"><a href="#cb12-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#fee5d9"</span>, <span class="at">high =</span> <span class="st">"#a50f15"</span>, <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb12-1009"><a href="#cb12-1009" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"Intensity"</span>) <span class="sc">+</span></span>
<span id="cb12-1010"><a href="#cb12-1010" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> label_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intensity_2016 <span class="sc">&gt;</span> <span class="dv">3</span>), <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(STATE,<span class="st">":</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity_2016,<span class="dv">1</span>))), <span class="at">size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb12-1011"><a href="#cb12-1011" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2016_us<span class="sc">$</span>long, <span class="at">y =</span> merge_2016_us<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb12-1012"><a href="#cb12-1012" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shooting Intensity by State : 2016"</span>,</span>
<span id="cb12-1013"><a href="#cb12-1013" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Per Million of Population"</span>,</span>
<span id="cb12-1014"><a href="#cb12-1014" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Highlighted states have shooting intensity &gt; 3 : #"</span>, <span class="fu">length</span>(fatalities_population_2016<span class="sc">$</span>intensity[fatalities_population_2016<span class="sc">$</span>intensity<span class="sc">&gt;</span><span class="dv">3</span>]),</span>
<span id="cb12-1015"><a href="#cb12-1015" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\n</span><span class="st"> Grey states indicate no fatalties in that year"</span>)</span>
<span id="cb12-1016"><a href="#cb12-1016" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb12-1017"><a href="#cb12-1017" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(plot2),<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">130</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">40</span>) <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb12-1018"><a href="#cb12-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-1019"><a href="#cb12-1019" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb12-1020"><a href="#cb12-1020" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">"cm"</span>),</span>
<span id="cb12-1021"><a href="#cb12-1021" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">48</span>),</span>
<span id="cb12-1022"><a href="#cb12-1022" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">48</span>),</span>
<span id="cb12-1023"><a href="#cb12-1023" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">96</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb12-1024"><a href="#cb12-1024" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">80</span>),</span>
<span id="cb12-1025"><a href="#cb12-1025" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">40</span>)</span>
<span id="cb12-1026"><a href="#cb12-1026" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb12-1027"><a href="#cb12-1027" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb12-1028"><a href="#cb12-1028" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb12-1029"><a href="#cb12-1029" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span><span class="dv">80</span>,</span>
<span id="cb12-1030"><a href="#cb12-1030" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">45</span>,</span>
<span id="cb12-1031"><a href="#cb12-1031" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Top 3 by Shooting Intensity:</span></span>
<span id="cb12-1032"><a href="#cb12-1032" aria-hidden="true" tabindex="-1"></a><span class="st">    1) New Mexico</span></span>
<span id="cb12-1033"><a href="#cb12-1033" aria-hidden="true" tabindex="-1"></a><span class="st">    2) Alaska</span></span>
<span id="cb12-1034"><a href="#cb12-1034" aria-hidden="true" tabindex="-1"></a><span class="st">    3) District of Columbia"</span>,</span>
<span id="cb12-1035"><a href="#cb12-1035" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb12-1036"><a href="#cb12-1036" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"italic"</span>,</span>
<span id="cb12-1037"><a href="#cb12-1037" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb12-1038"><a href="#cb12-1038" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb12-1039"><a href="#cb12-1039" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb12-1040"><a href="#cb12-1040" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb12-1041"><a href="#cb12-1041" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb12-1042"><a href="#cb12-1042" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span><span class="dv">75</span>,</span>
<span id="cb12-1043"><a href="#cb12-1043" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">30</span>,</span>
<span id="cb12-1044"><a href="#cb12-1044" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Top 3 by Total Fatalities:</span></span>
<span id="cb12-1045"><a href="#cb12-1045" aria-hidden="true" tabindex="-1"></a><span class="st">    1) California</span></span>
<span id="cb12-1046"><a href="#cb12-1046" aria-hidden="true" tabindex="-1"></a><span class="st">    2) Texas</span></span>
<span id="cb12-1047"><a href="#cb12-1047" aria-hidden="true" tabindex="-1"></a><span class="st">    3) Florida"</span>,</span>
<span id="cb12-1048"><a href="#cb12-1048" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb12-1049"><a href="#cb12-1049" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"italic"</span>,</span>
<span id="cb12-1050"><a href="#cb12-1050" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb12-1051"><a href="#cb12-1051" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb12-1052"><a href="#cb12-1052" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1053"><a href="#cb12-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1054"><a href="#cb12-1054" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating 2017 Shooting Intensity plot for Alaska which will be annotated in usa map</span></span>
<span id="cb12-1055"><a href="#cb12-1055" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-1056"><a href="#cb12-1056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2017_alaska,</span>
<span id="cb12-1057"><a href="#cb12-1057" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat,<span class="at">group=</span>group), <span class="at">fill =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb12-1058"><a href="#cb12-1058" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb12-1059"><a href="#cb12-1059" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2017_alaska<span class="sc">$</span>long, <span class="at">y =</span> merge_2017_alaska<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb12-1060"><a href="#cb12-1060" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> alaska_label, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(STATE,<span class="st">":</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity_2017_up,<span class="dv">1</span>))), <span class="at">size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb12-1061"><a href="#cb12-1061" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb12-1062"><a href="#cb12-1062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb12-1063"><a href="#cb12-1063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>))</span>
<span id="cb12-1064"><a href="#cb12-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1065"><a href="#cb12-1065" aria-hidden="true" tabindex="-1"></a><span class="do">## Creating 2017 Shooting Intensity plot for USA </span></span>
<span id="cb12-1066"><a href="#cb12-1066" aria-hidden="true" tabindex="-1"></a>plot_2017_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-1067"><a href="#cb12-1067" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2017_us,</span>
<span id="cb12-1068"><a href="#cb12-1068" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> intensity),</span>
<span id="cb12-1069"><a href="#cb12-1069" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb12-1070"><a href="#cb12-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#fee5d9"</span>, <span class="at">high =</span> <span class="st">"#a50f15"</span>, <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb12-1071"><a href="#cb12-1071" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"Intensity"</span>) <span class="sc">+</span></span>
<span id="cb12-1072"><a href="#cb12-1072" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> label_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intensity_2017_up <span class="sc">&gt;</span> <span class="dv">3</span>), <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(STATE,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity_2017_up,<span class="dv">1</span>))), <span class="at">size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb12-1073"><a href="#cb12-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2017_us<span class="sc">$</span>long, <span class="at">y =</span> merge_2017_us<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb12-1074"><a href="#cb12-1074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shooting Intensity by State : 2017"</span>,</span>
<span id="cb12-1075"><a href="#cb12-1075" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Per Million of Population"</span>,</span>
<span id="cb12-1076"><a href="#cb12-1076" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">"Highlighted states have shooting intensity &gt; 3 : #"</span>, <span class="fu">length</span>(fatalities_population_2017<span class="sc">$</span>intensity[fatalities_population_2017<span class="sc">$</span>intensity<span class="sc">&gt;</span><span class="fl">1.75</span>]),</span>
<span id="cb12-1077"><a href="#cb12-1077" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\n</span><span class="st"> data scaled by 1.75 times, original data was till July 2017"</span>,</span>
<span id="cb12-1078"><a href="#cb12-1078" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"</span><span class="sc">\n</span><span class="st"> Grey states indicate no fatalties in that year"</span>)</span>
<span id="cb12-1079"><a href="#cb12-1079" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-1080"><a href="#cb12-1080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(plot3),<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">130</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">40</span>) <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb12-1081"><a href="#cb12-1081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-1082"><a href="#cb12-1082" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb12-1083"><a href="#cb12-1083" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">"cm"</span>),</span>
<span id="cb12-1084"><a href="#cb12-1084" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">48</span>),</span>
<span id="cb12-1085"><a href="#cb12-1085" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">48</span>),</span>
<span id="cb12-1086"><a href="#cb12-1086" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">96</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb12-1087"><a href="#cb12-1087" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">80</span>),</span>
<span id="cb12-1088"><a href="#cb12-1088" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">40</span>)</span>
<span id="cb12-1089"><a href="#cb12-1089" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb12-1090"><a href="#cb12-1090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb12-1091"><a href="#cb12-1091" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb12-1092"><a href="#cb12-1092" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span><span class="dv">80</span>,</span>
<span id="cb12-1093"><a href="#cb12-1093" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">45</span>,</span>
<span id="cb12-1094"><a href="#cb12-1094" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Top 3 by Shooting Intensity:</span></span>
<span id="cb12-1095"><a href="#cb12-1095" aria-hidden="true" tabindex="-1"></a><span class="st">    1) Maine</span></span>
<span id="cb12-1096"><a href="#cb12-1096" aria-hidden="true" tabindex="-1"></a><span class="st">    2) Alaska</span></span>
<span id="cb12-1097"><a href="#cb12-1097" aria-hidden="true" tabindex="-1"></a><span class="st">    3) Oklahoma"</span>,</span>
<span id="cb12-1098"><a href="#cb12-1098" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb12-1099"><a href="#cb12-1099" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"italic"</span>,</span>
<span id="cb12-1100"><a href="#cb12-1100" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb12-1101"><a href="#cb12-1101" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb12-1102"><a href="#cb12-1102" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb12-1103"><a href="#cb12-1103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb12-1104"><a href="#cb12-1104" aria-hidden="true" tabindex="-1"></a>    <span class="st">"text"</span>,</span>
<span id="cb12-1105"><a href="#cb12-1105" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">-</span><span class="dv">75</span>,</span>
<span id="cb12-1106"><a href="#cb12-1106" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">30</span>,</span>
<span id="cb12-1107"><a href="#cb12-1107" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"Top 3 by Total Fatalities:</span></span>
<span id="cb12-1108"><a href="#cb12-1108" aria-hidden="true" tabindex="-1"></a><span class="st">    1) California</span></span>
<span id="cb12-1109"><a href="#cb12-1109" aria-hidden="true" tabindex="-1"></a><span class="st">    2) Texas</span></span>
<span id="cb12-1110"><a href="#cb12-1110" aria-hidden="true" tabindex="-1"></a><span class="st">    3) Florida"</span>,</span>
<span id="cb12-1111"><a href="#cb12-1111" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">20</span>,</span>
<span id="cb12-1112"><a href="#cb12-1112" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontface =</span> <span class="st">"italic"</span>,</span>
<span id="cb12-1113"><a href="#cb12-1113" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#a50f15"</span>,</span>
<span id="cb12-1114"><a href="#cb12-1114" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb12-1115"><a href="#cb12-1115" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1116"><a href="#cb12-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1117"><a href="#cb12-1117" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating an animation for above map plots with better resolution</span></span>
<span id="cb12-1118"><a href="#cb12-1118" aria-hidden="true" tabindex="-1"></a>animation<span class="sc">::</span><span class="fu">saveGIF</span>(</span>
<span id="cb12-1119"><a href="#cb12-1119" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb12-1120"><a href="#cb12-1120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(plot_2015_map)</span>
<span id="cb12-1121"><a href="#cb12-1121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(plot_2016_map)</span>
<span id="cb12-1122"><a href="#cb12-1122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(plot_2017_map)</span>
<span id="cb12-1123"><a href="#cb12-1123" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb12-1124"><a href="#cb12-1124" aria-hidden="true" tabindex="-1"></a>  <span class="at">movie.name =</span> <span class="st">"shooting_intensity.gif"</span>,</span>
<span id="cb12-1125"><a href="#cb12-1125" aria-hidden="true" tabindex="-1"></a>  <span class="at">interval =</span> <span class="dv">4</span>,</span>
<span id="cb12-1126"><a href="#cb12-1126" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.width =</span> <span class="dv">4800</span>,</span>
<span id="cb12-1127"><a href="#cb12-1127" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.height =</span> <span class="dv">3000</span>,</span>
<span id="cb12-1128"><a href="#cb12-1128" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.dev =</span> <span class="st">"png"</span>,</span>
<span id="cb12-1129"><a href="#cb12-1129" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.type =</span> <span class="st">"cairo"</span>,</span>
<span id="cb12-1130"><a href="#cb12-1130" aria-hidden="true" tabindex="-1"></a>  <span class="at">res =</span> <span class="dv">200</span>,</span>
<span id="cb12-1131"><a href="#cb12-1131" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.x =</span> <span class="st">"in"</span>,</span>
<span id="cb12-1132"><a href="#cb12-1132" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.y =</span> <span class="st">"in"</span>,</span>
<span id="cb12-1133"><a href="#cb12-1133" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.unit =</span> <span class="st">"in"</span>,</span>
<span id="cb12-1134"><a href="#cb12-1134" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.bg =</span> <span class="st">"white"</span>,</span>
<span id="cb12-1135"><a href="#cb12-1135" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.fps =</span> <span class="dv">3</span></span>
<span id="cb12-1136"><a href="#cb12-1136" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1137"><a href="#cb12-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1138"><a href="#cb12-1138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-1139"><a href="#cb12-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1140"><a href="#cb12-1140" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/shooting_intensity.gif)</span>{fig-align="center"}</span>
<span id="cb12-1141"><a href="#cb12-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1142"><a href="#cb12-1142" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot 2</span></span>
<span id="cb12-1143"><a href="#cb12-1143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1146"><a href="#cb12-1146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-1147"><a href="#cb12-1147" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Q2-plot2</span></span>
<span id="cb12-1148"><a href="#cb12-1148" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-1149"><a href="#cb12-1149" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb12-1150"><a href="#cb12-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1151"><a href="#cb12-1151" aria-hidden="true" tabindex="-1"></a>city_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/us-cities-top-1k-multi-year.csv"</span>)</span>
<span id="cb12-1152"><a href="#cb12-1152" aria-hidden="true" tabindex="-1"></a>state_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/Population_Estimate_data_Statewise_2010-2023.csv"</span>)</span>
<span id="cb12-1153"><a href="#cb12-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1154"><a href="#cb12-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1155"><a href="#cb12-1155" aria-hidden="true" tabindex="-1"></a>state_abbreviations <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb12-1156"><a href="#cb12-1156" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Alabama"</span> <span class="ot">=</span> <span class="st">"AL"</span>, <span class="st">"Alaska"</span> <span class="ot">=</span> <span class="st">"AK"</span>, <span class="st">"Arizona"</span> <span class="ot">=</span> <span class="st">"AZ"</span>, <span class="st">"Arkansas"</span> <span class="ot">=</span> <span class="st">"AR"</span>,</span>
<span id="cb12-1157"><a href="#cb12-1157" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span> <span class="ot">=</span> <span class="st">"CA"</span>, <span class="st">"Colorado"</span> <span class="ot">=</span> <span class="st">"CO"</span>, <span class="st">"Connecticut"</span> <span class="ot">=</span> <span class="st">"CT"</span>, <span class="st">"Delaware"</span> <span class="ot">=</span> <span class="st">"DE"</span>,</span>
<span id="cb12-1158"><a href="#cb12-1158" aria-hidden="true" tabindex="-1"></a>  <span class="st">"District of Columbia"</span> <span class="ot">=</span> <span class="st">"DC"</span>, <span class="st">"Florida"</span> <span class="ot">=</span> <span class="st">"FL"</span>, <span class="st">"Georgia"</span> <span class="ot">=</span> <span class="st">"GA"</span>, <span class="st">"Hawaii"</span> <span class="ot">=</span> <span class="st">"HI"</span>,</span>
<span id="cb12-1159"><a href="#cb12-1159" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Idaho"</span> <span class="ot">=</span> <span class="st">"ID"</span>, <span class="st">"Illinois"</span> <span class="ot">=</span> <span class="st">"IL"</span>, <span class="st">"Indiana"</span> <span class="ot">=</span> <span class="st">"IN"</span>, <span class="st">"Iowa"</span> <span class="ot">=</span> <span class="st">"IA"</span>, <span class="st">"Kansas"</span> <span class="ot">=</span> <span class="st">"KS"</span>,</span>
<span id="cb12-1160"><a href="#cb12-1160" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Kentucky"</span> <span class="ot">=</span> <span class="st">"KY"</span>, <span class="st">"Louisiana"</span> <span class="ot">=</span> <span class="st">"LA"</span>, <span class="st">"Maine"</span> <span class="ot">=</span> <span class="st">"ME"</span>, <span class="st">"Maryland"</span> <span class="ot">=</span> <span class="st">"MD"</span>, <span class="st">"Massachusetts"</span> <span class="ot">=</span> <span class="st">"MA"</span>,</span>
<span id="cb12-1161"><a href="#cb12-1161" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Michigan"</span> <span class="ot">=</span> <span class="st">"MI"</span>, <span class="st">"Minnesota"</span> <span class="ot">=</span> <span class="st">"MN"</span>, <span class="st">"Mississippi"</span> <span class="ot">=</span> <span class="st">"MS"</span>, <span class="st">"Missouri"</span> <span class="ot">=</span> <span class="st">"MO"</span>, <span class="st">"Montana"</span> <span class="ot">=</span> <span class="st">"MT"</span>,</span>
<span id="cb12-1162"><a href="#cb12-1162" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Nebraska"</span> <span class="ot">=</span> <span class="st">"NE"</span>, <span class="st">"Nevada"</span> <span class="ot">=</span> <span class="st">"NV"</span>, <span class="st">"New Hampshire"</span> <span class="ot">=</span> <span class="st">"NH"</span>, <span class="st">"New Jersey"</span> <span class="ot">=</span> <span class="st">"NJ"</span>, <span class="st">"New Mexico"</span> <span class="ot">=</span> <span class="st">"NM"</span>,</span>
<span id="cb12-1163"><a href="#cb12-1163" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New York"</span> <span class="ot">=</span> <span class="st">"NY"</span>, <span class="st">"North Carolina"</span> <span class="ot">=</span> <span class="st">"NC"</span>, <span class="st">"North Dakota"</span> <span class="ot">=</span> <span class="st">"ND"</span>, <span class="st">"Ohio"</span> <span class="ot">=</span> <span class="st">"OH"</span>, <span class="st">"Oklahoma"</span> <span class="ot">=</span> <span class="st">"OK"</span>,</span>
<span id="cb12-1164"><a href="#cb12-1164" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Oregon"</span> <span class="ot">=</span> <span class="st">"OR"</span>, <span class="st">"Pennsylvania"</span> <span class="ot">=</span> <span class="st">"PA"</span>, <span class="st">"Rhode Island"</span> <span class="ot">=</span> <span class="st">"RI"</span>, <span class="st">"South Carolina"</span> <span class="ot">=</span> <span class="st">"SC"</span>, <span class="st">"South Dakota"</span> <span class="ot">=</span> <span class="st">"SD"</span>,</span>
<span id="cb12-1165"><a href="#cb12-1165" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Tennessee"</span> <span class="ot">=</span> <span class="st">"TN"</span>, <span class="st">"Texas"</span> <span class="ot">=</span> <span class="st">"TX"</span>, <span class="st">"Utah"</span> <span class="ot">=</span> <span class="st">"UT"</span>, <span class="st">"Vermont"</span> <span class="ot">=</span> <span class="st">"VT"</span>, <span class="st">"Virginia"</span> <span class="ot">=</span> <span class="st">"VA"</span>, <span class="st">"Washington"</span> <span class="ot">=</span> <span class="st">"WA"</span>,</span>
<span id="cb12-1166"><a href="#cb12-1166" aria-hidden="true" tabindex="-1"></a>  <span class="st">"West Virginia"</span> <span class="ot">=</span> <span class="st">"WV"</span>, <span class="st">"Wisconsin"</span> <span class="ot">=</span> <span class="st">"WI"</span>, <span class="st">"Wyoming"</span> <span class="ot">=</span> <span class="st">"WY"</span>, <span class="st">"Puerto Rico"</span> <span class="ot">=</span> <span class="st">"PR"</span></span>
<span id="cb12-1167"><a href="#cb12-1167" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-1168"><a href="#cb12-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1169"><a href="#cb12-1169" aria-hidden="true" tabindex="-1"></a>state_abbreviations_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">STATE =</span> <span class="fu">names</span>(state_abbreviations),</span>
<span id="cb12-1170"><a href="#cb12-1170" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">state =</span> state_abbreviations,</span>
<span id="cb12-1171"><a href="#cb12-1171" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb12-1172"><a href="#cb12-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1173"><a href="#cb12-1173" aria-hidden="true" tabindex="-1"></a>fatality_summaries_year <span class="ot">&lt;-</span></span>
<span id="cb12-1174"><a href="#cb12-1174" aria-hidden="true" tabindex="-1"></a>  fatality <span class="sc">|&gt;</span> </span>
<span id="cb12-1175"><a href="#cb12-1175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-1176"><a href="#cb12-1176" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(fatality<span class="sc">$</span>date,<span class="at">format =</span> <span class="st">"%d/%m/%y"</span>))</span>
<span id="cb12-1177"><a href="#cb12-1177" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-1178"><a href="#cb12-1178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state,year) <span class="sc">|&gt;</span></span>
<span id="cb12-1179"><a href="#cb12-1179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fatalities_count =</span> <span class="fu">n</span>() , <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb12-1180"><a href="#cb12-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1181"><a href="#cb12-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1182"><a href="#cb12-1182" aria-hidden="true" tabindex="-1"></a>state_pop_updated <span class="ot">&lt;-</span> </span>
<span id="cb12-1183"><a href="#cb12-1183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(state_pop,state_abbreviations_df) <span class="sc">|&gt;</span></span>
<span id="cb12-1184"><a href="#cb12-1184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb12-1185"><a href="#cb12-1185" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"POP"</span>),</span>
<span id="cb12-1186"><a href="#cb12-1186" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb12-1187"><a href="#cb12-1187" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"popuplation"</span></span>
<span id="cb12-1188"><a href="#cb12-1188" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb12-1189"><a href="#cb12-1189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-1190"><a href="#cb12-1190" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-1191"><a href="#cb12-1191" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2010"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/10"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1192"><a href="#cb12-1192" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2011"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/11"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1193"><a href="#cb12-1193" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2012"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/12"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1194"><a href="#cb12-1194" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2013"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/13"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1195"><a href="#cb12-1195" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2014"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/14"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1196"><a href="#cb12-1196" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2015"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/15"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1197"><a href="#cb12-1197" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2016"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/16"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1198"><a href="#cb12-1198" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2017"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/17"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1199"><a href="#cb12-1199" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2018"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/18"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1200"><a href="#cb12-1200" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2019"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/19"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1201"><a href="#cb12-1201" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2020"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/20"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1202"><a href="#cb12-1202" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2021"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/21"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1203"><a href="#cb12-1203" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2022"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/22"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1204"><a href="#cb12-1204" aria-hidden="true" tabindex="-1"></a>      year <span class="sc">==</span> <span class="st">"POPESTIMATE2023"</span> <span class="sc">~</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(<span class="st">"01/01/23"</span>,<span class="at">format=</span><span class="st">"%d/%m/%y"</span>)),</span>
<span id="cb12-1205"><a href="#cb12-1205" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-1206"><a href="#cb12-1206" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1207"><a href="#cb12-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1208"><a href="#cb12-1208" aria-hidden="true" tabindex="-1"></a>fatalities_population <span class="ot">&lt;-</span> <span class="fu">merge</span>(fatality_summaries_year,state_pop_updated)</span>
<span id="cb12-1209"><a href="#cb12-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1210"><a href="#cb12-1210" aria-hidden="true" tabindex="-1"></a>city_fatality_summaries_year <span class="ot">&lt;-</span> fatality <span class="sc">|&gt;</span> </span>
<span id="cb12-1211"><a href="#cb12-1211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-1212"><a href="#cb12-1212" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(fatality<span class="sc">$</span>date,<span class="at">format =</span> <span class="st">"%d/%m/%y"</span>))</span>
<span id="cb12-1213"><a href="#cb12-1213" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-1214"><a href="#cb12-1214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state,city,year) <span class="sc">|&gt;</span></span>
<span id="cb12-1215"><a href="#cb12-1215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fatalities_count =</span> <span class="fu">n</span>() , <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb12-1216"><a href="#cb12-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1217"><a href="#cb12-1217" aria-hidden="true" tabindex="-1"></a>city_fatality_summaries_year1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(city_fatality_summaries_year,</span>
<span id="cb12-1218"><a href="#cb12-1218" aria-hidden="true" tabindex="-1"></a>                                        city_fatality_summaries_year<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2015</span>)</span>
<span id="cb12-1219"><a href="#cb12-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1220"><a href="#cb12-1220" aria-hidden="true" tabindex="-1"></a>city_fatality_summaries_year2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(city_fatality_summaries_year,</span>
<span id="cb12-1221"><a href="#cb12-1221" aria-hidden="true" tabindex="-1"></a>                                        city_fatality_summaries_year<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2016</span>)</span>
<span id="cb12-1222"><a href="#cb12-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1223"><a href="#cb12-1223" aria-hidden="true" tabindex="-1"></a>fatality_summaries_year <span class="ot">&lt;-</span> <span class="fu">rbind</span>(city_fatality_summaries_year1,</span>
<span id="cb12-1224"><a href="#cb12-1224" aria-hidden="true" tabindex="-1"></a>                                 city_fatality_summaries_year2)</span>
<span id="cb12-1225"><a href="#cb12-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1226"><a href="#cb12-1226" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(city_fatality_summaries_year1,city_fatality_summaries_year2)</span>
<span id="cb12-1227"><a href="#cb12-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1228"><a href="#cb12-1228" aria-hidden="true" tabindex="-1"></a>city_fatalities_population <span class="ot">&lt;-</span> <span class="fu">merge</span>(city_fatality_summaries_year,</span>
<span id="cb12-1229"><a href="#cb12-1229" aria-hidden="true" tabindex="-1"></a>                                    city_pop,</span>
<span id="cb12-1230"><a href="#cb12-1230" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">by.x =</span> <span class="fu">c</span>(<span class="st">"city"</span>,<span class="st">"year"</span>),</span>
<span id="cb12-1231"><a href="#cb12-1231" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">by.y =</span> <span class="fu">c</span>(<span class="st">"City"</span>,<span class="st">"year"</span>))</span>
<span id="cb12-1232"><a href="#cb12-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1233"><a href="#cb12-1233" aria-hidden="true" tabindex="-1"></a>city_fatalities_population_2015 <span class="ot">&lt;-</span> city_fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb12-1234"><a href="#cb12-1234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-1235"><a href="#cb12-1235" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>Population)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb12-1236"><a href="#cb12-1236" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(State)</span>
<span id="cb12-1237"><a href="#cb12-1237" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-1238"><a href="#cb12-1238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-1239"><a href="#cb12-1239" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2015</span>,</span>
<span id="cb12-1240"><a href="#cb12-1240" aria-hidden="true" tabindex="-1"></a>    lon <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">150</span></span>
<span id="cb12-1241"><a href="#cb12-1241" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-1242"><a href="#cb12-1242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(intensity)) <span class="sc">|&gt;</span> </span>
<span id="cb12-1243"><a href="#cb12-1243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(city, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-1244"><a href="#cb12-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1245"><a href="#cb12-1245" aria-hidden="true" tabindex="-1"></a>city_fatalities_population_2016 <span class="ot">&lt;-</span> city_fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb12-1246"><a href="#cb12-1246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-1247"><a href="#cb12-1247" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>Population)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb12-1248"><a href="#cb12-1248" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(State)</span>
<span id="cb12-1249"><a href="#cb12-1249" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-1250"><a href="#cb12-1250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-1251"><a href="#cb12-1251" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2016</span></span>
<span id="cb12-1252"><a href="#cb12-1252" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb12-1253"><a href="#cb12-1253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(intensity)) <span class="sc">|&gt;</span> </span>
<span id="cb12-1254"><a href="#cb12-1254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(city, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-1255"><a href="#cb12-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1256"><a href="#cb12-1256" aria-hidden="true" tabindex="-1"></a>fatalities_population_2015 <span class="ot">&lt;-</span> fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb12-1257"><a href="#cb12-1257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-1258"><a href="#cb12-1258" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>popuplation)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb12-1259"><a href="#cb12-1259" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(STATE)</span>
<span id="cb12-1260"><a href="#cb12-1260" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-1261"><a href="#cb12-1261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-1262"><a href="#cb12-1262" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2015</span></span>
<span id="cb12-1263"><a href="#cb12-1263" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1264"><a href="#cb12-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1265"><a href="#cb12-1265" aria-hidden="true" tabindex="-1"></a>fatalities_population_2016 <span class="ot">&lt;-</span> fatalities_population <span class="sc">|&gt;</span></span>
<span id="cb12-1266"><a href="#cb12-1266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-1267"><a href="#cb12-1267" aria-hidden="true" tabindex="-1"></a>    <span class="at">intensity =</span> (fatalities_count<span class="sc">/</span>popuplation)<span class="sc">*</span><span class="dv">1000000</span>,</span>
<span id="cb12-1268"><a href="#cb12-1268" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(STATE)</span>
<span id="cb12-1269"><a href="#cb12-1269" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-1270"><a href="#cb12-1270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-1271"><a href="#cb12-1271" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="dv">2016</span></span>
<span id="cb12-1272"><a href="#cb12-1272" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1273"><a href="#cb12-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1274"><a href="#cb12-1274" aria-hidden="true" tabindex="-1"></a>us_map_data <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb12-1275"><a href="#cb12-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1276"><a href="#cb12-1276" aria-hidden="true" tabindex="-1"></a>alaska <span class="ot">&lt;-</span></span>
<span id="cb12-1277"><a href="#cb12-1277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_data</span>(<span class="st">"world"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-1278"><a href="#cb12-1278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-1279"><a href="#cb12-1279" aria-hidden="true" tabindex="-1"></a>    region <span class="sc">==</span> <span class="st">"USA"</span> <span class="sc">&amp;</span> (subregion <span class="sc">==</span> <span class="st">"Alaska"</span> ) </span>
<span id="cb12-1280"><a href="#cb12-1280" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-1281"><a href="#cb12-1281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-1282"><a href="#cb12-1282" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">tolower</span>(subregion),</span>
<span id="cb12-1283"><a href="#cb12-1283" aria-hidden="true" tabindex="-1"></a>    <span class="at">order =</span> <span class="fu">max</span>(us_map_data<span class="sc">$</span>order) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb12-1284"><a href="#cb12-1284" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-1285"><a href="#cb12-1285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb12-1286"><a href="#cb12-1286" aria-hidden="true" tabindex="-1"></a>    long <span class="sc">&lt;</span> <span class="dv">0</span></span>
<span id="cb12-1287"><a href="#cb12-1287" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1288"><a href="#cb12-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1289"><a href="#cb12-1289" aria-hidden="true" tabindex="-1"></a>merge_2015_us <span class="ot">&lt;-</span> <span class="fu">full_join</span>(us_map_data,</span>
<span id="cb12-1290"><a href="#cb12-1290" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">subset</span>(fatalities_population_2015,</span>
<span id="cb12-1291"><a href="#cb12-1291" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">!</span>(fatalities_population_2015<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span> <span class="sc">|</span></span>
<span id="cb12-1292"><a href="#cb12-1292" aria-hidden="true" tabindex="-1"></a>                                      fatalities_population_2015<span class="sc">$</span>region<span class="sc">==</span><span class="st">"hawaii"</span>)))</span>
<span id="cb12-1293"><a href="#cb12-1293" aria-hidden="true" tabindex="-1"></a>merge_2015_alaska <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(alaska,fatalities_population_2015)</span>
<span id="cb12-1294"><a href="#cb12-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1295"><a href="#cb12-1295" aria-hidden="true" tabindex="-1"></a>merge_2016_us <span class="ot">&lt;-</span> <span class="fu">full_join</span>(us_map_data,</span>
<span id="cb12-1296"><a href="#cb12-1296" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">subset</span>(fatalities_population_2016,</span>
<span id="cb12-1297"><a href="#cb12-1297" aria-hidden="true" tabindex="-1"></a>                                  <span class="sc">!</span>(fatalities_population_2016<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span> <span class="sc">|</span></span>
<span id="cb12-1298"><a href="#cb12-1298" aria-hidden="true" tabindex="-1"></a>                                      fatalities_population_2016<span class="sc">$</span>region<span class="sc">==</span><span class="st">"hawaii"</span>)))</span>
<span id="cb12-1299"><a href="#cb12-1299" aria-hidden="true" tabindex="-1"></a>merge_2016_alaska <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(alaska,fatalities_population_2016)</span>
<span id="cb12-1300"><a href="#cb12-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1301"><a href="#cb12-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1302"><a href="#cb12-1302" aria-hidden="true" tabindex="-1"></a>plot1_city <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-1303"><a href="#cb12-1303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2015_alaska,</span>
<span id="cb12-1304"><a href="#cb12-1304" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat,<span class="at">group=</span>group), <span class="at">fill =</span> <span class="st">"#e69e91"</span>,</span>
<span id="cb12-1305"><a href="#cb12-1305" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb12-1306"><a href="#cb12-1306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2015_alaska<span class="sc">$</span>long, <span class="at">y =</span> merge_2015_alaska<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb12-1307"><a href="#cb12-1307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb12-1308"><a href="#cb12-1308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb12-1309"><a href="#cb12-1309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb12-1310"><a href="#cb12-1310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(city_fatalities_population_2015,city_fatalities_population_2015<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span>),<span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y=</span>lat), <span class="at">color =</span> <span class="st">"darkred"</span>)</span>
<span id="cb12-1311"><a href="#cb12-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1312"><a href="#cb12-1312" aria-hidden="true" tabindex="-1"></a>map_2015_city <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-1313"><a href="#cb12-1313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2015_us,</span>
<span id="cb12-1314"><a href="#cb12-1314" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> intensity),</span>
<span id="cb12-1315"><a href="#cb12-1315" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb12-1316"><a href="#cb12-1316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#fee5d9"</span>, <span class="at">high =</span> <span class="st">"#a50f15"</span>, <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb12-1317"><a href="#cb12-1317" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"State"</span>) <span class="sc">+</span></span>
<span id="cb12-1318"><a href="#cb12-1318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2015_us<span class="sc">$</span>long, <span class="at">y =</span> merge_2015_us<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb12-1319"><a href="#cb12-1319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(plot1_city),<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">130</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">40</span>) <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb12-1320"><a href="#cb12-1320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(city_fatalities_population_2015,city_fatalities_population_2015<span class="sc">$</span>lon<span class="sc">&gt;-</span><span class="dv">140</span>),<span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y=</span>lat, <span class="at">size =</span> intensity),</span>
<span id="cb12-1321"><a href="#cb12-1321" aria-hidden="true" tabindex="-1"></a>                                                                                                         <span class="at">color =</span> <span class="st">"#8B0020"</span>) <span class="sc">+</span></span>
<span id="cb12-1322"><a href="#cb12-1322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> city_fatalities_population_2015 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intensity <span class="sc">&gt;</span> <span class="dv">28</span>), </span>
<span id="cb12-1323"><a href="#cb12-1323" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(city,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity,<span class="dv">1</span>))), </span>
<span id="cb12-1324"><a href="#cb12-1324" aria-hidden="true" tabindex="-1"></a>                   <span class="co">#color = "#56007C",</span></span>
<span id="cb12-1325"><a href="#cb12-1325" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">"#000000"</span>,</span>
<span id="cb12-1326"><a href="#cb12-1326" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nudge_x =</span> <span class="fu">ifelse</span>(city_fatalities_population_2015<span class="sc">$</span>city <span class="sc">==</span> <span class="st">"Oakland"</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb12-1327"><a href="#cb12-1327" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nudge_y =</span> <span class="fu">ifelse</span>(city_fatalities_population_2015<span class="sc">$</span>city <span class="sc">==</span> <span class="st">"Oakland"</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.5</span>),</span>
<span id="cb12-1328"><a href="#cb12-1328" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size =</span> <span class="fl">3.5</span>, </span>
<span id="cb12-1329"><a href="#cb12-1329" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb12-1330"><a href="#cb12-1330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>))) <span class="sc">+</span> </span>
<span id="cb12-1331"><a href="#cb12-1331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shooting Intensity by City : 2015"</span>,</span>
<span id="cb12-1332"><a href="#cb12-1332" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Per Million of Population"</span>,</span>
<span id="cb12-1333"><a href="#cb12-1333" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="st">"City"</span>,</span>
<span id="cb12-1334"><a href="#cb12-1334" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Cities labels are of shooting intensity &gt; 28 </span><span class="sc">\n</span><span class="st"> Grey highlighted states have NO fatalities"</span></span>
<span id="cb12-1335"><a href="#cb12-1335" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-1336"><a href="#cb12-1336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-1337"><a href="#cb12-1337" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">"black"</span>), </span>
<span id="cb12-1338"><a href="#cb12-1338" aria-hidden="true" tabindex="-1"></a>    <span class="co">#legend.key.size = unit(4, "cm"),</span></span>
<span id="cb12-1339"><a href="#cb12-1339" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb12-1340"><a href="#cb12-1340" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb12-1341"><a href="#cb12-1341" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb12-1342"><a href="#cb12-1342" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb12-1343"><a href="#cb12-1343" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1344"><a href="#cb12-1344" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1345"><a href="#cb12-1345" aria-hidden="true" tabindex="-1"></a>plot2_city <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-1346"><a href="#cb12-1346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2016_alaska,</span>
<span id="cb12-1347"><a href="#cb12-1347" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat,<span class="at">group=</span>group), <span class="at">fill =</span> <span class="st">"#e69e91"</span>,</span>
<span id="cb12-1348"><a href="#cb12-1348" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb12-1349"><a href="#cb12-1349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2016_alaska<span class="sc">$</span>long, <span class="at">y =</span> merge_2016_alaska<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb12-1350"><a href="#cb12-1350" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb12-1351"><a href="#cb12-1351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb12-1352"><a href="#cb12-1352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb12-1353"><a href="#cb12-1353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(city_fatalities_population_2016,city_fatalities_population_2016<span class="sc">$</span>region<span class="sc">==</span><span class="st">"alaska"</span>),<span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y=</span>lat), <span class="at">color =</span> <span class="st">"darkred"</span>)</span>
<span id="cb12-1354"><a href="#cb12-1354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1355"><a href="#cb12-1355" aria-hidden="true" tabindex="-1"></a>map_2016_city <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb12-1356"><a href="#cb12-1356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> merge_2016_us,</span>
<span id="cb12-1357"><a href="#cb12-1357" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat, <span class="at">group =</span> group, <span class="at">fill =</span> intensity),</span>
<span id="cb12-1358"><a href="#cb12-1358" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb12-1359"><a href="#cb12-1359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"#fee5d9"</span>, <span class="at">high =</span> <span class="st">"#a50f15"</span>, <span class="at">na.value =</span> <span class="st">"grey50"</span>,</span>
<span id="cb12-1360"><a href="#cb12-1360" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"State"</span>) <span class="sc">+</span></span>
<span id="cb12-1361"><a href="#cb12-1361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> merge_2016_us<span class="sc">$</span>long, <span class="at">y =</span> merge_2016_us<span class="sc">$</span>lat) <span class="sc">+</span></span>
<span id="cb12-1362"><a href="#cb12-1362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_custom</span>(<span class="fu">ggplotGrob</span>(plot2_city),<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">130</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">70</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">40</span>) <span class="sc">+</span> <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb12-1363"><a href="#cb12-1363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(city_fatalities_population_2016,city_fatalities_population_2016<span class="sc">$</span>lon<span class="sc">&gt;-</span><span class="dv">140</span>),<span class="fu">aes</span>(<span class="at">x =</span> lon,<span class="at">y=</span>lat, <span class="at">size =</span> intensity),</span>
<span id="cb12-1364"><a href="#cb12-1364" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"#8B0020"</span>) <span class="sc">+</span></span>
<span id="cb12-1365"><a href="#cb12-1365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> city_fatalities_population_2016 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(intensity <span class="sc">&gt;</span> <span class="dv">28</span>), </span>
<span id="cb12-1366"><a href="#cb12-1366" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">label =</span> <span class="fu">paste</span>(city,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="fu">round</span>(intensity,<span class="dv">1</span>))), </span>
<span id="cb12-1367"><a href="#cb12-1367" aria-hidden="true" tabindex="-1"></a>                   <span class="co">#color = "#56007C",</span></span>
<span id="cb12-1368"><a href="#cb12-1368" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">"#000000"</span>,</span>
<span id="cb12-1369"><a href="#cb12-1369" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size =</span> <span class="fl">3.5</span>, </span>
<span id="cb12-1370"><a href="#cb12-1370" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb12-1371"><a href="#cb12-1371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>))) <span class="sc">+</span> </span>
<span id="cb12-1372"><a href="#cb12-1372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Shooting Intensity by City : 2016"</span>,</span>
<span id="cb12-1373"><a href="#cb12-1373" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Per Million of Population"</span>,</span>
<span id="cb12-1374"><a href="#cb12-1374" aria-hidden="true" tabindex="-1"></a>       <span class="at">size =</span> <span class="st">"City"</span>,</span>
<span id="cb12-1375"><a href="#cb12-1375" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Cities labels are of shooting intensity &gt; 28 </span><span class="sc">\n</span><span class="st"> Grey highlighted states have NO fatalities"</span></span>
<span id="cb12-1376"><a href="#cb12-1376" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-1377"><a href="#cb12-1377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-1378"><a href="#cb12-1378" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">"black"</span>), </span>
<span id="cb12-1379"><a href="#cb12-1379" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb12-1380"><a href="#cb12-1380" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb12-1381"><a href="#cb12-1381" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb12-1382"><a href="#cb12-1382" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb12-1383"><a href="#cb12-1383" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1384"><a href="#cb12-1384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1385"><a href="#cb12-1385" aria-hidden="true" tabindex="-1"></a><span class="co"># explicit</span></span>
<span id="cb12-1386"><a href="#cb12-1386" aria-hidden="true" tabindex="-1"></a>animation<span class="sc">::</span><span class="fu">saveGIF</span>(</span>
<span id="cb12-1387"><a href="#cb12-1387" aria-hidden="true" tabindex="-1"></a>  <span class="at">expr =</span> {</span>
<span id="cb12-1388"><a href="#cb12-1388" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(map_2015_city)</span>
<span id="cb12-1389"><a href="#cb12-1389" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(map_2016_city)</span>
<span id="cb12-1390"><a href="#cb12-1390" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb12-1391"><a href="#cb12-1391" aria-hidden="true" tabindex="-1"></a>  <span class="at">movie.name =</span> <span class="st">"shooting_intensity_city.gif"</span>,</span>
<span id="cb12-1392"><a href="#cb12-1392" aria-hidden="true" tabindex="-1"></a>  <span class="at">interval =</span> <span class="dv">4</span>,</span>
<span id="cb12-1393"><a href="#cb12-1393" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.width =</span> <span class="dv">1200</span>,</span>
<span id="cb12-1394"><a href="#cb12-1394" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.height =</span> <span class="dv">700</span>,</span>
<span id="cb12-1395"><a href="#cb12-1395" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.dev =</span> <span class="st">"png"</span>,</span>
<span id="cb12-1396"><a href="#cb12-1396" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.type =</span> <span class="st">"cairo"</span>,</span>
<span id="cb12-1397"><a href="#cb12-1397" aria-hidden="true" tabindex="-1"></a>  <span class="at">res =</span> <span class="dv">300</span>,</span>
<span id="cb12-1398"><a href="#cb12-1398" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.x =</span> <span class="st">"in"</span>,</span>
<span id="cb12-1399"><a href="#cb12-1399" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.y =</span> <span class="st">"in"</span>,</span>
<span id="cb12-1400"><a href="#cb12-1400" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.unit =</span> <span class="st">"in"</span>,</span>
<span id="cb12-1401"><a href="#cb12-1401" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.bg =</span> <span class="st">"white"</span>,</span>
<span id="cb12-1402"><a href="#cb12-1402" aria-hidden="true" tabindex="-1"></a>  <span class="at">ani.fps =</span> <span class="dv">3</span></span>
<span id="cb12-1403"><a href="#cb12-1403" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-1404"><a href="#cb12-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1405"><a href="#cb12-1405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-1406"><a href="#cb12-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1407"><a href="#cb12-1407" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/shooting_intensity_city.gif)</span>{fig-align="center"}</span>
<span id="cb12-1408"><a href="#cb12-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1409"><a href="#cb12-1409" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot 3</span></span>
<span id="cb12-1410"><a href="#cb12-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1413"><a href="#cb12-1413" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb12-1414"><a href="#cb12-1414" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Q.2_Plot_3</span></span>
<span id="cb12-1415"><a href="#cb12-1415" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-1416"><a href="#cb12-1416" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb12-1417"><a href="#cb12-1417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1418"><a href="#cb12-1418" aria-hidden="true" tabindex="-1"></a>state_pop <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/Population_Estimate_data_Statewise_2010-2023.csv"</span>)</span>
<span id="cb12-1419"><a href="#cb12-1419" aria-hidden="true" tabindex="-1"></a>fatality<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(fatality<span class="sc">$</span>date, <span class="at">format =</span> <span class="st">"%d/%m/%y"</span>), <span class="st">"%Y"</span>)</span>
<span id="cb12-1420"><a href="#cb12-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1421"><a href="#cb12-1421" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by year, state, and race, then count occurrences</span></span>
<span id="cb12-1422"><a href="#cb12-1422" aria-hidden="true" tabindex="-1"></a>race_count <span class="ot">&lt;-</span> fatality <span class="sc">|&gt;</span></span>
<span id="cb12-1423"><a href="#cb12-1423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, state, race) <span class="sc">|&gt;</span></span>
<span id="cb12-1424"><a href="#cb12-1424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb12-1425"><a href="#cb12-1425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb12-1426"><a href="#cb12-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1427"><a href="#cb12-1427" aria-hidden="true" tabindex="-1"></a><span class="co"># Spread the 'race' column to create individual columns for each race</span></span>
<span id="cb12-1428"><a href="#cb12-1428" aria-hidden="true" tabindex="-1"></a>race_count <span class="ot">&lt;-</span> race_count <span class="sc">|&gt;</span></span>
<span id="cb12-1429"><a href="#cb12-1429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> race, <span class="at">value =</span> count, <span class="at">fill =</span> <span class="dv">0</span>)</span>
<span id="cb12-1430"><a href="#cb12-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1431"><a href="#cb12-1431" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column for the total count of races in each state and year</span></span>
<span id="cb12-1432"><a href="#cb12-1432" aria-hidden="true" tabindex="-1"></a>race_count <span class="ot">&lt;-</span> race_count <span class="sc">|&gt;</span></span>
<span id="cb12-1433"><a href="#cb12-1433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Total =</span> <span class="fu">rowSums</span>(<span class="fu">select</span>(., <span class="sc">-</span><span class="fu">c</span>(year, state)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb12-1434"><a href="#cb12-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1435"><a href="#cb12-1435" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange the data by year and state</span></span>
<span id="cb12-1436"><a href="#cb12-1436" aria-hidden="true" tabindex="-1"></a>race_count <span class="ot">&lt;-</span> race_count <span class="sc">|&gt;</span></span>
<span id="cb12-1437"><a href="#cb12-1437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, state)</span>
<span id="cb12-1438"><a href="#cb12-1438" aria-hidden="true" tabindex="-1"></a>race_perc <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/ShareRaceByCity.csv"</span>)</span>
<span id="cb12-1439"><a href="#cb12-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1440"><a href="#cb12-1440" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the 'City' column from race_perc dataframe</span></span>
<span id="cb12-1441"><a href="#cb12-1441" aria-hidden="true" tabindex="-1"></a>race_perc <span class="ot">&lt;-</span> race_perc <span class="sc">|&gt;</span></span>
<span id="cb12-1442"><a href="#cb12-1442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>City)</span>
<span id="cb12-1443"><a href="#cb12-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1444"><a href="#cb12-1444" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert columns to numeric</span></span>
<span id="cb12-1445"><a href="#cb12-1445" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>share_white <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc<span class="sc">$</span>share_white)</span>
<span id="cb12-1446"><a href="#cb12-1446" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>share_black <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc<span class="sc">$</span>share_black)</span>
<span id="cb12-1447"><a href="#cb12-1447" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>share_native_american <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc<span class="sc">$</span>share_native_american)</span>
<span id="cb12-1448"><a href="#cb12-1448" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>share_asian <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc<span class="sc">$</span>share_asian)</span>
<span id="cb12-1449"><a href="#cb12-1449" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>share_hispanic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(race_perc<span class="sc">$</span>share_hispanic)</span>
<span id="cb12-1450"><a href="#cb12-1450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1451"><a href="#cb12-1451" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column for the sum of all race percentages</span></span>
<span id="cb12-1452"><a href="#cb12-1452" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>sum_race_percentages <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(race_perc[, <span class="fu">c</span>(<span class="st">"share_white"</span>, <span class="st">"share_black"</span>, <span class="st">"share_native_american"</span>, <span class="st">"share_asian"</span>, <span class="st">"share_hispanic"</span>)])</span>
<span id="cb12-1453"><a href="#cb12-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1454"><a href="#cb12-1454" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming race_perc is already loaded as a dataframe</span></span>
<span id="cb12-1455"><a href="#cb12-1455" aria-hidden="true" tabindex="-1"></a>race_perc <span class="ot">&lt;-</span> race_perc <span class="sc">|&gt;</span></span>
<span id="cb12-1456"><a href="#cb12-1456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Geographic.area) <span class="sc">|&gt;</span></span>
<span id="cb12-1457"><a href="#cb12-1457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb12-1458"><a href="#cb12-1458" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_white =</span> <span class="fu">mean</span>(share_white, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-1459"><a href="#cb12-1459" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_black =</span> <span class="fu">mean</span>(share_black, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-1460"><a href="#cb12-1460" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_native_american =</span> <span class="fu">mean</span>(share_native_american, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-1461"><a href="#cb12-1461" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_asian =</span> <span class="fu">mean</span>(share_asian, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-1462"><a href="#cb12-1462" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_hispanic =</span> <span class="fu">mean</span>(share_hispanic, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-1463"><a href="#cb12-1463" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_race_percentages=</span><span class="fu">mean</span>(sum_race_percentages,<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-1464"><a href="#cb12-1464" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1465"><a href="#cb12-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1466"><a href="#cb12-1466" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize race percentages</span></span>
<span id="cb12-1467"><a href="#cb12-1467" aria-hidden="true" tabindex="-1"></a>race_perc <span class="ot">&lt;-</span> race_perc <span class="sc">|&gt;</span></span>
<span id="cb12-1468"><a href="#cb12-1468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-1469"><a href="#cb12-1469" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_white =</span> share_white <span class="sc">/</span> sum_race_percentages,</span>
<span id="cb12-1470"><a href="#cb12-1470" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_black =</span> share_black <span class="sc">/</span> sum_race_percentages,</span>
<span id="cb12-1471"><a href="#cb12-1471" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_native_american =</span> share_native_american <span class="sc">/</span> sum_race_percentages,</span>
<span id="cb12-1472"><a href="#cb12-1472" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_asian =</span> share_asian <span class="sc">/</span> sum_race_percentages,</span>
<span id="cb12-1473"><a href="#cb12-1473" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_hispanic =</span> share_hispanic <span class="sc">/</span> sum_race_percentages</span>
<span id="cb12-1474"><a href="#cb12-1474" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1475"><a href="#cb12-1475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1476"><a href="#cb12-1476" aria-hidden="true" tabindex="-1"></a><span class="co"># Recalculate sum_race_percentages</span></span>
<span id="cb12-1477"><a href="#cb12-1477" aria-hidden="true" tabindex="-1"></a>race_perc<span class="sc">$</span>sum_race_percentages <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">select</span>(race_perc, <span class="fu">starts_with</span>(<span class="st">"share_"</span>)))</span>
<span id="cb12-1478"><a href="#cb12-1478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1479"><a href="#cb12-1479" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting desired columns from state_pop</span></span>
<span id="cb12-1480"><a href="#cb12-1480" aria-hidden="true" tabindex="-1"></a>state_pop_subset <span class="ot">&lt;-</span> state_pop[, <span class="fu">c</span>(<span class="st">"STATE"</span>,</span>
<span id="cb12-1481"><a href="#cb12-1481" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"POPESTIMATE2015"</span>,</span>
<span id="cb12-1482"><a href="#cb12-1482" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"POPESTIMATE2016"</span>,</span>
<span id="cb12-1483"><a href="#cb12-1483" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"POPESTIMATE2017"</span>)]</span>
<span id="cb12-1484"><a href="#cb12-1484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1485"><a href="#cb12-1485" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the dataframe to have Year, State, and Population columns</span></span>
<span id="cb12-1486"><a href="#cb12-1486" aria-hidden="true" tabindex="-1"></a>state_pop_long <span class="ot">&lt;-</span> state_pop_subset <span class="sc">|&gt;</span></span>
<span id="cb12-1487"><a href="#cb12-1487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"POPESTIMATE2015"</span>, <span class="st">"POPESTIMATE2016"</span>, <span class="st">"POPESTIMATE2017"</span>),</span>
<span id="cb12-1488"><a href="#cb12-1488" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Year"</span>,</span>
<span id="cb12-1489"><a href="#cb12-1489" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Population"</span>)</span>
<span id="cb12-1490"><a href="#cb12-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1491"><a href="#cb12-1491" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove "POPESTIMATE" from the Year column</span></span>
<span id="cb12-1492"><a href="#cb12-1492" aria-hidden="true" tabindex="-1"></a>state_pop_long <span class="ot">&lt;-</span> state_pop_long <span class="sc">|&gt;</span></span>
<span id="cb12-1493"><a href="#cb12-1493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">str_remove</span>(Year, <span class="st">"POPESTIMATE"</span>))</span>
<span id="cb12-1494"><a href="#cb12-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1495"><a href="#cb12-1495" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Year column to numeric for sorting</span></span>
<span id="cb12-1496"><a href="#cb12-1496" aria-hidden="true" tabindex="-1"></a>state_pop_long<span class="sc">$</span>Year <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(state_pop_long<span class="sc">$</span>Year)</span>
<span id="cb12-1497"><a href="#cb12-1497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1498"><a href="#cb12-1498" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the dataframe by Year in ascending order</span></span>
<span id="cb12-1499"><a href="#cb12-1499" aria-hidden="true" tabindex="-1"></a>state_pop_long <span class="ot">&lt;-</span> state_pop_long <span class="sc">|&gt;</span></span>
<span id="cb12-1500"><a href="#cb12-1500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Year)</span>
<span id="cb12-1501"><a href="#cb12-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1502"><a href="#cb12-1502" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a mapping of state names to state codes</span></span>
<span id="cb12-1503"><a href="#cb12-1503" aria-hidden="true" tabindex="-1"></a>state_mapping <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb12-1504"><a href="#cb12-1504" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Alabama"</span> <span class="ot">=</span> <span class="st">"AL"</span>, <span class="st">"Alaska"</span> <span class="ot">=</span> <span class="st">"AK"</span>, <span class="st">"Arizona"</span> <span class="ot">=</span> <span class="st">"AZ"</span>, <span class="st">"Arkansas"</span> <span class="ot">=</span> <span class="st">"AR"</span>,</span>
<span id="cb12-1505"><a href="#cb12-1505" aria-hidden="true" tabindex="-1"></a>  <span class="st">"California"</span> <span class="ot">=</span> <span class="st">"CA"</span>, <span class="st">"Colorado"</span> <span class="ot">=</span> <span class="st">"CO"</span>, <span class="st">"Connecticut"</span> <span class="ot">=</span> <span class="st">"CT"</span>, <span class="st">"Delaware"</span> <span class="ot">=</span> <span class="st">"DE"</span>,</span>
<span id="cb12-1506"><a href="#cb12-1506" aria-hidden="true" tabindex="-1"></a>  <span class="st">"District of Columbia"</span> <span class="ot">=</span> <span class="st">"DC"</span>, <span class="st">"Florida"</span> <span class="ot">=</span> <span class="st">"FL"</span>, <span class="st">"Georgia"</span> <span class="ot">=</span> <span class="st">"GA"</span>, <span class="st">"Hawaii"</span> <span class="ot">=</span> <span class="st">"HI"</span>,</span>
<span id="cb12-1507"><a href="#cb12-1507" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Idaho"</span> <span class="ot">=</span> <span class="st">"ID"</span>, <span class="st">"Illinois"</span> <span class="ot">=</span> <span class="st">"IL"</span>, <span class="st">"Indiana"</span> <span class="ot">=</span> <span class="st">"IN"</span>, <span class="st">"Iowa"</span> <span class="ot">=</span> <span class="st">"IA"</span>,</span>
<span id="cb12-1508"><a href="#cb12-1508" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Kansas"</span> <span class="ot">=</span> <span class="st">"KS"</span>, <span class="st">"Kentucky"</span> <span class="ot">=</span> <span class="st">"KY"</span>, <span class="st">"Louisiana"</span> <span class="ot">=</span> <span class="st">"LA"</span>, <span class="st">"Maine"</span> <span class="ot">=</span> <span class="st">"ME"</span>,</span>
<span id="cb12-1509"><a href="#cb12-1509" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Maryland"</span> <span class="ot">=</span> <span class="st">"MD"</span>, <span class="st">"Massachusetts"</span> <span class="ot">=</span> <span class="st">"MA"</span>, <span class="st">"Michigan"</span> <span class="ot">=</span> <span class="st">"MI"</span>, <span class="st">"Minnesota"</span> <span class="ot">=</span> <span class="st">"MN"</span>,</span>
<span id="cb12-1510"><a href="#cb12-1510" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Mississippi"</span> <span class="ot">=</span> <span class="st">"MS"</span>, <span class="st">"Missouri"</span> <span class="ot">=</span> <span class="st">"MO"</span>, <span class="st">"Montana"</span> <span class="ot">=</span> <span class="st">"MT"</span>, <span class="st">"Nebraska"</span> <span class="ot">=</span> <span class="st">"NE"</span>,</span>
<span id="cb12-1511"><a href="#cb12-1511" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Nevada"</span> <span class="ot">=</span> <span class="st">"NV"</span>, <span class="st">"New Hampshire"</span> <span class="ot">=</span> <span class="st">"NH"</span>, <span class="st">"New Jersey"</span> <span class="ot">=</span> <span class="st">"NJ"</span>, <span class="st">"New Mexico"</span> <span class="ot">=</span> <span class="st">"NM"</span>,</span>
<span id="cb12-1512"><a href="#cb12-1512" aria-hidden="true" tabindex="-1"></a>  <span class="st">"New York"</span> <span class="ot">=</span> <span class="st">"NY"</span>, <span class="st">"North Carolina"</span> <span class="ot">=</span> <span class="st">"NC"</span>, <span class="st">"North Dakota"</span> <span class="ot">=</span> <span class="st">"ND"</span>, <span class="st">"Ohio"</span> <span class="ot">=</span> <span class="st">"OH"</span>,</span>
<span id="cb12-1513"><a href="#cb12-1513" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Oklahoma"</span> <span class="ot">=</span> <span class="st">"OK"</span>, <span class="st">"Oregon"</span> <span class="ot">=</span> <span class="st">"OR"</span>, <span class="st">"Pennsylvania"</span> <span class="ot">=</span> <span class="st">"PA"</span>, <span class="st">"Rhode Island"</span> <span class="ot">=</span> <span class="st">"RI"</span>,</span>
<span id="cb12-1514"><a href="#cb12-1514" aria-hidden="true" tabindex="-1"></a>  <span class="st">"South Carolina"</span> <span class="ot">=</span> <span class="st">"SC"</span>, <span class="st">"South Dakota"</span> <span class="ot">=</span> <span class="st">"SD"</span>, <span class="st">"Tennessee"</span> <span class="ot">=</span> <span class="st">"TN"</span>, <span class="st">"Texas"</span> <span class="ot">=</span> <span class="st">"TX"</span>,</span>
<span id="cb12-1515"><a href="#cb12-1515" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Utah"</span> <span class="ot">=</span> <span class="st">"UT"</span>, <span class="st">"Vermont"</span> <span class="ot">=</span> <span class="st">"VT"</span>, <span class="st">"Virginia"</span> <span class="ot">=</span> <span class="st">"VA"</span>, <span class="st">"Washington"</span> <span class="ot">=</span> <span class="st">"WA"</span>,</span>
<span id="cb12-1516"><a href="#cb12-1516" aria-hidden="true" tabindex="-1"></a>  <span class="st">"West Virginia"</span> <span class="ot">=</span> <span class="st">"WV"</span>, <span class="st">"Wisconsin"</span> <span class="ot">=</span> <span class="st">"WI"</span>, <span class="st">"Wyoming"</span> <span class="ot">=</span> <span class="st">"WY"</span>, <span class="st">"Puerto Rico"</span> <span class="ot">=</span> <span class="st">"PR"</span></span>
<span id="cb12-1517"><a href="#cb12-1517" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-1518"><a href="#cb12-1518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1519"><a href="#cb12-1519" aria-hidden="true" tabindex="-1"></a><span class="co"># Add STATE CODE column to state_pop dataframe</span></span>
<span id="cb12-1520"><a href="#cb12-1520" aria-hidden="true" tabindex="-1"></a>state_pop_long <span class="ot">&lt;-</span> <span class="fu">mutate</span>(state_pop_long, <span class="at">STATE_CODE =</span> state_mapping[STATE])</span>
<span id="cb12-1521"><a href="#cb12-1521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1522"><a href="#cb12-1522" aria-hidden="true" tabindex="-1"></a><span class="co"># Rearrange columns with STATE CODE after STATE</span></span>
<span id="cb12-1523"><a href="#cb12-1523" aria-hidden="true" tabindex="-1"></a>state_pop_long <span class="ot">&lt;-</span> state_pop_long <span class="sc">|&gt;</span></span>
<span id="cb12-1524"><a href="#cb12-1524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(STATE, STATE_CODE, <span class="fu">everything</span>())</span>
<span id="cb12-1525"><a href="#cb12-1525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1526"><a href="#cb12-1526" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge race_perc and state_pop_long dataframes based on state information</span></span>
<span id="cb12-1527"><a href="#cb12-1527" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(race_perc, state_pop_long, <span class="at">by.x =</span> <span class="st">"Geographic.area"</span>, <span class="at">by.y =</span> <span class="st">"STATE_CODE"</span>)</span>
<span id="cb12-1528"><a href="#cb12-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1529"><a href="#cb12-1529" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert race percentage columns to numeric</span></span>
<span id="cb12-1530"><a href="#cb12-1530" aria-hidden="true" tabindex="-1"></a>percentage_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"share_white"</span>, <span class="st">"share_black"</span>, <span class="st">"share_native_american"</span>, <span class="st">"share_asian"</span>, <span class="st">"share_hispanic"</span>)</span>
<span id="cb12-1531"><a href="#cb12-1531" aria-hidden="true" tabindex="-1"></a>merged_data[percentage_cols] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(merged_data[percentage_cols], as.numeric)</span>
<span id="cb12-1532"><a href="#cb12-1532" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb12-1533"><a href="#cb12-1533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-1534"><a href="#cb12-1534" aria-hidden="true" tabindex="-1"></a>    <span class="at">white_population =</span> share_white <span class="sc">*</span> Population,</span>
<span id="cb12-1535"><a href="#cb12-1535" aria-hidden="true" tabindex="-1"></a>    <span class="at">black_population =</span> share_black <span class="sc">*</span> Population,</span>
<span id="cb12-1536"><a href="#cb12-1536" aria-hidden="true" tabindex="-1"></a>    <span class="at">native_american_population =</span> share_native_american <span class="sc">*</span> Population,</span>
<span id="cb12-1537"><a href="#cb12-1537" aria-hidden="true" tabindex="-1"></a>    <span class="at">asian_population =</span> share_asian <span class="sc">*</span> Population,</span>
<span id="cb12-1538"><a href="#cb12-1538" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_population =</span> share_hispanic <span class="sc">*</span> Population</span>
<span id="cb12-1539"><a href="#cb12-1539" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1540"><a href="#cb12-1540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1541"><a href="#cb12-1541" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the desired columns</span></span>
<span id="cb12-1542"><a href="#cb12-1542" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb12-1543"><a href="#cb12-1543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Geographic.area, Year, Population, white_population, black_population, </span>
<span id="cb12-1544"><a href="#cb12-1544" aria-hidden="true" tabindex="-1"></a>         native_american_population, asian_population, hispanic_population)</span>
<span id="cb12-1545"><a href="#cb12-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1546"><a href="#cb12-1546" aria-hidden="true" tabindex="-1"></a>fatality <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/PoliceKillingsUS.csv"</span>, <span class="at">na.strings =</span> <span class="st">""</span>)</span>
<span id="cb12-1547"><a href="#cb12-1547" aria-hidden="true" tabindex="-1"></a>fatality<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(fatality<span class="sc">$</span>date, <span class="at">format =</span> <span class="st">"%d/%m/%y"</span>), <span class="st">"%Y"</span>)</span>
<span id="cb12-1548"><a href="#cb12-1548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1549"><a href="#cb12-1549" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only the required columns</span></span>
<span id="cb12-1550"><a href="#cb12-1550" aria-hidden="true" tabindex="-1"></a>fatality <span class="ot">&lt;-</span> fatality <span class="sc">|&gt;</span></span>
<span id="cb12-1551"><a href="#cb12-1551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(race,state,year)</span>
<span id="cb12-1552"><a href="#cb12-1552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1553"><a href="#cb12-1553" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot the data wider</span></span>
<span id="cb12-1554"><a href="#cb12-1554" aria-hidden="true" tabindex="-1"></a>fatality_spread <span class="ot">&lt;-</span> fatality <span class="sc">|&gt;</span></span>
<span id="cb12-1555"><a href="#cb12-1555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb12-1556"><a href="#cb12-1556" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(state, year),</span>
<span id="cb12-1557"><a href="#cb12-1557" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> race,</span>
<span id="cb12-1558"><a href="#cb12-1558" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> race,</span>
<span id="cb12-1559"><a href="#cb12-1559" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fn =</span> length,</span>
<span id="cb12-1560"><a href="#cb12-1560" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb12-1561"><a href="#cb12-1561" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1562"><a href="#cb12-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1563"><a href="#cb12-1563" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the racial columns</span></span>
<span id="cb12-1564"><a href="#cb12-1564" aria-hidden="true" tabindex="-1"></a>fatality_spread <span class="ot">&lt;-</span> fatality_spread <span class="sc">|&gt;</span></span>
<span id="cb12-1565"><a href="#cb12-1565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb12-1566"><a href="#cb12-1566" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_white =</span> W,</span>
<span id="cb12-1567"><a href="#cb12-1567" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_black =</span> B,</span>
<span id="cb12-1568"><a href="#cb12-1568" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_native_american =</span> <span class="st">'NA'</span>,</span>
<span id="cb12-1569"><a href="#cb12-1569" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_asian =</span> A,</span>
<span id="cb12-1570"><a href="#cb12-1570" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_hispanic =</span> H</span>
<span id="cb12-1571"><a href="#cb12-1571" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb12-1572"><a href="#cb12-1572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1573"><a href="#cb12-1573" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge "N" and "O" columns into "Other" column</span></span>
<span id="cb12-1574"><a href="#cb12-1574" aria-hidden="true" tabindex="-1"></a>fatality_spread <span class="ot">&lt;-</span> fatality_spread <span class="sc">|&gt;</span></span>
<span id="cb12-1575"><a href="#cb12-1575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Other =</span> N <span class="sc">+</span> O) <span class="sc">|&gt;</span></span>
<span id="cb12-1576"><a href="#cb12-1576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>N, <span class="sc">-</span>O)</span>
<span id="cb12-1577"><a href="#cb12-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1578"><a href="#cb12-1578" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename 'Geographic.area' to 'state' in grouped_merged_data for consistency</span></span>
<span id="cb12-1579"><a href="#cb12-1579" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb12-1580"><a href="#cb12-1580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">state =</span> Geographic.area)</span>
<span id="cb12-1581"><a href="#cb12-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1582"><a href="#cb12-1582" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Year column in grouped_merged_data to character</span></span>
<span id="cb12-1583"><a href="#cb12-1583" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> merged_data <span class="sc">|&gt;</span></span>
<span id="cb12-1584"><a href="#cb12-1584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.character</span>(Year))</span>
<span id="cb12-1585"><a href="#cb12-1585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1586"><a href="#cb12-1586" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform left join</span></span>
<span id="cb12-1587"><a href="#cb12-1587" aria-hidden="true" tabindex="-1"></a>Final_racial_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(merged_data, fatality_spread, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span> <span class="ot">=</span> <span class="st">"state"</span>, <span class="st">"Year"</span> <span class="ot">=</span> <span class="st">"year"</span>))</span>
<span id="cb12-1588"><a href="#cb12-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1589"><a href="#cb12-1589" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate racial intensity for each racial group</span></span>
<span id="cb12-1590"><a href="#cb12-1590" aria-hidden="true" tabindex="-1"></a>Final_racial_data <span class="ot">&lt;-</span> Final_racial_data <span class="sc">|&gt;</span></span>
<span id="cb12-1591"><a href="#cb12-1591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-1592"><a href="#cb12-1592" aria-hidden="true" tabindex="-1"></a>    <span class="at">white_intensity =</span> <span class="fu">round</span>((share_white <span class="sc">/</span> white_population) <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">2</span>),</span>
<span id="cb12-1593"><a href="#cb12-1593" aria-hidden="true" tabindex="-1"></a>    <span class="at">black_intensity =</span> <span class="fu">round</span>((share_black <span class="sc">/</span> black_population) <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">2</span>),</span>
<span id="cb12-1594"><a href="#cb12-1594" aria-hidden="true" tabindex="-1"></a>    <span class="at">native_american_intensity =</span> <span class="fu">round</span>((share_native_american <span class="sc">/</span> native_american_population) <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">2</span>),</span>
<span id="cb12-1595"><a href="#cb12-1595" aria-hidden="true" tabindex="-1"></a>    <span class="at">asian_intensity =</span> <span class="fu">round</span>((share_asian <span class="sc">/</span> asian_population) <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">2</span>),</span>
<span id="cb12-1596"><a href="#cb12-1596" aria-hidden="true" tabindex="-1"></a>    <span class="at">hispanic_intensity =</span> <span class="fu">round</span>((share_hispanic <span class="sc">/</span> hispanic_population) <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">6</span>, <span class="dv">2</span>)</span>
<span id="cb12-1597"><a href="#cb12-1597" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-1598"><a href="#cb12-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1599"><a href="#cb12-1599" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a template dataframe with all combinations of states and years</span></span>
<span id="cb12-1600"><a href="#cb12-1600" aria-hidden="true" tabindex="-1"></a>template <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">state =</span> <span class="fu">unique</span>(Final_racial_data<span class="sc">$</span>state), </span>
<span id="cb12-1601"><a href="#cb12-1601" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Year =</span> <span class="fu">c</span>(<span class="st">"2015"</span>, <span class="st">"2016"</span>, <span class="st">"2017"</span>))</span>
<span id="cb12-1602"><a href="#cb12-1602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1603"><a href="#cb12-1603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1604"><a href="#cb12-1604" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the template dataframe with Final_racial_data</span></span>
<span id="cb12-1605"><a href="#cb12-1605" aria-hidden="true" tabindex="-1"></a>Final_racial_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(template, Final_racial_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"Year"</span>), <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-1606"><a href="#cb12-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1607"><a href="#cb12-1607" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NA values with 0</span></span>
<span id="cb12-1608"><a href="#cb12-1608" aria-hidden="true" tabindex="-1"></a>Final_racial_data[<span class="fu">is.na</span>(Final_racial_data)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-1609"><a href="#cb12-1609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1610"><a href="#cb12-1610" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder columns to match the original dataframe</span></span>
<span id="cb12-1611"><a href="#cb12-1611" aria-hidden="true" tabindex="-1"></a>Final_racial_data <span class="ot">&lt;-</span> Final_racial_data[, <span class="fu">names</span>(Final_racial_data)]</span>
<span id="cb12-1612"><a href="#cb12-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1613"><a href="#cb12-1613" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the state_mapping_reversed dictionary</span></span>
<span id="cb12-1614"><a href="#cb12-1614" aria-hidden="true" tabindex="-1"></a>state_mapping_reversed <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb12-1615"><a href="#cb12-1615" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AL"</span> <span class="ot">=</span> <span class="st">"Alabama"</span>, <span class="st">"AK"</span> <span class="ot">=</span> <span class="st">"Alaska"</span>, <span class="st">"AZ"</span> <span class="ot">=</span> <span class="st">"Arizona"</span>, <span class="st">"AR"</span> <span class="ot">=</span> <span class="st">"Arkansas"</span>,</span>
<span id="cb12-1616"><a href="#cb12-1616" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CA"</span> <span class="ot">=</span> <span class="st">"California"</span>, <span class="st">"CO"</span> <span class="ot">=</span> <span class="st">"Colorado"</span>, <span class="st">"CT"</span> <span class="ot">=</span> <span class="st">"Connecticut"</span>, <span class="st">"DE"</span> <span class="ot">=</span> <span class="st">"Delaware"</span>,</span>
<span id="cb12-1617"><a href="#cb12-1617" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DC"</span> <span class="ot">=</span> <span class="st">"District of Columbia"</span>, <span class="st">"FL"</span> <span class="ot">=</span> <span class="st">"Florida"</span>, <span class="st">"GA"</span> <span class="ot">=</span> <span class="st">"Georgia"</span>, <span class="st">"HI"</span> <span class="ot">=</span> <span class="st">"Hawaii"</span>,</span>
<span id="cb12-1618"><a href="#cb12-1618" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ID"</span> <span class="ot">=</span> <span class="st">"Idaho"</span>, <span class="st">"IL"</span> <span class="ot">=</span> <span class="st">"Illinois"</span>, <span class="st">"IN"</span> <span class="ot">=</span> <span class="st">"Indiana"</span>, <span class="st">"IA"</span> <span class="ot">=</span> <span class="st">"Iowa"</span>,</span>
<span id="cb12-1619"><a href="#cb12-1619" aria-hidden="true" tabindex="-1"></a>  <span class="st">"KS"</span> <span class="ot">=</span> <span class="st">"Kansas"</span>, <span class="st">"KY"</span> <span class="ot">=</span> <span class="st">"Kentucky"</span>, <span class="st">"LA"</span> <span class="ot">=</span> <span class="st">"Louisiana"</span>, <span class="st">"ME"</span> <span class="ot">=</span> <span class="st">"Maine"</span>,</span>
<span id="cb12-1620"><a href="#cb12-1620" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MD"</span> <span class="ot">=</span> <span class="st">"Maryland"</span>, <span class="st">"MA"</span> <span class="ot">=</span> <span class="st">"Massachusetts"</span>, <span class="st">"MI"</span> <span class="ot">=</span> <span class="st">"Michigan"</span>, <span class="st">"MN"</span> <span class="ot">=</span> <span class="st">"Minnesota"</span>,</span>
<span id="cb12-1621"><a href="#cb12-1621" aria-hidden="true" tabindex="-1"></a>  <span class="st">"MS"</span> <span class="ot">=</span> <span class="st">"Mississippi"</span>, <span class="st">"MO"</span> <span class="ot">=</span> <span class="st">"Missouri"</span>, <span class="st">"MT"</span> <span class="ot">=</span> <span class="st">"Montana"</span>, <span class="st">"NE"</span> <span class="ot">=</span> <span class="st">"Nebraska"</span>,</span>
<span id="cb12-1622"><a href="#cb12-1622" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NV"</span> <span class="ot">=</span> <span class="st">"Nevada"</span>, <span class="st">"NH"</span> <span class="ot">=</span> <span class="st">"New Hampshire"</span>, <span class="st">"NJ"</span> <span class="ot">=</span> <span class="st">"New Jersey"</span>, <span class="st">"NM"</span> <span class="ot">=</span> <span class="st">"New Mexico"</span>,</span>
<span id="cb12-1623"><a href="#cb12-1623" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NY"</span> <span class="ot">=</span> <span class="st">"New York"</span>, <span class="st">"NC"</span> <span class="ot">=</span> <span class="st">"North Carolina"</span>, <span class="st">"ND"</span> <span class="ot">=</span> <span class="st">"North Dakota"</span>, <span class="st">"OH"</span> <span class="ot">=</span> <span class="st">"Ohio"</span>,</span>
<span id="cb12-1624"><a href="#cb12-1624" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OK"</span> <span class="ot">=</span> <span class="st">"Oklahoma"</span>, <span class="st">"OR"</span> <span class="ot">=</span> <span class="st">"Oregon"</span>, <span class="st">"PA"</span> <span class="ot">=</span> <span class="st">"Pennsylvania"</span>, <span class="st">"RI"</span> <span class="ot">=</span> <span class="st">"Rhode Island"</span>,</span>
<span id="cb12-1625"><a href="#cb12-1625" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SC"</span> <span class="ot">=</span> <span class="st">"South Carolina"</span>, <span class="st">"SD"</span> <span class="ot">=</span> <span class="st">"South Dakota"</span>, <span class="st">"TN"</span> <span class="ot">=</span> <span class="st">"Tennessee"</span>, <span class="st">"TX"</span> <span class="ot">=</span> <span class="st">"Texas"</span>,</span>
<span id="cb12-1626"><a href="#cb12-1626" aria-hidden="true" tabindex="-1"></a>  <span class="st">"UT"</span> <span class="ot">=</span> <span class="st">"Utah"</span>, <span class="st">"VT"</span> <span class="ot">=</span> <span class="st">"Vermont"</span>, <span class="st">"VA"</span> <span class="ot">=</span> <span class="st">"Virginia"</span>, <span class="st">"WA"</span> <span class="ot">=</span> <span class="st">"Washington"</span>,</span>
<span id="cb12-1627"><a href="#cb12-1627" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WV"</span> <span class="ot">=</span> <span class="st">"West Virginia"</span>, <span class="st">"WI"</span> <span class="ot">=</span> <span class="st">"Wisconsin"</span>, <span class="st">"WY"</span> <span class="ot">=</span> <span class="st">"Wyoming"</span>, <span class="st">"PR"</span> <span class="ot">=</span> <span class="st">"Puerto Rico"</span></span>
<span id="cb12-1628"><a href="#cb12-1628" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-1629"><a href="#cb12-1629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1630"><a href="#cb12-1630" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace values in the state column using state_mapping_reversed</span></span>
<span id="cb12-1631"><a href="#cb12-1631" aria-hidden="true" tabindex="-1"></a>Final_racial_data<span class="sc">$</span>state <span class="ot">&lt;-</span> state_mapping_reversed[<span class="fu">as.character</span>(Final_racial_data<span class="sc">$</span>state)]</span>
<span id="cb12-1632"><a href="#cb12-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1633"><a href="#cb12-1633" aria-hidden="true" tabindex="-1"></a><span class="co"># Correcting the use of pivot_longer</span></span>
<span id="cb12-1634"><a href="#cb12-1634" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> Final_racial_data <span class="sc">|&gt;</span></span>
<span id="cb12-1635"><a href="#cb12-1635" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-1636"><a href="#cb12-1636" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(state, Year, <span class="fu">ends_with</span>(<span class="st">"intensity"</span>)) <span class="sc">|&gt;</span>  <span class="co"># Select columns that end with 'intensity' and include state, Year</span></span>
<span id="cb12-1637"><a href="#cb12-1637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb12-1638"><a href="#cb12-1638" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">"intensity"</span>,<span class="cn">FALSE</span>),  <span class="co"># This selects all columns that end with 'intensity'</span></span>
<span id="cb12-1639"><a href="#cb12-1639" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"racial_group"</span>,</span>
<span id="cb12-1640"><a href="#cb12-1640" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"intensity"</span></span>
<span id="cb12-1641"><a href="#cb12-1641" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-1642"><a href="#cb12-1642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(intensity)  <span class="co"># Drop NA values in the intensity column</span></span>
<span id="cb12-1643"><a href="#cb12-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1644"><a href="#cb12-1644" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove "intensity" from racial_group column</span></span>
<span id="cb12-1645"><a href="#cb12-1645" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> long_data <span class="sc">|&gt;</span></span>
<span id="cb12-1646"><a href="#cb12-1646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">racial_group =</span> <span class="fu">gsub</span>(<span class="st">"_intensity"</span>, <span class="st">""</span>, racial_group))</span>
<span id="cb12-1647"><a href="#cb12-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1648"><a href="#cb12-1648" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert Year to character</span></span>
<span id="cb12-1649"><a href="#cb12-1649" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> long_data <span class="sc">|&gt;</span></span>
<span id="cb12-1650"><a href="#cb12-1650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.character</span>(Year))</span>
<span id="cb12-1651"><a href="#cb12-1651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1652"><a href="#cb12-1652" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming the rest of the plotting code works, here's how to include the year in the animation</span></span>
<span id="cb12-1653"><a href="#cb12-1653" aria-hidden="true" tabindex="-1"></a>animated_heatmap <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(long_data,</span>
<span id="cb12-1654"><a href="#cb12-1654" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">str_to_title</span>(racial_group),</span>
<span id="cb12-1655"><a href="#cb12-1655" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y =</span> state,</span>
<span id="cb12-1656"><a href="#cb12-1656" aria-hidden="true" tabindex="-1"></a>                               <span class="at">fill =</span> intensity)) <span class="sc">+</span></span>
<span id="cb12-1657"><a href="#cb12-1657" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb12-1658"><a href="#cb12-1658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb12-1659"><a href="#cb12-1659" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"State vs. Racial Intensity Heatmap: Year {frame_time}"</span>, </span>
<span id="cb12-1660"><a href="#cb12-1660" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Racial Group"</span>, </span>
<span id="cb12-1661"><a href="#cb12-1661" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"State"</span>,</span>
<span id="cb12-1662"><a href="#cb12-1662" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Intensity"</span>) <span class="sc">+</span>  <span class="co"># Set the legend title to "Intensity"</span></span>
<span id="cb12-1663"><a href="#cb12-1663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-1664"><a href="#cb12-1664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>), </span>
<span id="cb12-1665"><a href="#cb12-1665" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb12-1666"><a href="#cb12-1666" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb12-1667"><a href="#cb12-1667" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb12-1668"><a href="#cb12-1668" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb12-1669"><a href="#cb12-1669" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),  <span class="co"># Increase legend title size and make it bold</span></span>
<span id="cb12-1670"><a href="#cb12-1670" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),  <span class="co"># Increase legend text size</span></span>
<span id="cb12-1671"><a href="#cb12-1671" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.width =</span> <span class="fu">unit</span>(<span class="fl">1.6</span>, <span class="st">"cm"</span>),  <span class="co"># Increase legend key width</span></span>
<span id="cb12-1672"><a href="#cb12-1672" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">1.6</span>, <span class="st">"cm"</span>)) <span class="sc">+</span>  <span class="co"># Increase legend key height</span></span>
<span id="cb12-1673"><a href="#cb12-1673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_time</span>(<span class="fu">as.integer</span>(Year)) <span class="sc">+</span>  <span class="co"># Ensure 'Year' is treated as an integer</span></span>
<span id="cb12-1674"><a href="#cb12-1674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ease_aes</span>(<span class="st">'linear'</span>)</span>
<span id="cb12-1675"><a href="#cb12-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1676"><a href="#cb12-1676" aria-hidden="true" tabindex="-1"></a><span class="co"># Render and save the animation</span></span>
<span id="cb12-1677"><a href="#cb12-1677" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(animated_heatmap, <span class="at">fps =</span> <span class="dv">1</span>, <span class="at">duration =</span> <span class="dv">15</span>, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">800</span>, <span class="at">renderer =</span> <span class="fu">gifski_renderer</span>())</span>
<span id="cb12-1678"><a href="#cb12-1678" aria-hidden="true" tabindex="-1"></a><span class="fu">anim_save</span>(<span class="st">"images/racial_intensity_heatmap.gif"</span>)</span>
<span id="cb12-1679"><a href="#cb12-1679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1680"><a href="#cb12-1680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb12-1681"><a href="#cb12-1681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1682"><a href="#cb12-1682" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/racial_intensity_heatmap.gif)</span>{fig-align="center"}</span>
<span id="cb12-1683"><a href="#cb12-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1684"><a href="#cb12-1684" aria-hidden="true" tabindex="-1"></a><span class="fu">### Discussion</span></span>
<span id="cb12-1685"><a href="#cb12-1685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1686"><a href="#cb12-1686" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Plot 1</span></span>
<span id="cb12-1687"><a href="#cb12-1687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1688"><a href="#cb12-1688" aria-hidden="true" tabindex="-1"></a>The map analyzes the shooting intensity across all 50 states in the United States from 2015 to 2017. It visualizes this intensity by color-coding each state based on the number of shootings per million people. States with higher shooting rates are shaded darker, while those with lower rates are lighter. States with no fatalities are marked in gray. Additionally, the map labels the top three states with the highest shooting intensities and total fatalities for each year.</span>
<span id="cb12-1689"><a href="#cb12-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1690"><a href="#cb12-1690" aria-hidden="true" tabindex="-1"></a>In 2015, Wyoming, New Mexico, and Oklahoma stood out for their high shooting intensities, while California, Texas, and Florida led in total fatalities. The map annotations highlight these top states for both intensity and fatalities.</span>
<span id="cb12-1691"><a href="#cb12-1691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1692"><a href="#cb12-1692" aria-hidden="true" tabindex="-1"></a>In 2016, the states with the highest shooting intensities shifted to New Mexico, Alaska, and the District of Columbia, while California, Texas, and Florida maintained the highest fatalities.</span>
<span id="cb12-1693"><a href="#cb12-1693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1694"><a href="#cb12-1694" aria-hidden="true" tabindex="-1"></a>By 2017, Maine, Alaska, and Oklahoma had the highest shooting intensities, while California, Texas, and Florida continued to lead in fatalities.</span>
<span id="cb12-1695"><a href="#cb12-1695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1696"><a href="#cb12-1696" aria-hidden="true" tabindex="-1"></a>Overall, the visualization illustrates the variation in shooting intensity across states over the three years. While the states with the most fatalities remain consistent, the states with the highest shooting intensities change over time. Notably, New Mexico and Oklahoma consistently appear among the top states for shooting intensity in two out of the three years.</span>
<span id="cb12-1697"><a href="#cb12-1697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1698"><a href="#cb12-1698" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Plot 2</span></span>
<span id="cb12-1699"><a href="#cb12-1699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1700"><a href="#cb12-1700" aria-hidden="true" tabindex="-1"></a>This map visualizes police shootings' intensity and resulting fatalities in major cities across the United States for the years 2015, 2016, and 2017, measured per million of the population. Each dot on the map represents shootings in different cities. Larger dots indicate cities with higher shooting intensities, while smaller dots represent cities with lower shooting intensities. States are also color-coded based on their shooting intensity, with lighter shades for lower intensity and darker shades for higher intensity.</span>
<span id="cb12-1701"><a href="#cb12-1701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-1702"><a href="#cb12-1702" aria-hidden="true" tabindex="-1"></a>The labels on the map specifically highlight cities with shooting intensities exceeding 28 for that particular year. Notably, Chicago and Los Angeles are consistently among the cities with shootings exceeding this intensity threshold in two out of the three years, indicating their ongoing significance in this regard.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>